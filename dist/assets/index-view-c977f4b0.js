import{a as x,Q as L,E as T,o as l,b as f,e,f as _,N as O,p as M,l as A,m as D,t as U,g as n,F as R,B as N,h as $,w as m,s as h,v as V,C as k,Z as j,M as Q,x as P,$ as X,a0 as Z,r as q,X as z,a1 as G,y as H,_ as J,j as K,I as W,k as Y}from"./index-d17ade26.js";import{_ as oo}from"./tag-input-672386cd.js";import{u as E}from"./useDate-126c6fe0.js";import{b as to,u as eo}from"./blog-e8104212.js";const F=d=>(M("data-v-1da9574f"),d=d(),A(),d),so={class:"blogpost-search-options"},no=F(()=>e("div",{class:"blogpost-search-options__title"},[e("h3",null,"Теги")],-1)),ao={class:"blogpost-search-options__section"},io=F(()=>e("div",{class:"blogpost-search-options__title"},[e("h3",null,"Дата")],-1)),lo={class:"blogpost-search-options__section"},_o=x({__name:"blogpost-search-options",props:{pagination:{}},emits:["update:pagination"],setup(d,{emit:s}){const a=d,{yesterday:C,today:r}=E(new Date,{precision:"day"}),t=L({...a.pagination,"filter[tags]":{type:"tags",value:[]},"filter[createdAt]":{type:"range",value:[C(),r()]}});return T(t,()=>{s("update:pagination",t)},{deep:!0}),(y,o)=>{const i=oo,p=O;return l(),f("div",so,[no,e("div",ao,[_(i,{label:"Введите тег",modelValue:t["filter[tags]"].value,"onUpdate:modelValue":o[0]||(o[0]=c=>t["filter[tags]"].value=c)},null,8,["modelValue"])]),io,e("div",lo,[_(p,{type:"date",label:"Дата от",modelValue:t["filter[createdAt]"].value[0],"onUpdate:modelValue":o[1]||(o[1]=c=>t["filter[createdAt]"].value[0]=c)},null,8,["modelValue"]),_(p,{type:"date",label:"Дата до",modelValue:t["filter[createdAt]"].value[1],"onUpdate:modelValue":o[2]||(o[2]=c=>t["filter[createdAt]"].value[1]=c)},null,8,["modelValue"])])])}}});const po=D(_o,[["__scopeId","data-v-1da9574f"]]),ro={class:"blogpost-card"},co={class:"blogpost-card__header"},uo={class:"blogpost-card__header__title"},go={class:"blogpost-card__header__date"},mo={class:"blogpost-card__info"},fo={class:"blogpost-card__info__tags"},vo={class:"blogpost-card__content"},bo={class:"blogpost-card__content__richtext"},ho={class:"blogpost-card__content__actions"},yo={key:0,class:"blogpost-card__content__poll-count"},$o={class:"blogpost-card__footer"},Vo={class:"blogpost-card__footer__author"},ko={class:"blogpost-card__footer__author__avatar"},Co={class:"blogpost-card__footer__author__name"},wo={class:"blogpost-card__footer__reactions"},Io=x({__name:"blogpost-card",props:{post:{},reaction:{},isReactionLoading:{type:Boolean}},emits:["react","delete"],setup(d,{emit:s}){const a=d;function C(o,i=5){if(o.ops.length<=i)return o;const p=o.ops.slice(0,i).filter(u=>{var v;return((v=u.insert)==null?void 0:v.image)===void 0}),c=o.ops.find(u=>{var v;return(v=u.insert)==null?void 0:v.image});return c?{ops:[c,...p,{insert:`
...`}]}:{ops:[...p,{insert:`
...`}]}}function r(){s("delete",a.post.id)}function t(){var i;const o=(i=k.Context.User)==null?void 0:i.role;return!a.post.poll||!o?!1:a.post.poll.canVote.includes(o)||a.post.poll.canVote.includes("everyone")}function y(){var i;const o=(i=k.Context.User)==null?void 0:i.role;return!a.post.poll||!o?!1:a.post.poll.canSeeResults.includes(o)||a.post.poll.canSeeResults.includes("everyone")}return(o,i)=>{var w,b,B,S;const p=j,c=Q,u=P,v=X,g=Z;return l(),f("div",ro,[e("div",co,[e("div",uo,[e("h2",null,U(o.post.title),1)]),e("div",go,U(n(E)(o.post.createdAt,{precision:"day"}).toBeautiful()),1)]),e("div",mo,[e("div",fo,[(l(!0),f(R,null,N(o.post.tags,I=>(l(),$(p,{key:I,type:"info",mode:"background"},{default:m(()=>[h(" #"+U(I),1)]),_:2},1024))),128))])]),e("div",vo,[e("div",bo,[_(c,{content:C(o.post.content)},null,8,["content"])]),e("div",ho,[o.post.content.ops.length>3?(l(),$(u,{key:0,to:`/blog/post/${o.post.id}`},{default:m(()=>[h(" Читать далее ")]),_:1},8,["to"])):V("",!0),t()?(l(),$(u,{key:1,to:`/poll/${o.post.pollId}`,design:"warning"},{default:m(()=>[h(" Пройти опрос ")]),_:1},8,["to"])):V("",!0),y()?(l(),$(u,{key:2,to:`/poll/${o.post.pollId}/results`,design:"inline"},{default:m(()=>[h(" Результаты опроса ")]),_:1},8,["to"])):V("",!0),((w=n(k).Context.User)==null?void 0:w.role)==="teacher"||((b=n(k).Context.User)==null?void 0:b.role)==="admin"?(l(),$(u,{key:3,design:"inline",to:`/blog/post/create${o.post.id}`},{default:m(()=>[h(" Редактировать ")]),_:1},8,["to"])):V("",!0),((B=n(k).Context.User)==null?void 0:B.role)==="teacher"||((S=n(k).Context.User)==null?void 0:S.role)==="admin"?(l(),$(u,{key:4,design:"danger",onClick:i[0]||(i[0]=I=>r())},{default:m(()=>[h(" Удалить ")]),_:1})):V("",!0)]),o.post.poll?(l(),f("div",yo,[e("p",null,U(o.post.poll.votedUserIds.length)+" человек приняли участие в опросе ",1)])):V("",!0)]),e("div",$o,[e("div",Vo,[e("div",ko,[_(v,{name:o.post.author.name},null,8,["name"])]),e("div",Co,[_(g,{username:o.post.author.username,name:o.post.author.name},null,8,["username","name"])])]),e("div",wo,[_(to,{"my-reaction":o.post.myReaction,reactions:o.post.reactionCounts,loading:o.isReactionLoading,onReact:i[1]||(i[1]=I=>s("react",I))},null,8,["my-reaction","reactions","loading"])])])])}}});const Uo=D(Io,[["__scopeId","data-v-825d0239"]]),xo=d=>(M("data-v-44996f6f"),d=d(),A(),d),Do={class:"blog-list"},Ro={key:0,class:"blog-list__cards"},Bo={key:1,class:"blog-list__loading"},So={key:2,class:"blog-list__not-found"},Lo={class:"blog-list__not-found__image"},To=xo(()=>e("p",{class:"blog-list__not-found__text"},"Посты не найдены",-1)),Mo=x({__name:"blogpost-list",props:{posts:{},loading:{type:Boolean},isReactionLoading:{type:Boolean}},emits:["react","delete"],setup(d,{emit:s}){const a=d,C=q({});return T(C,(r,t)=>{console.log("reactionsModel changed",r,t)},{deep:!0}),(r,t)=>{const y=z,o=G;return l(),f("div",Do,[!r.loading&&a.posts.length?(l(),f("div",Ro,[(l(!0),f(R,null,N(a.posts,i=>(l(),$(Uo,{key:i.id,post:i,"is-reaction-loading":a.isReactionLoading,onReact:p=>s("react",{postId:i.id,reaction:p}),onDelete:t[0]||(t[0]=p=>s("delete",p))},null,8,["post","is-reaction-loading","onReact"]))),128))])):r.loading?(l(),f("div",Bo,[_(y,{contrast:""})])):(l(),f("div",So,[e("div",Lo,[_(o)]),To]))])}}});const Ao=D(Mo,[["__scopeId","data-v-44996f6f"]]),No={class:"index-view"},Po={class:"index-view__search"},Eo={class:"index-view__search__field"},Fo={class:"index-view__search__add-post"},Oo={class:"index-view__list"},jo={key:0,class:"index-view__pagination"},Qo=x({__name:"index-view",setup(d){const s=eo(),a=L({isDeleteModalVisible:!1,postIdToDelete:"",postTitle:""});function C(r){var t;a.isDeleteModalVisible=!0,a.postIdToDelete=r,a.postTitle=((t=s.results.find(y=>y.id===r))==null?void 0:t.title)||""}return H("Блог/Новости"),(r,t)=>{var u,v;const y=J,o=P,i=K,p=W,c=Y;return l(),f(R,null,[e("div",No,[e("div",Po,[e("div",Eo,[_(y,{modelValue:n(s).pagination.search,"onUpdate:modelValue":t[0]||(t[0]=g=>n(s).pagination.search=g)},null,8,["modelValue"])]),e("div",Fo,[((u=n(k).Context.User)==null?void 0:u.role)==="admin"||((v=n(k).Context.User)==null?void 0:v.role)==="teacher"?(l(),$(o,{key:0,design:"primary",to:"/blog/post/create"},{default:m(()=>[h(" Добавить пост ")]),_:1})):V("",!0)])]),_(p,null,{sidebar:m(()=>[_(po,{pagination:n(s).pagination,"onUpdate:pagination":t[1]||(t[1]=g=>n(s).pagination=g)},null,8,["pagination"])]),content:m(()=>{var g,w;return[e("div",Oo,[_(Ao,{posts:n(s).results,loading:n(s).isListLoading,"is-reaction-loading":n(s).isReactionLoading,onReact:t[2]||(t[2]=b=>n(s).reactToPost(b.postId,b.reaction)),onDelete:t[3]||(t[3]=b=>C(b))},null,8,["posts","loading","is-reaction-loading"])]),(g=n(s).pagination)!=null&&g.page&&((w=n(s).pagination)!=null&&w.limit)?(l(),f("div",jo,[_(i,{page:n(s).pagination.page,"onUpdate:page":t[4]||(t[4]=b=>n(s).pagination.page=b),total:n(s).resultsMeta.total,limit:n(s).pagination.limit},null,8,["page","total","limit"])])):V("",!0)]}),_:1})]),_(c,{visible:a.isDeleteModalVisible,"onUpdate:visible":t[5]||(t[5]=g=>a.isDeleteModalVisible=g),onConfirm:t[6]||(t[6]=g=>n(s).deletePost(a.postIdToDelete))},{title:m(()=>[h("Удаление поста")]),text:m(()=>[h(' Вы уверены, что хотите удалить пост "'+U(a.postTitle)+'"? ',1)]),_:1},8,["visible"])],64)}}});const Go=D(Qo,[["__scopeId","data-v-340f8e19"]]);export{Go as default};
