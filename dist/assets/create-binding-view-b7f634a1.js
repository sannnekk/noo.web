import{x as O,d as S,L as J,r as F,o as H,a as u,j as p,u as r,f as B,M,w as $,b as P,C as h,_ as C,g as s,k as g,N as z,v as G,t as W,c as k,q as D,s as x,O as X,P as Y,Q as K,R as Z,p as j,l as A,S as ee,e as q,y as T,T as te,U as ne,E as oe}from"./index-aa6e1f88.js";var w={library:"https://accounts.google.com/gsi/client",defaultButtonConfig:{theme:"outline",size:"large"},scopes:"email profile openid",ssrError:"vue3-google-login cannot be executed on the server side. See here for more info https://devbaji.github.io/vue3-google-login/#no-ssr-support"};const y=O({clientId:null,popupType:"CODE",prompt:!1,autoLogin:!1,idConfiguration:null,buttonConfig:w.defaultButtonConfig,callback:()=>{},error:null}),b=O({apiLoaded:!1,apiLoadIntitited:!1}),ie=()=>new Promise((e,t)=>{if(typeof window<"u"){if(!b.apiLoadIntitited){const n=document.createElement("script");b.apiLoadIntitited=!0,n.addEventListener("load",()=>{b.apiLoaded=!0,e(window.google)}),n.addEventListener("error",()=>{t("Failed to load the Google 3P Authorization JavaScript Library.")}),n.src=w.library,n.async=!0,n.defer=!0,document.head.appendChild(n)}}else t(w.ssrError)}),L=e=>{b.apiLoadIntitited?b.apiLoaded?e(window.google):$(()=>b.apiLoaded,t=>{t&&e(window.google)}):ie().then(t=>{e(t)})},le=(e,t,n,o)=>{if(!e.client_id)throw new Error("Prop client id required since plugin is not initialized with a client id");L(()=>{((i,m,a,d,v)=>{if(v){const _=i.callback;i.callback=f=>{f.credential?_&&_(f):v(f)}}window.google.accounts.id.initialize(i);const l=m.value;l&&!d&&window.google.accounts.id.renderButton(l,a)})(e,t,n.buttonConfig,o,n.error),n.prompt&&ce({clientId:n.clientId,callback:n.callback,error:n.error,autoLogin:n.autoLogin})})},se=e=>new Promise((t,n)=>{L(o=>{if(!(e&&e.clientId||y.clientId))throw new Error("clientId is required since the plugin is not initialized with a Client Id");o.accounts.oauth2.initCodeClient({client_id:e&&e.clientId||y.clientId||"",scope:w.scopes,ux_mode:"popup",callback:i=>{i.code?t(i):n(i)},error_callback:i=>{n(i)}}).requestCode()})}),ae=e=>new Promise((t,n)=>{L(o=>{if(!(e&&e.clientId||y.clientId))throw new Error("clientId is required since the plugin is not initialized with a Client Id");o.accounts.oauth2.initTokenClient({client_id:e&&e.clientId||y.clientId||"",scope:w.scopes,callback:i=>{i.access_token?t(i):n(i)},error_callback:i=>{n(i)}}).requestAccessToken()})}),ce=e=>{if(!e&&(e={}),!e.clientId&&!y.clientId)throw new Error("clientId is required");const t={use_fedcm_for_prompt:!0};return e.clientId&&(t.client_id=e.clientId),!e.clientId&&y.clientId&&(t.client_id=y.clientId),e.context&&(t.context=e.context),e.autoLogin!=null&&(t.auto_select=e.autoLogin),e.cancelOnTapOutside!=null&&(t.cancel_on_tap_outside=e.cancelOnTapOutside),new Promise((n,o)=>{t.callback=i=>{e&&e.callback&&e.callback(i),i.credential?n(i):o(i)},L(i=>{i.accounts.id.initialize(t),i.accounts.id.prompt()})})};var N=S({__name:"GoogleLogin",props:{clientId:{type:String,required:!1},prompt:{type:Boolean,required:!1,default:!1},autoLogin:{type:Boolean,required:!1,default:!1},popupType:{type:String,required:!1},idConfiguration:{type:Object,required:!1},buttonConfig:{type:Object,required:!1},callback:{type:Function,required:!1},error:{type:Function,required:!1}},setup(e){if(!(typeof window<"u"))throw new Error(w.ssrError);const t=!!J().default,n=e,o=((a,d)=>{const v={...a};for(const l in d)d[l]!==void 0&&d[l]!==null&&(v[l]=d[l]);return v})(y,n),i={client_id:o.clientId||null,auto_select:o.autoLogin||!1,callback:o.callback,...o.idConfiguration},m=F();return H(()=>{le(i,m,o,t),n.popupType&&!t&&console.warn("Option 'popupType' is ignored since a slot which act as a custom login button was not found!!!")}),(a,d)=>(u(),p("div",{class:"g-btn-wrapper",onClick:d[0]||(d[0]=v=>r(t)&&void(r(o).popupType==="TOKEN"?ae({clientId:o.clientId}).then(l=>{o.callback&&o.callback(l)}).catch(l=>{o.error&&o.error(l)}):se({clientId:o.clientId}).then(l=>{o.callback&&o.callback(l)}).catch(l=>{o.error&&o.error(l)})))},[r(t)?B("v-if",!0):(u(),p("span",{key:0,ref_key:"buttonRef",ref:m,class:"g-btn"},null,512)),M(a.$slots,"default")]))}});(function(e,t){t===void 0&&(t={});var n=t.insertAt;if(e&&typeof document<"u"){var o=document.head||document.getElementsByTagName("head")[0],i=document.createElement("style");i.type="text/css",n==="top"&&o.firstChild?o.insertBefore(i,o.firstChild):o.appendChild(i),i.styleSheet?i.styleSheet.cssText=e:i.appendChild(document.createTextNode(e))}})(`
.g-btn-wrapper[data-v-5e610566] {
  display: inline-block;
}
`),N.__scopeId="data-v-5e610566",N.__file="src/plugin/GoogleLogin.vue";const re=S({__name:"google-auth-button",emits:["login"],setup(e,{emit:t}){function n(o){t("login",o)}return(o,i)=>(u(),P(r(N),{"client-id":r(h).Constants.GOOGLE_CLIENT_ID,callback:n},null,8,["client-id"]))}});const de=C(re,[["__scopeId","data-v-ed4ded3f"]]);const ue={},_e={class:"success-block"},pe={class:"success-block__icon"},me={class:"success-block__text"};function ve(e,t){const n=z;return u(),p("div",_e,[s("div",pe,[g(n,{name:"check-green"})]),s("div",me,[M(e.$slots,"default",{},void 0,!0)])])}const ge=C(ue,[["render",ve],["__scopeId","data-v-471b0d9c"]]),fe={key:0,class:"entity-selection-card__selected-badge"},ye={class:"entity-selection-card__icon"},he={class:"entity-selection-card__name"},be=S({__name:"entity-selection-card",props:{entity:{},selected:{type:Boolean}},setup(e){const t=F(!1);return(n,o)=>{const i=z;return u(),p("div",{class:W(["entity-selection-card",{"entity-selection-card--selected":n.selected}]),onMouseenter:o[0]||(o[0]=m=>t.value=!0),onMouseleave:o[1]||(o[1]=m=>t.value=!1)},[n.selected?(u(),p("div",fe)):B("",!0),s("div",ye,[g(i,{name:n.entity.icon,animation:t.value},null,8,["name","animation"])]),s("div",he,[s("p",null,G(n.entity.name),1)])],34)}}});const we=C(be,[["__scopeId","data-v-e178dfb9"]]);async function Ie(e){try{return await h.Services.User.getUsers(e)}catch(t){h.Services.UI.openErrorModal("Ошибка при загрузке пользователей",t.message)}}async function ke(e){const t=[{label:"Администратор",role:"admin",id:"1"},{label:"Ученик",role:"student",id:"2"},{label:"Учитель",role:"teacher",id:"3"},{label:"Куратор",role:"mentor",id:"4"}];if(e!=null&&e.search){const n=t.filter(o=>o.label.toLowerCase().includes(e.search.toLowerCase()));return{data:n,meta:{total:n.length,relations:[]}}}return{data:t,meta:{total:t.length,relations:[]}}}async function Se(e){try{return await h.Services.Poll.getPolls(e)}catch(t){h.Services.UI.openErrorModal("Ошибка при загрузке опросов",t.message)}}async function Ce(e){try{return await h.Services.Poll.getPollQuestions(e)}catch(t){h.Services.UI.openErrorModal("Ошибка при загрузке вопросов",t.message)}}const U=[{name:"Результаты опросов",technicalName:"poll_answer",icon:"poll",availableSelectorProps:[{label:"По опросу",value:"pollId",labelKeys:["title"],fetchFunction:Se,toPropValue:e=>e.id},{label:"По вопросу",value:"questionId",labelKeys:["poll.title","text"],fetchFunction:Ce,toPropValue:e=>e.id}]},{name:"Пользователи",technicalName:"user",icon:"users",availableSelectorProps:[{label:"По никнейму",value:"name",labelKeys:["username"],fetchFunction:Ie,toPropValue:e=>e.username},{label:"По роли",value:"role",labelKeys:["label"],fetchFunction:ke,toPropValue:e=>e.role}]}],R=e=>(j("data-v-0e8f930b"),e=e(),A(),e),Ve={class:"entity-selection-view"},Be=R(()=>s("h3",{class:"entity-selection-view__header"},"Выберите модуль",-1)),Le={class:"entity-selection-view__entity-list"},Ee={key:0,class:"entity-selection-view__header"},$e=R(()=>s("h3",null,"Выберите селектор",-1)),xe={class:"row"},Ne={class:"col-md-6"},Fe={class:"entity-selection-view__selector"},Pe={class:"col-md-6"},qe=S({__name:"entity-selection-view",props:{entityName:{},entitySelector:{}},emits:["update:entityName","update:entitySelector"],setup(e,{emit:t}){const n=e,o=k(()=>U.find(l=>l.technicalName===n.entityName)),i=k(()=>{var l;return(l=o.value)==null?void 0:l.availableSelectorProps.find(_=>_.value===n.entitySelector.prop)}),m=k({get:()=>n.entityName,set:l=>t("update:entityName",l)}),a=k({get:()=>n.entitySelector,set:l=>t("update:entitySelector",l)}),d=F([]);$(d,()=>{var _,f;const l=(_=d.value)==null?void 0:_.at(0);a.value={prop:a.value.prop,value:l?(f=i.value)==null?void 0:f.toPropValue(l):""}}),$(i,()=>{d.value=[]});function v(l){m.value=l.technicalName}return(l,_)=>{var I;const f=K,E=Z,V=D("auto-animate");return x((u(),p("div",Ve,[s("section",null,[Be,s("div",Le,[(u(!0),p(X,null,Y(r(U),c=>(u(),P(we,{key:c.technicalName,entity:c,selected:c.technicalName===m.value,onClick:ot=>v(c)},null,8,["entity","selected","onClick"]))),128))])]),o.value?(u(),p("section",Ee,[$e,x((u(),p("div",xe,[s("div",Ne,[s("div",Fe,[g(f,{label:"Селектор",modelValue:a.value.prop,"onUpdate:modelValue":_[0]||(_[0]=c=>a.value.prop=c),options:(I=o.value)==null?void 0:I.availableSelectorProps},null,8,["modelValue","options"])])]),s("div",Pe,[i.value?(u(),p("div",{class:"entity-selection-view__selector",key:i.value.value},[g(E,{label:"Значение (только одно)",modelValue:d.value,"onUpdate:modelValue":_[1]||(_[1]=c=>d.value=c),"label-keys":i.value.labelKeys,"fetch-function":i.value.fetchFunction,"max-count":1},null,8,["modelValue","label-keys","fetch-function"])])):B("",!0)])])),[[V]])])):B("",!0)])),[[V]])}}});const Te=C(qe,[["__scopeId","data-v-0e8f930b"]]),Q=e=>(j("data-v-091962ff"),e=e(),A(),e),Ue={class:"create-binding-view"},Oe={class:"create-binding-view__form"},Me={class:"row"},ze={class:"col-md-6"},Ge={class:"create-binding-view__form-field"},De={class:"col-md-3"},Ke={class:"create-binding-view__form-field"},je={class:"col-md-3"},Ae={class:"create-binding-view__form-field"},Re={class:"row"},Qe={class:"col-md-12"},Je={class:"create-binding-view__form-field"},He={class:"row"},We={class:"col-md-6"},Xe=Q(()=>s("h3",null,"Google-Аккаунт",-1)),Ye={key:1,class:"create-binding-view__form-field"},Ze={class:"col-md-6"},et=Q(()=>s("h3",null,"Статус",-1)),tt={class:"create-binding-view__buttons"},nt=S({__name:"create-binding-view",setup(e){const t=ee(),n=[{value:"hourly",label:"Ежечасно"},{value:"daily",label:"Ежедневно"},{value:"weekly",label:"Еженедельно"},{value:"monthly",label:"Ежемесячно"}],o=[{value:"csv",label:"CSV (формат файлов Excel)"}],i=k({get:()=>t.createBindingForm.status==="active",set:m=>t.createBindingForm.status=m?"active":"inactive"});return(m,a)=>{var I;const d=te,v=K,l=ge,_=de,f=ne,E=oe,V=D("auto-animate");return u(),p("div",Ue,[s("div",Oe,[s("div",Me,[s("div",ze,[s("div",Ge,[g(d,{modelValue:r(t).createBindingForm.name,"onUpdate:modelValue":a[0]||(a[0]=c=>r(t).createBindingForm.name=c),label:"Название интеграции",type:"text"},null,8,["modelValue"])])]),s("div",De,[s("div",Ke,[g(v,{modelValue:r(t).createBindingForm.frequency,"onUpdate:modelValue":a[1]||(a[1]=c=>r(t).createBindingForm.frequency=c),label:"Частота обновления",options:n},null,8,["modelValue"])])]),s("div",je,[s("div",Ae,[g(v,{modelValue:r(t).createBindingForm.format,"onUpdate:modelValue":a[2]||(a[2]=c=>r(t).createBindingForm.format=c),label:"Формат",options:o},null,8,["modelValue"])])])]),s("div",Re,[s("div",Qe,[s("div",Je,[g(Te,{"entity-name":r(t).createBindingForm.entityName,"onUpdate:entityName":a[3]||(a[3]=c=>r(t).createBindingForm.entityName=c),"entity-selector":r(t).createBindingForm.entitySelector,"onUpdate:entitySelector":a[4]||(a[4]=c=>r(t).createBindingForm.entitySelector=c)},null,8,["entity-name","entity-selector"])])])]),s("div",He,[x((u(),p("div",We,[Xe,(I=r(t).createBindingForm.googleCredentials)!=null&&I.email?(u(),P(l,{key:0},{default:q(()=>[T(" Вы вошли как "),s("strong",null,G(r(t).createBindingForm.googleCredentials.email),1)]),_:1})):(u(),p("div",Ye,[g(_,{onLogin:a[5]||(a[5]=c=>r(t).onGoogleLogin(c))})]))])),[[V]]),s("div",Ze,[et,g(f,{modelValue:i.value,"onUpdate:modelValue":a[6]||(a[6]=c=>i.value=c),label:"Активировать интеграцию"},null,8,["modelValue"])])]),s("div",tt,[g(E,{alignment:"right",onClick:a[7]||(a[7]=c=>r(t).saveBinding())},{default:q(()=>[T(" Создать интеграцию ")]),_:1})])])])}}});const lt=C(nt,[["__scopeId","data-v-091962ff"]]);export{lt as default};
