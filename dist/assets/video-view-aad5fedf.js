import{d as C,C as h,r as b,w as A,a as v,i as f,j as r,t as W,O as N,A as X,p as L,l as M,g as a,_ as S,c as I,e as k,y as V,P as Z,E as J,v as x,u as c,Q as q,f as E,R as F,T as Y,U as K,q as ee,s as oe,V as te,b as R,o as ne,W as se,X as ie,G as ae,Y as D,H as de,Z as ce,$ as T,a0 as _e,a1 as le,a2 as re,M as ve,a3 as ue}from"./index-11db2272.js";const O=t=>(L("data-v-b7fc29e3"),t=t(),M(),t),me={key:0},pe=O(()=>a("span",{class:"add-video-to-saved-button__text"},"Добавлено в избранное",-1)),fe={key:1},ye=O(()=>a("span",{class:"add-video-to-saved-button__text"},"Добавить в избранное",-1)),ge={key:2},he=C({__name:"add-video-to-saved-button",props:{videoId:{}},setup(t){const s=t,e=h.Services.Video,m=h.Services.UI,i=b("loading");A(()=>s.videoId,async()=>{await p()},{immediate:!0});async function u(){if(i.value==="loading")return;const d=i.value;i.value="loading";try{d==="added"?(await e.removeFromSavedVideos(s.videoId),i.value="not-added"):(await e.addToSavedVideos(s.videoId),i.value="added")}catch(o){m.openErrorModal("Не удалось добавить или убрать видео в избранное",o.message)}finally{i.value==="loading"&&(i.value=d)}}async function p(){try{const d=await e.isSaved(s.videoId);i.value=d.data?"added":"not-added"}catch{i.value="not-added"}}return(d,o)=>{const _=N,y=X;return v(),f("div",{class:W(["add-video-to-saved-button",i.value]),onClick:o[0]||(o[0]=g=>u())},[i.value==="added"?(v(),f("span",me,[r(_,{name:"check-green"}),pe])):i.value==="not-added"?(v(),f("span",fe,[r(_,{name:"add"}),ye])):(v(),f("span",ge,[r(y,{contrast:""})]))],2)}}});const $e=S(he,[["__scopeId","data-v-b7fc29e3"]]),be={class:"video-comment-form"},we={class:"video-comment-form__input"},Ce={class:"video-comment-form__actions"},P=512,Ve=C({__name:"video-comment-form",props:{videoId:{}},emits:["comment-created"],setup(t,{emit:s}){const e=t,m=s,i=h.Services.Video,u=h.Services.UI,p=b(""),d=I(()=>p.value.trim()),o=b(!1);async function _(){if(!(!d.value||d.value.length>P)){o.value=!0;try{await i.createComment(e.videoId,d.value),p.value="",m("comment-created")}catch(y){u.openErrorModal("Не удалось отправить комментарий",y.message)}finally{o.value=!1}}}return(y,g)=>{const $=Z,l=J;return v(),f("div",be,[a("div",we,[r($,{label:"Оставить комментарий",modelValue:p.value,"onUpdate:modelValue":g[0]||(g[0]=n=>p.value=n),validators:[n=>n.length>0||"Комментарий не может быть пустым",n=>n.length<=P||"Комментарий слишком длинный"],readonly:o.value},null,8,["modelValue","validators","readonly"])]),a("div",Ce,[r(l,{onClick:g[1]||(g[1]=n=>_()),design:"primary",alignment:"right",loading:o.value},{default:k(()=>[V(" Отправить ")]),_:1},8,["loading"])])])}}});const xe=S(Ve,[["__scopeId","data-v-fdb059ec"]]),Ie={class:"video-comment"},Se={class:"video-comment__user"},ke={class:"video-comment__text"},Ee={class:"video-comment__date"},Le={key:0},Me=C({__name:"video-comment",props:{comment:{}},emits:["delete"],setup(t,{emit:s}){const e=t,m=s,i=I(()=>{var d;return h.Context.User.id===((d=e.comment.user)==null?void 0:d.id)||h.Context.roleIs(["admin","teacher"])}),u=b(!1);function p(){u.value?m("delete",e.comment.id):u.value=!0}return(d,o)=>{const _=Y,y=N,g=K;return v(),f(F,null,[a("div",Ie,[a("div",Se,[r(_,{user:d.comment.user},null,8,["user"])]),a("div",ke,x(d.comment.text),1),a("div",Ee,[V(x(c(q)(d.comment.createdAt,{precision:"minute"}).toBeautiful())+" ",1),i.value?(v(),f("span",Le,[V(" ⋅ "),r(y,{class:"video-comment__delete-button",name:"delete",onClick:o[0]||(o[0]=$=>p())})])):E("",!0)])]),r(g,{visible:u.value,"onUpdate:visible":o[1]||(o[1]=$=>u.value=$),onConfirm:o[2]||(o[2]=$=>p())},{title:k(()=>[V(" Удаление комментария ")]),text:k(()=>[V(' Вы уверены, что хотите удалить комментарий "'+x(d.comment.text)+'"? ',1)]),_:1},8,["visible"])],64)}}});const Re=S(Me,[["__scopeId","data-v-99babd5a"]]),Ue=t=>(L("data-v-076cd09a"),t=t(),M(),t),Be={class:"video-comment-list"},De=Ue(()=>a("div",{class:"video-comment-list__title"},[a("h3",null,"Комментарии")],-1)),Te={class:"video-comment-list__items"},Pe={key:0,class:"video-comment-list__empty"},Ae=C({__name:"video-comment-list",props:{comments:{}},emits:["delete-comment"],setup(t){return(s,e)=>{const m=Re,i=ee("auto-animate");return v(),f("div",Be,[De,oe((v(),f("div",Te,[(v(!0),f(F,null,te(s.comments,u=>(v(),R(m,{key:u.id,comment:u,onDelete:e[0]||(e[0]=p=>s.$emit("delete-comment",p))},null,8,["comment"]))),128))])),[[i]]),s.comments.length===0?(v(),f("p",Pe," Комментариев пока нет ")):E("",!0)])}}});const Ne=S(Ae,[["__scopeId","data-v-076cd09a"]]),qe={class:"yandex-video-player"},Fe=C({__name:"yandex-video-player",props:{video:{},autoplay:{type:Boolean}},setup(t){const s=t,e=I(()=>`https://runtime.video.cloud.yandex.net/player/video/${s.video.uniqueIdentifier}`),m=b(null);let i=null;return ne(()=>{i=Ya.playerSdk.init({element:m.value,source:e.value,autoplay:s.autoplay||!1})}),se(()=>{i&&i.destroy()}),(u,p)=>(v(),f("div",qe,[a("div",{class:"yandex-video-player__player-root",ref_key:"playerRef",ref:m},null,512)]))}});const Ye=S(Fe,[["__scopeId","data-v-28e754aa"]]),Oe=C({__name:"video-player",props:{video:{}},setup(t){const s=t,e=I(()=>{switch(s.video.serviceType){case"yandex":default:return Ye}});return(m,i)=>(v(),R(ie(e.value),{video:m.video},null,8,["video"]))}}),je=ae("nootube-module:video",()=>{const t=h.Services.UI,s=h.Services.Video,e=b(null),m=b(null),i=D(o,{immediate:!1}),u=D(d);async function p(l){try{const n=await s.getVideo(l,{showLoader:!0});e.value=n.data,await $()}catch(n){t.openErrorModal("Ошибка при загрузке видео",n==null?void 0:n.message)}}async function d(l){try{return s.getVideos(l)}catch(n){t.openErrorModal("Ошибка при загрузке похожих видео",n==null?void 0:n.message)}}async function o(l){if(e.value)try{return s.getVideoComments(e.value.id,l)}catch(n){t.openErrorModal("Ошибка при загрузке комментариев",n==null?void 0:n.message)}}async function _(l){try{await s.deleteComment(l,{showLoader:!0}),i.trigger()}catch(n){t.openErrorModal("Ошибка при удалении комментария",n==null?void 0:n.message)}}const y=b(!1);async function g(l){if(e.value){y.value=!0;try{const n=await s.toggleReaction(e.value.id,l);e.value.myReaction=e.value.myReaction===l?null:l,e.value.reactionCounts=n.data}catch(n){t.openErrorModal("Не удалось отреагировать на видео",n.message)}finally{y.value=!1}}}async function $(){if(e.value)try{const l=await s.getAccessInfo(e.value.id,{showLoader:!0});m.value=l.data}catch(l){t.openErrorModal("Ошибка при загрузке информации о доступе",l==null?void 0:l.message)}}return{video:e,accessInfo:m,comments:i,similarVideos:u,fetchVideo:p,deleteComment:_,react:g,reactionsLoading:y}}),ze=t=>(L("data-v-1a533f11"),t=t(),M(),t),Ge={key:0,class:"video-view"},He={class:"video-view__player"},Qe={class:"video-view__comments"},We={class:"video-view__comments__list"},Xe={class:"video-view__comments__form"},Ze={class:"video-view__info"},Je={class:"video-view__info__back-button"},Ke={key:0,class:"video-view__info__edit-button"},eo={class:"video-view__info__title"},oo={class:"video-view__info__author"},to={class:"video-view__info__main"},no={class:"video-view__info__actions"},so={key:1,class:"video-view__info__link"},io={class:"video-view__info__description"},ao={key:1,class:"video-view__not-found"},co=ze(()=>a("h4",null,"Видео не найдено",-1)),_o=C({__name:"video-view",setup(t){const s=de(),e=je();A(()=>s.params.id,async()=>{var o;await e.fetchVideo(s.params.id),e.comments.trigger(),T(`НОО.Tube - ${(o=e.video)==null?void 0:o.title}`)},{immediate:!0});const m=I(()=>{var o;return h.Constants.APP_URL+`/nootube/video/${(o=e.video)==null?void 0:o.id}`}),i=I(()=>{var o;return`https://runtime.video.cloud.yandex.net/player/video/${(o=e.video)==null?void 0:o.uniqueIdentifier}`}),u=b(!1);function p(){u.value=!0}async function d(){var o;await e.fetchVideo(s.params.id),T(`НОО.Tube - ${(o=e.video)==null?void 0:o.title}`)}return(o,_)=>{var B;const y=Oe,g=Ne,$=xe,l=_e,n=Y,j=$e,z=le,U=re,G=ve,H=ue,Q=ce("nothing-found");return c(e).video?(v(),f("div",Ge,[a("div",He,[(v(),R(y,{video:c(e).video,key:c(e).video.id},null,8,["video"]))]),a("div",Qe,[a("div",We,[r(g,{comments:c(e).comments.results,onDeleteComment:_[0]||(_[0]=w=>c(e).deleteComment(w))},null,8,["comments"])]),a("div",Xe,[r($,{"video-id":c(e).video.id,onCommentCreated:_[1]||(_[1]=w=>c(e).comments.trigger())},null,8,["video-id"])])]),a("div",Ze,[a("div",Je,[r(l,{to:"/nootube"},{default:k(()=>[V(" Назад к списку видео ")]),_:1})]),c(h).Context.roleIs(["teacher","admin"])?(v(),f("div",Ke,[a("span",{class:"video-view__info__edit-button",onClick:_[2]||(_[2]=w=>p())},"Редактировать видео")])):E("",!0),a("h1",eo,x(c(e).video.title),1),a("div",oo,[r(n,{user:c(e).video.uploadedBy},null,8,["user"])]),a("div",to," Опубликовано "+x(c(q)(c(e).video.publishedAt,{precision:"day"}).toBeautiful())+" • "+x((B=c(e).accessInfo)==null?void 0:B.text),1),a("div",no,[r(j,{"video-id":c(e).video.id},null,8,["video-id"]),r(z,{reactions:c(e).video.reactionCounts,"my-reaction":c(e).video.myReaction,loading:c(e).reactionsLoading,onReact:_[3]||(_[3]=w=>c(e).react(w))},null,8,["reactions","my-reaction","loading"])]),c(h).Context.roleIs(["admin","teacher"])?(v(),f("div",so,[r(U,{label:"Ссылка на видео","model-value":m.value,type:"text",readonly:"","copy-button":""},null,8,["model-value"]),r(U,{label:"Ссылка на видео для вставки в виде плеера","model-value":i.value,type:"text",readonly:"","copy-button":""},null,8,["model-value"])])):E("",!0),a("div",io,[r(G,{content:c(e).video.description,"no-padding":""},null,8,["content"])])]),r(H,{visible:u.value,"onUpdate:visible":_[4]||(_[4]=w=>u.value=w),video:c(e).video,onEdited:_[5]||(_[5]=w=>d())},null,8,["visible","video"])])):(v(),f("div",ao,[r(Q),co]))}}});const ro=S(_o,[["__scopeId","data-v-1a533f11"]]);export{ro as default};
