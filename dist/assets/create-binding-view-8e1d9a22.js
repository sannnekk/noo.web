import{x as q,d as k,L as D,r as N,o as K,a as p,j as f,u as c,f as C,M as j,w as L,b as T,C as h,_ as V,g as a,k as g,v as A,t as R,N as Q,c as S,q as J,s as P,O as H,P as W,Q as U,R as X,p as O,l as M,S as Y,e as Z,y as ee,T as te,U as ne,E as oe}from"./index-1483b4a4.js";var I={library:"https://accounts.google.com/gsi/client",defaultButtonConfig:{theme:"outline",size:"large"},scopes:"email profile openid",ssrError:"vue3-google-login cannot be executed on the server side. See here for more info https://devbaji.github.io/vue3-google-login/#no-ssr-support"};const b=q({clientId:null,popupType:"CODE",prompt:!1,autoLogin:!1,idConfiguration:null,buttonConfig:I.defaultButtonConfig,callback:()=>{},error:null}),w=q({apiLoaded:!1,apiLoadIntitited:!1}),ie=()=>new Promise((e,t)=>{if(typeof window<"u"){if(!w.apiLoadIntitited){const i=document.createElement("script");w.apiLoadIntitited=!0,i.addEventListener("load",()=>{w.apiLoaded=!0,e(window.google)}),i.addEventListener("error",()=>{t("Failed to load the Google 3P Authorization JavaScript Library.")}),i.src=I.library,i.async=!0,i.defer=!0,document.head.appendChild(i)}}else t(I.ssrError)}),B=e=>{w.apiLoadIntitited?w.apiLoaded?e(window.google):L(()=>w.apiLoaded,t=>{t&&e(window.google)}):ie().then(t=>{e(t)})},le=(e,t,i,n)=>{if(!e.client_id)throw new Error("Prop client id required since plugin is not initialized with a client id");B(()=>{((o,_,s,r,m)=>{if(m){const u=o.callback;o.callback=v=>{v.credential?u&&u(v):m(v)}}window.google.accounts.id.initialize(o);const l=_.value;l&&!r&&window.google.accounts.id.renderButton(l,s)})(e,t,i.buttonConfig,n,i.error),i.prompt&&ce({clientId:i.clientId,callback:i.callback,error:i.error,autoLogin:i.autoLogin})})},ae=e=>new Promise((t,i)=>{B(n=>{if(!(e&&e.clientId||b.clientId))throw new Error("clientId is required since the plugin is not initialized with a Client Id");n.accounts.oauth2.initCodeClient({client_id:e&&e.clientId||b.clientId||"",scope:I.scopes,ux_mode:"popup",callback:o=>{o.code?t(o):i(o)},error_callback:o=>{i(o)}}).requestCode()})}),se=e=>new Promise((t,i)=>{B(n=>{if(!(e&&e.clientId||b.clientId))throw new Error("clientId is required since the plugin is not initialized with a Client Id");n.accounts.oauth2.initTokenClient({client_id:e&&e.clientId||b.clientId||"",scope:I.scopes,callback:o=>{o.access_token?t(o):i(o)},error_callback:o=>{i(o)}}).requestAccessToken()})}),ce=e=>{if(!e&&(e={}),!e.clientId&&!b.clientId)throw new Error("clientId is required");const t={use_fedcm_for_prompt:!0};return e.clientId&&(t.client_id=e.clientId),!e.clientId&&b.clientId&&(t.client_id=b.clientId),e.context&&(t.context=e.context),e.autoLogin!=null&&(t.auto_select=e.autoLogin),e.cancelOnTapOutside!=null&&(t.cancel_on_tap_outside=e.cancelOnTapOutside),new Promise((i,n)=>{t.callback=o=>{e&&e.callback&&e.callback(o),o.credential?i(o):n(o)},B(o=>{o.accounts.id.initialize(t),o.accounts.id.prompt()})})};var E=k({__name:"GoogleLogin",props:{clientId:{type:String,required:!1},prompt:{type:Boolean,required:!1,default:!1},autoLogin:{type:Boolean,required:!1,default:!1},popupType:{type:String,required:!1},idConfiguration:{type:Object,required:!1},buttonConfig:{type:Object,required:!1},callback:{type:Function,required:!1},error:{type:Function,required:!1}},setup(e){if(!(typeof window<"u"))throw new Error(I.ssrError);const t=!!D().default,i=e,n=((s,r)=>{const m={...s};for(const l in r)r[l]!==void 0&&r[l]!==null&&(m[l]=r[l]);return m})(b,i),o={client_id:n.clientId||null,auto_select:n.autoLogin||!1,callback:n.callback,...n.idConfiguration},_=N();return K(()=>{le(o,_,n,t),i.popupType&&!t&&console.warn("Option 'popupType' is ignored since a slot which act as a custom login button was not found!!!")}),(s,r)=>(p(),f("div",{class:"g-btn-wrapper",onClick:r[0]||(r[0]=m=>c(t)&&void(c(n).popupType==="TOKEN"?se({clientId:n.clientId}).then(l=>{n.callback&&n.callback(l)}).catch(l=>{n.error&&n.error(l)}):ae({clientId:n.clientId}).then(l=>{n.callback&&n.callback(l)}).catch(l=>{n.error&&n.error(l)})))},[c(t)?C("v-if",!0):(p(),f("span",{key:0,ref_key:"buttonRef",ref:_,class:"g-btn"},null,512)),j(s.$slots,"default")]))}});(function(e,t){t===void 0&&(t={});var i=t.insertAt;if(e&&typeof document<"u"){var n=document.head||document.getElementsByTagName("head")[0],o=document.createElement("style");o.type="text/css",i==="top"&&n.firstChild?n.insertBefore(o,n.firstChild):n.appendChild(o),o.styleSheet?o.styleSheet.cssText=e:o.appendChild(document.createTextNode(e))}})(`
.g-btn-wrapper[data-v-5e610566] {
  display: inline-block;
}
`),E.__scopeId="data-v-5e610566",E.__file="src/plugin/GoogleLogin.vue";const re=k({__name:"google-auth-button",emits:["login"],setup(e,{emit:t}){function i(n){t("login",n)}return(n,o)=>(p(),T(c(E),{"client-id":c(h).Constants.GOOGLE_CLIENT_ID,callback:i},null,8,["client-id"]))}});const de=V(re,[["__scopeId","data-v-ed4ded3f"]]),ue={key:0,class:"entity-selection-card__selected-badge"},_e={class:"entity-selection-card__icon"},pe={class:"entity-selection-card__name"},me=k({__name:"entity-selection-card",props:{entity:{},selected:{type:Boolean}},setup(e){const t=N(!1);return(i,n)=>{const o=Q;return p(),f("div",{class:R(["entity-selection-card",{"entity-selection-card--selected":i.selected}]),onMouseenter:n[0]||(n[0]=_=>t.value=!0),onMouseleave:n[1]||(n[1]=_=>t.value=!1)},[i.selected?(p(),f("div",ue)):C("",!0),a("div",_e,[g(o,{name:i.entity.icon,animation:t.value},null,8,["name","animation"])]),a("div",pe,[a("p",null,A(i.entity.name),1)])],34)}}});const ve=V(me,[["__scopeId","data-v-e178dfb9"]]);async function ge(e){try{return await h.Services.User.getUsers(e)}catch(t){h.Services.UI.openErrorModal("Ошибка при загрузке пользователей",t.message)}}async function fe(e){const t=[{label:"Администратор",role:"admin",id:"1"},{label:"Ученик",role:"student",id:"2"},{label:"Учитель",role:"teacher",id:"3"},{label:"Куратор",role:"mentor",id:"4"}];if(e!=null&&e.search){const i=t.filter(n=>n.label.toLowerCase().includes(e.search.toLowerCase()));return{data:i,meta:{total:i.length,relations:[]}}}return{data:t,meta:{total:t.length,relations:[]}}}async function ye(e){try{return await h.Services.Poll.getPolls(e)}catch(t){h.Services.UI.openErrorModal("Ошибка при загрузке опросов",t.message)}}async function be(e){try{return await h.Services.Poll.getPollQuestions(e)}catch(t){h.Services.UI.openErrorModal("Ошибка при загрузке вопросов",t.message)}}const F=[{name:"Результаты опросов",technicalName:"poll_answer",icon:"poll",availableSelectorProps:[{label:"По опросу",value:"pollId",labelKeys:["title"],fetchFunction:ye,toPropValue:e=>e.id},{label:"По вопросу",value:"questionId",labelKeys:["poll.title","text"],fetchFunction:be,toPropValue:e=>e.id}]},{name:"Пользователи",technicalName:"user",icon:"users",availableSelectorProps:[{label:"По никнейму",value:"name",labelKeys:["username"],fetchFunction:ge,toPropValue:e=>e.username},{label:"По роли",value:"role",labelKeys:["label"],fetchFunction:fe,toPropValue:e=>e.role}]}],z=e=>(O("data-v-0e8f930b"),e=e(),M(),e),he={class:"entity-selection-view"},we=z(()=>a("h3",{class:"entity-selection-view__header"},"Выберите модуль",-1)),Ie={class:"entity-selection-view__entity-list"},Se={key:0,class:"entity-selection-view__header"},ke=z(()=>a("h3",null,"Выберите селектор",-1)),Ce={class:"row"},Ve={class:"col-md-6"},Be={class:"entity-selection-view__selector"},Le={class:"col-md-6"},Ee=k({__name:"entity-selection-view",props:{entityName:{},entitySelector:{}},emits:["update:entityName","update:entitySelector"],setup(e,{emit:t}){const i=e,n=S(()=>F.find(l=>l.technicalName===i.entityName)),o=S(()=>{var l;return(l=n.value)==null?void 0:l.availableSelectorProps.find(u=>u.value===i.entitySelector.prop)}),_=S({get:()=>i.entityName,set:l=>t("update:entityName",l)}),s=S({get:()=>i.entitySelector,set:l=>t("update:entitySelector",l)}),r=N([]);L(r,()=>{var u,v;const l=(u=r.value)==null?void 0:u.at(0);s.value={prop:s.value.prop,value:l?(v=o.value)==null?void 0:v.toPropValue(l):""}}),L(o,()=>{r.value=[]});function m(l){_.value=l.technicalName}return(l,u)=>{var x;const v=U,d=X,$=J("auto-animate");return P((p(),f("div",he,[a("section",null,[we,a("div",Ie,[(p(!0),f(H,null,W(c(F),y=>(p(),T(ve,{key:y.technicalName,entity:y,selected:y.technicalName===_.value,onClick:Xe=>m(y)},null,8,["entity","selected","onClick"]))),128))])]),n.value?(p(),f("section",Se,[ke,P((p(),f("div",Ce,[a("div",Ve,[a("div",Be,[g(v,{label:"Селектор",modelValue:s.value.prop,"onUpdate:modelValue":u[0]||(u[0]=y=>s.value.prop=y),options:(x=n.value)==null?void 0:x.availableSelectorProps},null,8,["modelValue","options"])])]),a("div",Le,[o.value?(p(),f("div",{class:"entity-selection-view__selector",key:o.value.value},[g(d,{label:"Значение (только одно)",modelValue:r.value,"onUpdate:modelValue":u[1]||(u[1]=y=>r.value=y),"label-keys":o.value.labelKeys,"fetch-function":o.value.fetchFunction,"max-count":1},null,8,["modelValue","label-keys","fetch-function"])])):C("",!0)])])),[[$]])])):C("",!0)])),[[$]])}}});const Ne=V(Ee,[["__scopeId","data-v-0e8f930b"]]),G=e=>(O("data-v-69e082cb"),e=e(),M(),e),$e={class:"create-binding-view"},xe={class:"create-binding-view__form"},Pe={class:"row"},Fe={class:"col-md-6"},qe={class:"create-binding-view__form-field"},Te={class:"col-md-3"},Ue={class:"create-binding-view__form-field"},Oe={class:"col-md-3"},Me={class:"create-binding-view__form-field"},ze={class:"row"},Ge={class:"col-md-12"},De={class:"create-binding-view__form-field"},Ke={class:"row"},je={class:"col-md-6"},Ae=G(()=>a("h3",null,"Google-Аккаунт",-1)),Re={class:"create-binding-view__form-field"},Qe={class:"col-md-6"},Je=G(()=>a("h3",null,"Статус",-1)),He={class:"create-binding-view__buttons"},We=k({__name:"create-binding-view",setup(e){const t=Y(),i=[{value:"hourly",label:"Ежечасно"},{value:"daily",label:"Ежедневно"},{value:"weekly",label:"Еженедельно"},{value:"monthly",label:"Ежемесячно"}],n=[{value:"csv",label:"CSV (формат файлов Excel)"}],o=S({get:()=>t.createBindingForm.status==="active",set:_=>t.createBindingForm.status=_?"active":"inactive"});return(_,s)=>{const r=te,m=U,l=de,u=ne,v=oe;return p(),f("div",$e,[a("div",xe,[a("div",Pe,[a("div",Fe,[a("div",qe,[g(r,{modelValue:c(t).createBindingForm.name,"onUpdate:modelValue":s[0]||(s[0]=d=>c(t).createBindingForm.name=d),label:"Название интеграции",type:"text"},null,8,["modelValue"])])]),a("div",Te,[a("div",Ue,[g(m,{modelValue:c(t).createBindingForm.frequency,"onUpdate:modelValue":s[1]||(s[1]=d=>c(t).createBindingForm.frequency=d),label:"Частота обновления",options:i},null,8,["modelValue"])])]),a("div",Oe,[a("div",Me,[g(m,{modelValue:c(t).createBindingForm.format,"onUpdate:modelValue":s[2]||(s[2]=d=>c(t).createBindingForm.format=d),label:"Формат",options:n},null,8,["modelValue"])])])]),a("div",ze,[a("div",Ge,[a("div",De,[g(Ne,{"entity-name":c(t).createBindingForm.entityName,"onUpdate:entityName":s[3]||(s[3]=d=>c(t).createBindingForm.entityName=d),"entity-selector":c(t).createBindingForm.entitySelector,"onUpdate:entitySelector":s[4]||(s[4]=d=>c(t).createBindingForm.entitySelector=d)},null,8,["entity-name","entity-selector"])])])]),a("div",Ke,[a("div",je,[Ae,a("div",Re,[g(l,{onLogin:s[5]||(s[5]=d=>c(t).onGoogleLogin(d))})])]),a("div",Qe,[Je,g(u,{modelValue:o.value,"onUpdate:modelValue":s[6]||(s[6]=d=>o.value=d),label:"Активировать интеграцию"},null,8,["modelValue"])])]),a("div",He,[g(v,{alignment:"right",onClick:s[7]||(s[7]=d=>c(t).saveBinding())},{default:Z(()=>[ee(" Создать интеграцию ")]),_:1})])])])}}});const Ze=V(We,[["__scopeId","data-v-69e082cb"]]);export{Ze as default};
