import{d as S,C as h,r as V,c as E,a as v,i as p,g as n,j as u,e as b,y as w,O as T,E as F,_ as x,v as C,u as m,P,f as k,Q as M,R as B,T as R,U as j,q,s as A,V as G,b as L,p as U,l as N,G as H,W as I,H as O,w as Q,X as W,Y as X,Z as Y,$ as Z,a0 as z,M as J}from"./index-22127084.js";const K={class:"video-comment-form"},ee={class:"video-comment-form__input"},oe={class:"video-comment-form__actions"},D=250,te=S({__name:"video-comment-form",props:{videoId:{}},emits:["comment-created"],setup(t,{emit:s}){const e=t,l=s,r=h.Services.Video,c=h.Services.UI,d=V(""),i=E(()=>d.value.trim()),_=V(!1);async function a(){if(!(!i.value||i.value.length>D)){_.value=!0;try{await r.createComment(e.videoId,i.value),d.value="",l("comment-created")}catch(o){c.openErrorModal("Не удалось отправить комментарий",o.message)}finally{_.value=!1}}}return(o,f)=>{const g=T,$=F;return v(),p("div",K,[n("div",ee,[u(g,{label:"Оставить комментарий",modelValue:d.value,"onUpdate:modelValue":f[0]||(f[0]=y=>d.value=y),validators:[y=>!y||"Комментарий не может быть пустым",y=>y.length<=D||"Комментарий слишком длинный"],readonly:_.value},null,8,["modelValue","validators","readonly"])]),n("div",oe,[u($,{onClick:f[1]||(f[1]=y=>a()),design:"primary",alignment:"right",loading:_.value},{default:b(()=>[w(" Отправить ")]),_:1},8,["loading"])])])}}});const ne=x(te,[["__scopeId","data-v-8021c46e"]]),se={class:"video-comment"},ie={class:"video-comment__user"},_e={class:"video-comment__text"},ce={class:"video-comment__date"},de={key:0},ae=S({__name:"video-comment",props:{comment:{}},emits:["delete"],setup(t,{emit:s}){const e=t,l=s,r=E(()=>{var i;return h.Context.User.id===((i=e.comment.user)==null?void 0:i.id)||h.Context.roleIs(["admin","teacher"])}),c=V(!1);function d(){c.value?l("delete",e.comment.id):c.value=!0}return(i,_)=>{const a=B,o=R,f=j;return v(),p(M,null,[n("div",se,[n("div",ie,[u(a,{user:i.comment.user},null,8,["user"])]),n("div",_e,C(i.comment.text),1),n("div",ce,[w(C(m(P)(i.comment.createdAt,{precision:"minute"}).toBeautiful())+" ",1),r.value?(v(),p("span",de,[w(" ⋅ "),u(o,{class:"video-comment__delete-button",name:"delete",onClick:_[0]||(_[0]=g=>d())})])):k("",!0)])]),u(f,{visible:c.value,"onUpdate:visible":_[1]||(_[1]=g=>c.value=g),onConfirm:_[2]||(_[2]=g=>d())},{title:b(()=>[w(" Удаление комментария ")]),text:b(()=>[w(' Вы уверены, что хотите удалить комментарий "'+C(i.comment.text)+'"? ',1)]),_:1},8,["visible"])],64)}}});const me=x(ae,[["__scopeId","data-v-99babd5a"]]),le=t=>(U("data-v-076cd09a"),t=t(),N(),t),re={class:"video-comment-list"},ue=le(()=>n("div",{class:"video-comment-list__title"},[n("h3",null,"Комментарии")],-1)),ve={class:"video-comment-list__items"},pe={key:0,class:"video-comment-list__empty"},fe=S({__name:"video-comment-list",props:{comments:{}},emits:["delete-comment"],setup(t){return(s,e)=>{const l=me,r=q("auto-animate");return v(),p("div",re,[ue,A((v(),p("div",ve,[(v(!0),p(M,null,G(s.comments,c=>(v(),L(l,{key:c.id,comment:c,onDelete:e[0]||(e[0]=d=>s.$emit("delete-comment",d))},null,8,["comment"]))),128))])),[[r]]),s.comments.length===0?(v(),p("p",pe," Комментариев пока нет ")):k("",!0)])}}});const ge=x(fe,[["__scopeId","data-v-076cd09a"]]),he=H("nootube-module:video",()=>{const t=h.Services.UI,s=h.Services.Video,e=V(null),l=I(i,{immediate:!1}),r=I(d);async function c(a){try{const o=await s.getVideo(a,{showLoader:!0});e.value=o.data}catch(o){t.openErrorModal("Ошибка при загрузке видео",o==null?void 0:o.message)}}async function d(a){try{return s.getVideos(a)}catch(o){t.openErrorModal("Ошибка при загрузке похожих видео",o==null?void 0:o.message)}}async function i(a){if(e.value)try{return s.getVideoComments(e.value.id,a)}catch(o){t.openErrorModal("Ошибка при загрузке комментариев",o==null?void 0:o.message)}}async function _(a){try{await s.deleteComment(a,{showLoader:!0}),l.trigger()}catch(o){t.openErrorModal("Ошибка при удалении комментария",o==null?void 0:o.message)}}return{video:e,comments:l,similarVideos:r,fetchVideo:c,deleteComment:_}}),ye=t=>(U("data-v-ff2ffc3c"),t=t(),N(),t),we={key:0,class:"video-view"},$e={class:"video-view__player"},Ce={class:"video-view__comments"},Ve={class:"video-view__comments__list"},be={class:"video-view__comments__form"},Se={class:"video-view__info"},xe={class:"video-view__info__back-button"},ke={class:"video-view__info__title"},Ie={class:"video-view__info__author"},De={key:0,class:"video-view__info__link"},Ee={class:"video-view__info__description"},Me={key:1,class:"video-view__not-found"},Be=ye(()=>n("h4",null,"Видео не найдено",-1)),Le=S({__name:"video-view",setup(t){const s=O(),e=he();return Q(()=>s.params.id,async()=>{var l;await e.fetchVideo(s.params.id),await e.comments.trigger(),X(((l=e.video)==null?void 0:l.title)||"Видео")},{immediate:!0}),(l,r)=>{const c=Y,d=ge,i=ne,_=Z,a=B,o=z,f=J,g=W("nothing-found");return m(e).video?(v(),p("div",we,[n("div",$e,[(v(),L(c,{video:m(e).video,key:m(e).video.id},null,8,["video"]))]),n("div",Ce,[n("div",Ve,[u(d,{comments:m(e).comments.results,onDeleteComment:r[0]||(r[0]=$=>m(e).deleteComment($))},null,8,["comments"])]),n("div",be,[u(i,{"video-id":m(e).video.id,onCommentCreated:r[1]||(r[1]=$=>m(e).comments.trigger())},null,8,["video-id"])])]),n("div",Se,[n("div",xe,[u(_,{to:"/nootube"},{default:b(()=>[w(" Назад к списку видео ")]),_:1})]),n("h1",ke,C(m(e).video.title),1),n("div",Ie,[u(a,{user:m(e).video.uploadedBy},null,8,["user"])]),m(h).Context.roleIs(["admin","teacher"])?(v(),p("div",De,[u(o,{label:"Ссылка на видео для вставки","model-value":m(e).video.url,type:"text",readonly:"","copy-button":""},null,8,["model-value"])])):k("",!0),n("div",Ee,[u(f,{content:m(e).video.description,"no-padding":""},null,8,["content"])])])])):(v(),p("div",Me,[u(g),Be]))}}});const Ne=x(Le,[["__scopeId","data-v-ff2ffc3c"]]);export{Ne as default};
