import{a as S,c as F,a2 as H,E as L,n as P,o as c,b,e as t,t as j,f as _,q as C,h as k,a3 as z,a4 as K,a5 as y,D as W,K as O,N as R,m as U,w as x,s as E,F as G,B as J,J as Y,i as X,p as T,l as M,d as Z,C as A,r as I,O as ee,G as oe,H as te,g as m,v as D,x as le}from"./index-d17ade26.js";import{_ as se}from"./tag-input-672386cd.js";import{_ as ne}from"./rich-text-area-c0358582.js";import{_ as N}from"./text-area-1a935c3b.js";import{_ as ae}from"./select-input-c7f07e3e.js";import{e as ie}from"./deltaHelpers-643e5dae.js";const re={class:"blogpost-poll-form-question"},_e={class:"blogpost-poll-form-question__title"},ue={class:"blogpost-poll-form-question__title__delete-button"},de={class:"blogpost-poll-form-question__form"},pe={class:"blogpost-poll-form-question__type-specific-form"},me=S({__name:"blogpost-poll-form-question",props:{index:{},modelValue:{}},emits:["update:modelValue","remove"],setup(n,{emit:l}){const r=n,e=F({get:()=>r.modelValue,set:g=>l("update:modelValue",g)}),v=[{value:"date",label:"Дата"},{value:"text",label:"Текст"},{value:"number",label:"Число"},{value:"file",label:"Файл"},{value:"rating",label:"Рейтинг"},{value:"choice",label:"Варианты ответа"}],a=H();return L(()=>e.value.type,g=>{K(Object.assign({"./poll-question-forms/choice-form.vue":()=>y(()=>import("./choice-form-a6dab797.js"),["assets/choice-form-a6dab797.js","assets/index-d17ade26.js","assets/index-8992b1f8.css","assets/tag-input-672386cd.js","assets/tag-input-92171906.css"]),"./poll-question-forms/date-form.vue":()=>y(()=>import("./date-form-12ae339b.js"),["assets/date-form-12ae339b.js","assets/index-d17ade26.js","assets/index-8992b1f8.css","assets/date-form-e6569fdd.css"]),"./poll-question-forms/file-form.vue":()=>y(()=>import("./file-form-ac201fc5.js"),["assets/file-form-ac201fc5.js","assets/index-d17ade26.js","assets/index-8992b1f8.css","assets/select-input-c7f07e3e.js","assets/select-input-3a9780aa.css"]),"./poll-question-forms/number-form.vue":()=>y(()=>import("./number-form-322e74a2.js"),["assets/number-form-322e74a2.js","assets/index-d17ade26.js","assets/index-8992b1f8.css"]),"./poll-question-forms/rating-form.vue":()=>y(()=>import("./rating-form-c5e3abcd.js"),["assets/rating-form-c5e3abcd.js","assets/index-d17ade26.js","assets/index-8992b1f8.css"]),"./poll-question-forms/text-form.vue":()=>y(()=>import("./text-form-297dd05a.js"),["assets/text-form-297dd05a.js","assets/index-d17ade26.js","assets/index-8992b1f8.css"])}),`./poll-question-forms/${g}-form.vue`).then(i=>{a.value=i.default})},{immediate:!0}),(g,i)=>{const f=W,s=O,V=ae,u=R,w=N,h=P("auto-animate");return c(),b("div",re,[t("div",_e,[t("h4",null,"Вопрос "+j(g.index+1),1),t("span",ue,[_(f,{name:"delete",onClick:i[0]||(i[0]=o=>g.$emit("remove"))})])]),t("div",de,[_(s,{label:"Обязательный",modelValue:e.value.required,"onUpdate:modelValue":i[1]||(i[1]=o=>e.value.required=o)},null,8,["modelValue"]),_(V,{modelValue:e.value.type,"onUpdate:modelValue":i[2]||(i[2]=o=>e.value.type=o),label:"Тип вопроса",options:v},null,8,["modelValue"]),_(u,{type:"text",modelValue:e.value.text,"onUpdate:modelValue":i[3]||(i[3]=o=>e.value.text=o),label:"Текст вопроса"},null,8,["modelValue"]),_(w,{type:"text",modelValue:e.value.description,"onUpdate:modelValue":i[4]||(i[4]=o=>e.value.description=o),label:"Описание вопроса"},null,8,["modelValue"])]),C((c(),b("div",pe,[(c(),k(z(a.value),{modelValue:e.value,"onUpdate:modelValue":i[5]||(i[5]=o=>e.value=o)},null,8,["modelValue"]))])),[[h]])])}}});const ce=U(me,[["__scopeId","data-v-1056c445"]]),$=n=>(T("data-v-fb839c3a"),n=n(),M(),n),ve={class:"blogpost-poll-form"},ge=$(()=>t("br",null,null,-1)),fe={class:"blogpost-poll-form__info"},be={class:"row"},Ve={class:"col-md-6"},we=$(()=>t("label",{class:"blogpost-poll-form__info__label"}," Кто может пройти опрос ",-1)),ye={class:"col-md-6"},he=$(()=>t("label",{class:"blogpost-poll-form__info__label"}," Кто может видеть результаты ",-1)),xe={class:"row"},Ee={class:"col-md-6"},ke={class:"col-md-3 only-for-registered"},$e={class:"col-md-3"},qe={class:"blogpost-poll-form__questions"},Se=$(()=>t("div",{class:"blogpost-poll-form__questions__add-question__inner"},[t("span",{class:"blogpost-poll-form__questions__add-question__icon"}," + "),t("span",{class:"blogpost-poll-form__questions__add-question__label"}," Добавить вопрос ")],-1)),Pe=[Se],Ce=S({__name:"blogpost-poll-form",props:{modelValue:{}},emits:["update:modelValue"],setup(n,{emit:l}){const r=n,e=F({get:()=>r.modelValue,set:f=>l("update:modelValue",f)}),v=[{label:"Преподаватели",role:"admin"},{label:"Ученики",role:"student"},{label:"Кураторы",role:"mentor"},{label:"Все",role:"everyone"}];function a(){e.value.questions.push(i())}function g(f){e.value.questions.splice(f,1)}function i(){return{id:void 0,answers:void 0,text:"",description:"",type:"text",required:!1,choices:[],minChoices:1,maxChoices:2,minRating:0,maxRating:5,onlyIntegerRating:!0,maxFileSize:5,maxFileCount:1,allowedFileTypes:["image/jpeg","image/png"],minLength:1,maxLength:100,minValue:0,maxValue:100,onlyIntegerValue:!0,onlyFutureDate:!1,onlyPastDate:!1}}return(f,s)=>{const V=Y,u=X,w=R,h=O,o=N,d=P("auto-animate");return c(),b("div",ve,[_(V,null,{default:x(()=>[E(" Опрос нельзя изменить после публикации поста, будьте внимательны! ")]),_:1}),ge,t("div",fe,[t("div",be,[t("div",Ve,[we,_(u,{items:v,"item-label-key":"label","item-key":"role",multiple:"",modelValue:e.value.canVote,"onUpdate:modelValue":s[0]||(s[0]=p=>e.value.canVote=p)},null,8,["modelValue"])]),t("div",ye,[he,_(u,{items:v,"item-label-key":"label","item-key":"role",multiple:"",modelValue:e.value.canSeeResults,"onUpdate:modelValue":s[1]||(s[1]=p=>e.value.canSeeResults=p)},null,8,["modelValue"])])]),t("div",xe,[t("div",Ee,[_(w,{type:"text",modelValue:e.value.title,"onUpdate:modelValue":s[2]||(s[2]=p=>e.value.title=p),label:"Название опроса"},null,8,["modelValue"])]),t("div",ke,[_(h,{label:"Только для зарегистрированных",modelValue:e.value.requireAuth,"onUpdate:modelValue":s[3]||(s[3]=p=>e.value.requireAuth=p)},null,8,["modelValue"])]),t("div",$e,[_(w,{type:"date",modelValue:e.value.stopAt,"onUpdate:modelValue":s[4]||(s[4]=p=>e.value.stopAt=p),label:"Дата окончания"},null,8,["modelValue"])])]),_(o,{label:"Описание",modelValue:e.value.description,"onUpdate:modelValue":s[5]||(s[5]=p=>e.value.description=p)},null,8,["modelValue"])]),C((c(),b("div",qe,[(c(!0),b(G,null,J(e.value.questions,(p,q)=>(c(),b("div",{class:"blogpost-poll-form__question",key:p.id},[_(ce,{index:q,modelValue:p,"onUpdate:modelValue":B=>e.value.questions[q]=B,onRemove:B=>g(q)},null,8,["index","modelValue","onUpdate:modelValue","onRemove"])]))),128)),t("div",{class:"blogpost-poll-form__questions__add-question",onClick:s[6]||(s[6]=p=>a())},Pe)])),[[d]])])}}});const Re=U(Ce,[["__scopeId","data-v-fb839c3a"]]),Q=Z("blog-module:create-blogpost",()=>{const n=A.Services.UI,l=A.Services.Blog,r=I(i()),e=I("create");function v(o){e.value=o}async function a(o){n.setLoading(!0);try{const d=await l.getPost(o);if(!d.data)throw new Error("Пост не найден");r.value=d.data}catch(d){n.openErrorModal("Ошибка при загрузке поста",d.message)}finally{n.setLoading(!1)}}function g(){r.value=i()}function i(){return{id:void 0,title:"",content:ie(),reactionCounts:void 0,author:void 0,tags:[],createdAt:void 0,updatedAt:void 0}}function f(){return{id:void 0,title:"",description:"",requireAuth:!0,stopAt:new Date,isStopped:!1,createdAt:void 0,updatedAt:void 0,questions:[],canSeeResults:["everyone"],canVote:["everyone"]}}async function s(){n.setLoading(!0);try{e.value==="create"?(r.value.id=void 0,h(r.value),r.value.poll&&w(r.value.poll),await l.createPost(r.value)):await l.updatePost(r.value.id,r.value),n.openSuccessModal("Пост успешно сохранен","Пост успешно сохранен и доступен для просмотра",[{label:"Вернуться к ленте",design:"primary",handler:()=>location.replace("/blog")}])}catch(o){n.openErrorModal("Ошибка при сохранении поста",o.message)}finally{n.setLoading(!1)}}async function V(){r.value.poll=f()}async function u(){r.value.poll=void 0}function w(o){if(!o.title||o.title.length===0)throw new Error("Опрос должен содержать название");if(!o.stopAt)throw new Error("Опрос должен содержать дату окончания");if(o.questions.length===0)throw new Error("Опрос должен содержать хотя бы один вопрос");if(o.canSeeResults.length===0)throw new Error("Опрос должен содержать хотя бы один вариант доступа к результатам");if(o.canVote.length===0)throw new Error("Опрос должен содержать хотя бы один вариант доступа к голосованию");o.questions.forEach(d=>{switch(d.id=void 0,d.type){case"choice":if(!d.choices||d.choices.length===0)throw new Error("Вопрос с выбором должен содержать хотя бы один вариант ответа");break;case"rating":if(d.minRating===void 0||d.maxRating===void 0)throw new Error("Вопрос с рейтингом должен содержать минимальное и максимальное значение");break;case"file":if(d.maxFileSize===void 0)throw new Error("Вопрос с файлом должен содержать максимальный размер файла");if(d.maxFileCount===void 0)throw new Error("Вопрос с файлом должен содержать максимальное количество файлов");break;case"date":break;case"number":if(d.minValue===void 0||d.maxValue===void 0)throw new Error("Вопрос с числом должен содержать минимальное и максимальное значение");break;case"text":break;default:throw new Error("Неизвестный тип вопроса")}})}function h(o){if(!o.title||o.title.length===0)throw new Error("Пост должен содержать название");if(!o.content||o.content.ops.length===0)throw new Error("Пост должен содержать контент");if(o.tags.length===0)throw new Error("Пост должен содержать хотя бы один тег")}return{blogpost:r,fetchBlogpost:a,saveBlogpost:s,mode:e,setMode:v,reset:g,addPoll:V,removePoll:u}}),Ue=[{keys:["Ctrl","Enter"],description:"Сохранить",shortcut:["Ctrl","Enter"],handler:()=>{Q().saveBlogpost()}}],Be=n=>(T("data-v-1a55fac2"),n=n(),M(),n),Ae={class:"create-blogpost-view"},Ie={class:"create-blogpost-view__form"},De={class:"create-blogpost-view__form__title"},Fe={class:"create-blogpost-view__form__content"},Le={class:"create-blogpost-view__form__tags"},Oe={key:0,class:"create-blogpost-view__form__poll"},Te=Be(()=>t("div",{class:"create-blogpost-view__form__poll__title"},[t("h2",null,"Опрос")],-1)),Me={key:0,class:"create-blogpost-view__form__poll__form"},Ne={class:"create-blogpost-view__form__actions"},Qe={class:"create-blogpost-view__form__actions__back"},He={class:"create-blogpost-view__form__actions__submit"},je=S({__name:"create-blogpost-view",setup(n){const l=Q(),r=ee();L(()=>r.params,v=>{v.id&&typeof v.id=="string"&&v.id.length>0?(l.fetchBlogpost(v.id),l.setMode("edit")):(l.setMode("create"),l.reset())},{immediate:!0});const e=oe(Ue);return te(()=>{e()}),(v,a)=>{const g=R,i=ne,f=se,s=le,V=P("auto-animate");return c(),b("div",Ae,[t("div",Ie,[t("div",De,[_(g,{type:"text",modelValue:m(l).blogpost.title,"onUpdate:modelValue":a[0]||(a[0]=u=>m(l).blogpost.title=u),label:"Заголовок поста"},null,8,["modelValue"])]),t("div",Fe,[(c(),k(i,{key:m(l).blogpost.id,modelValue:m(l).blogpost.content,"onUpdate:modelValue":a[1]||(a[1]=u=>m(l).blogpost.content=u),label:"Содержание поста"},null,8,["modelValue"]))]),t("div",Le,[_(f,{modelValue:m(l).blogpost.tags,"onUpdate:modelValue":a[2]||(a[2]=u=>m(l).blogpost.tags=u),label:"Теги"},null,8,["modelValue"])]),m(l).mode==="create"?C((c(),b("div",Oe,[Te,m(l).blogpost.poll?(c(),b("div",Me,[_(Re,{modelValue:m(l).blogpost.poll,"onUpdate:modelValue":a[3]||(a[3]=u=>m(l).blogpost.poll=u)},null,8,["modelValue"])])):D("",!0),m(l).blogpost.poll?(c(),k(s,{key:2,design:"danger",onClick:a[5]||(a[5]=u=>m(l).removePoll())},{default:x(()=>[E(" Удалить опрос ")]),_:1})):(c(),k(s,{key:1,design:"warning",onClick:a[4]||(a[4]=u=>m(l).addPoll())},{default:x(()=>[E(" Добавить опрос ")]),_:1}))])),[[V]]):D("",!0),t("div",Ne,[t("div",Qe,[_(s,{design:"secondary",to:"/blog"},{default:x(()=>[E(" Назад ")]),_:1})]),t("div",He,[_(s,{design:"primary",onClick:a[6]||(a[6]=u=>m(l).saveBlogpost())},{default:x(()=>[E(" Сохранить ")]),_:1})])])])])}}});const Xe=U(je,[["__scopeId","data-v-1a55fac2"]]);export{Xe as default};
