import{x as U,d as I,L as Q,r as q,o as H,a as u,j as m,u as r,f as V,M as G,w as $,b as P,e as E,y as N,C as x,E as z,_ as C,g as a,k as g,N as M,v as W,t as X,c as k,q as D,s as F,O as Y,P as Z,Q as A,R as ee,p as j,l as K,S as te,T as ne,U as oe}from"./index-3ee9dc38.js";var w={library:"https://accounts.google.com/gsi/client",defaultButtonConfig:{theme:"outline",size:"large"},scopes:"email profile openid",ssrError:"vue3-google-login cannot be executed on the server side. See here for more info https://devbaji.github.io/vue3-google-login/#no-ssr-support"};const b=U({clientId:null,popupType:"CODE",prompt:!1,autoLogin:!1,idConfiguration:null,buttonConfig:w.defaultButtonConfig,callback:()=>{},error:null}),h=U({apiLoaded:!1,apiLoadIntitited:!1}),ie=()=>new Promise((e,t)=>{if(typeof window<"u"){if(!h.apiLoadIntitited){const o=document.createElement("script");h.apiLoadIntitited=!0,o.addEventListener("load",()=>{h.apiLoaded=!0,e(window.google)}),o.addEventListener("error",()=>{t("Failed to load the Google 3P Authorization JavaScript Library.")}),o.src=w.library,o.async=!0,o.defer=!0,document.head.appendChild(o)}}else t(w.ssrError)}),S=e=>{h.apiLoadIntitited?h.apiLoaded?e(window.google):$(()=>h.apiLoaded,t=>{t&&e(window.google)}):ie().then(t=>{e(t)})},le=(e,t,o,i)=>{if(!e.client_id)throw new Error("Prop client id required since plugin is not initialized with a client id");S(()=>{((n,_,s,c,v)=>{if(v){const p=n.callback;n.callback=f=>{f.credential?p&&p(f):v(f)}}window.google.accounts.id.initialize(n);const l=_.value;l&&!c&&window.google.accounts.id.renderButton(l,s)})(e,t,o.buttonConfig,i,o.error),o.prompt&&ce({clientId:o.clientId,callback:o.callback,error:o.error,autoLogin:o.autoLogin})})},se=e=>new Promise((t,o)=>{S(i=>{if(!(e&&e.clientId||b.clientId))throw new Error("clientId is required since the plugin is not initialized with a Client Id");i.accounts.oauth2.initCodeClient({client_id:e&&e.clientId||b.clientId||"",scope:w.scopes,ux_mode:"popup",callback:n=>{n.code?t(n):o(n)},error_callback:n=>{o(n)}}).requestCode()})}),ae=e=>new Promise((t,o)=>{S(i=>{if(!(e&&e.clientId||b.clientId))throw new Error("clientId is required since the plugin is not initialized with a Client Id");i.accounts.oauth2.initTokenClient({client_id:e&&e.clientId||b.clientId||"",scope:w.scopes,callback:n=>{n.access_token?t(n):o(n)},error_callback:n=>{o(n)}}).requestAccessToken()})}),ce=e=>{if(!e&&(e={}),!e.clientId&&!b.clientId)throw new Error("clientId is required");const t={use_fedcm_for_prompt:!0};return e.clientId&&(t.client_id=e.clientId),!e.clientId&&b.clientId&&(t.client_id=b.clientId),e.context&&(t.context=e.context),e.autoLogin!=null&&(t.auto_select=e.autoLogin),e.cancelOnTapOutside!=null&&(t.cancel_on_tap_outside=e.cancelOnTapOutside),new Promise((o,i)=>{t.callback=n=>{e&&e.callback&&e.callback(n),n.credential?o(n):i(n)},S(n=>{n.accounts.id.initialize(t),n.accounts.id.prompt()})})};var T=I({__name:"GoogleLogin",props:{clientId:{type:String,required:!1},prompt:{type:Boolean,required:!1,default:!1},autoLogin:{type:Boolean,required:!1,default:!1},popupType:{type:String,required:!1},idConfiguration:{type:Object,required:!1},buttonConfig:{type:Object,required:!1},callback:{type:Function,required:!1},error:{type:Function,required:!1}},setup(e){if(!(typeof window<"u"))throw new Error(w.ssrError);const t=!!Q().default,o=e,i=((s,c)=>{const v={...s};for(const l in c)c[l]!==void 0&&c[l]!==null&&(v[l]=c[l]);return v})(b,o),n={client_id:i.clientId||null,auto_select:i.autoLogin||!1,callback:i.callback,...i.idConfiguration},_=q();return H(()=>{le(n,_,i,t),o.popupType&&!t&&console.warn("Option 'popupType' is ignored since a slot which act as a custom login button was not found!!!")}),(s,c)=>(u(),m("div",{class:"g-btn-wrapper",onClick:c[0]||(c[0]=v=>r(t)&&void(r(i).popupType==="TOKEN"?ae({clientId:i.clientId}).then(l=>{i.callback&&i.callback(l)}).catch(l=>{i.error&&i.error(l)}):se({clientId:i.clientId}).then(l=>{i.callback&&i.callback(l)}).catch(l=>{i.error&&i.error(l)})))},[r(t)?V("v-if",!0):(u(),m("span",{key:0,ref_key:"buttonRef",ref:_,class:"g-btn"},null,512)),G(s.$slots,"default")]))}});(function(e,t){t===void 0&&(t={});var o=t.insertAt;if(e&&typeof document<"u"){var i=document.head||document.getElementsByTagName("head")[0],n=document.createElement("style");n.type="text/css",o==="top"&&i.firstChild?i.insertBefore(n,i.firstChild):i.appendChild(n),n.styleSheet?n.styleSheet.cssText=e:n.appendChild(document.createTextNode(e))}})(`
.g-btn-wrapper[data-v-5e610566] {
  display: inline-block;
}
`),T.__scopeId="data-v-5e610566",T.__file="src/plugin/GoogleLogin.vue";const de=I({__name:"google-auth-button",emits:["login"],setup(e,{emit:t}){function o(n){t("login",n)}function i(){S(n=>{n.accounts.oauth2.initCodeClient({client_id:x.Constants.GOOGLE_CLIENT_ID,scope:"email profile openid https://www.googleapis.com/auth/drive.file",callback:o}).requestCode()})}return(n,_)=>{const s=z;return u(),P(s,{onClick:_[0]||(_[0]=c=>i())},{default:E(()=>[N(" Войти через Google ")]),_:1})}}});const re=C(de,[["__scopeId","data-v-98d6de66"]]);const ue={},_e={class:"success-block"},pe={class:"success-block__icon"},me={class:"success-block__text"};function ve(e,t){const o=M;return u(),m("div",_e,[a("div",pe,[g(o,{name:"check-green"})]),a("div",me,[G(e.$slots,"default",{},void 0,!0)])])}const ge=C(ue,[["render",ve],["__scopeId","data-v-471b0d9c"]]),fe={key:0,class:"entity-selection-card__selected-badge"},ye={class:"entity-selection-card__icon"},be={class:"entity-selection-card__name"},he=I({__name:"entity-selection-card",props:{entity:{},selected:{type:Boolean}},setup(e){const t=q(!1);return(o,i)=>{const n=M;return u(),m("div",{class:X(["entity-selection-card",{"entity-selection-card--selected":o.selected}]),onMouseenter:i[0]||(i[0]=_=>t.value=!0),onMouseleave:i[1]||(i[1]=_=>t.value=!1)},[o.selected?(u(),m("div",fe)):V("",!0),a("div",ye,[g(n,{name:o.entity.icon,animation:t.value},null,8,["name","animation"])]),a("div",be,[a("p",null,W(o.entity.name),1)])],34)}}});const we=C(he,[["__scopeId","data-v-e178dfb9"]]);async function ke(e){const t=[{label:"Администратор",role:"admin",id:"1"},{label:"Ученик",role:"student",id:"2"},{label:"Учитель",role:"teacher",id:"3"},{label:"Куратор",role:"mentor",id:"4"}];if(e!=null&&e.search){const o=t.filter(i=>i.label.toLowerCase().includes(e.search.toLowerCase()));return{data:o,meta:{total:o.length,relations:[]}}}return{data:t,meta:{total:t.length,relations:[]}}}async function Ie(e){try{return await x.Services.Poll.getPolls(e)}catch(t){x.Services.UI.openErrorModal("Ошибка при загрузке опросов",t.message)}}const O=[{name:"Результаты опросов",technicalName:"poll_answer",icon:"poll",availableSelectorProps:[{label:"По опросу",value:"pollId",labelKeys:["title"],fetchFunction:Ie,toPropValue:e=>e.id}]},{name:"Пользователи",technicalName:"user",icon:"users",availableSelectorProps:[{label:"По роли",value:"role",labelKeys:["label"],fetchFunction:ke,toPropValue:e=>e.role}]}],R=e=>(j("data-v-0e8f930b"),e=e(),K(),e),Ce={class:"entity-selection-view"},Se=R(()=>a("h3",{class:"entity-selection-view__header"},"Выберите модуль",-1)),Be={class:"entity-selection-view__entity-list"},Ve={key:0,class:"entity-selection-view__header"},Le=R(()=>a("h3",null,"Выберите селектор",-1)),$e={class:"row"},Ee={class:"col-md-6"},Ne={class:"entity-selection-view__selector"},xe={class:"col-md-6"},Fe=I({__name:"entity-selection-view",props:{entityName:{},entitySelector:{}},emits:["update:entityName","update:entitySelector"],setup(e,{emit:t}){const o=e,i=k(()=>O.find(l=>l.technicalName===o.entityName)),n=k(()=>{var l;return(l=i.value)==null?void 0:l.availableSelectorProps.find(p=>p.value===o.entitySelector.prop)}),_=k({get:()=>o.entityName,set:l=>t("update:entityName",l)}),s=k({get:()=>o.entitySelector,set:l=>t("update:entitySelector",l)}),c=q([]);$(c,()=>{var p,f;const l=(p=c.value)==null?void 0:p.at(0);s.value={prop:s.value.prop,value:l?(f=n.value)==null?void 0:f.toPropValue(l):""}}),$(n,()=>{c.value=[]});function v(l){_.value=l.technicalName}return(l,p)=>{var d;const f=A,L=ee,B=D("auto-animate");return F((u(),m("div",Ce,[a("section",null,[Se,a("div",Be,[(u(!0),m(Y,null,Z(r(O),y=>(u(),P(we,{key:y.technicalName,entity:y,selected:y.technicalName===_.value,onClick:tt=>v(y)},null,8,["entity","selected","onClick"]))),128))])]),i.value?(u(),m("section",Ve,[Le,F((u(),m("div",$e,[a("div",Ee,[a("div",Ne,[g(f,{label:"Селектор",modelValue:s.value.prop,"onUpdate:modelValue":p[0]||(p[0]=y=>s.value.prop=y),options:(d=i.value)==null?void 0:d.availableSelectorProps},null,8,["modelValue","options"])])]),a("div",xe,[n.value?(u(),m("div",{class:"entity-selection-view__selector",key:n.value.value},[g(L,{label:"Значение (только одно)",modelValue:c.value,"onUpdate:modelValue":p[1]||(p[1]=y=>c.value=y),"label-keys":n.value.labelKeys,"fetch-function":n.value.fetchFunction,"max-count":1},null,8,["modelValue","label-keys","fetch-function"])])):V("",!0)])])),[[B]])])):V("",!0)])),[[B]])}}});const qe=C(Fe,[["__scopeId","data-v-0e8f930b"]]),J=e=>(j("data-v-d127b1bd"),e=e(),K(),e),Pe={class:"create-binding-view"},Te={class:"create-binding-view__form"},Oe={class:"row"},Ue={class:"col-md-6"},Ge={class:"create-binding-view__form-field"},ze={class:"col-md-3"},Me={class:"create-binding-view__form-field"},De={class:"col-md-3"},Ae={class:"create-binding-view__form-field"},je={class:"row"},Ke={class:"col-md-12"},Re={class:"create-binding-view__form-field"},Je={class:"row"},Qe={class:"col-md-6"},He=J(()=>a("h3",null,"Google-Аккаунт",-1)),We={key:1,class:"create-binding-view__form-field"},Xe={class:"col-md-6"},Ye=J(()=>a("h3",null,"Статус",-1)),Ze={class:"create-binding-view__buttons"},et=I({__name:"create-binding-view",setup(e){const t=te(),o=[{value:"hourly",label:"Ежечасно"},{value:"daily",label:"Ежедневно"},{value:"weekly",label:"Еженедельно"},{value:"monthly",label:"Ежемесячно"}],i=[{value:"csv",label:"CSV (формат файлов Excel)"}],n=k({get:()=>t.createBindingForm.status==="active",set:_=>t.createBindingForm.status=_?"active":"inactive"});return(_,s)=>{const c=ne,v=A,l=ge,p=re,f=oe,L=z,B=D("auto-animate");return u(),m("div",Pe,[a("div",Te,[a("div",Oe,[a("div",Ue,[a("div",Ge,[g(c,{modelValue:r(t).createBindingForm.name,"onUpdate:modelValue":s[0]||(s[0]=d=>r(t).createBindingForm.name=d),label:"Название интеграции",type:"text"},null,8,["modelValue"])])]),a("div",ze,[a("div",Me,[g(v,{modelValue:r(t).createBindingForm.frequency,"onUpdate:modelValue":s[1]||(s[1]=d=>r(t).createBindingForm.frequency=d),label:"Частота обновления",options:o},null,8,["modelValue"])])]),a("div",De,[a("div",Ae,[g(v,{modelValue:r(t).createBindingForm.format,"onUpdate:modelValue":s[2]||(s[2]=d=>r(t).createBindingForm.format=d),label:"Формат",options:i},null,8,["modelValue"])])])]),a("div",je,[a("div",Ke,[a("div",Re,[g(qe,{"entity-name":r(t).createBindingForm.entityName,"onUpdate:entityName":s[3]||(s[3]=d=>r(t).createBindingForm.entityName=d),"entity-selector":r(t).createBindingForm.entitySelector,"onUpdate:entitySelector":s[4]||(s[4]=d=>r(t).createBindingForm.entitySelector=d)},null,8,["entity-name","entity-selector"])])])]),a("div",Je,[F((u(),m("div",Qe,[He,r(t).createBindingForm.googleOAuthToken?(u(),P(l,{key:0},{default:E(()=>[N(" Вы успешно авторизовались в Google ")]),_:1})):(u(),m("div",We,[g(p,{onLogin:s[5]||(s[5]=d=>r(t).onGoogleLogin(d))})]))])),[[B]]),a("div",Xe,[Ye,g(f,{modelValue:n.value,"onUpdate:modelValue":s[6]||(s[6]=d=>n.value=d),label:"Активировать интеграцию"},null,8,["modelValue"])])]),a("div",Ze,[g(L,{alignment:"right",onClick:s[7]||(s[7]=d=>r(t).saveBinding())},{default:E(()=>[N(" Создать интеграцию ")]),_:1})])])])}}});const ot=C(et,[["__scopeId","data-v-d127b1bd"]]);export{ot as default};
