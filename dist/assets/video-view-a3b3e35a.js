import{d as w,C as h,r as b,w as P,a as v,i as p,j as u,t as z,O as T,A as G,p as L,l as M,g as a,_ as V,c as S,e as k,y as C,P as H,E as O,v as x,u as r,Q as A,f as E,R as N,T as q,U as Q,q as W,s as X,V as Z,b as R,o as J,W as K,X as ee,G as oe,Y as D,H as te,Z as ne,$ as se,a0 as ie,a1 as ae,a2 as de,M as ce}from"./index-7873ec56.js";const F=t=>(L("data-v-b7fc29e3"),t=t(),M(),t),_e={key:0},le=F(()=>a("span",{class:"add-video-to-saved-button__text"},"Добавлено в избранное",-1)),re={key:1},ue=F(()=>a("span",{class:"add-video-to-saved-button__text"},"Добавить в избранное",-1)),ve={key:2},me=w({__name:"add-video-to-saved-button",props:{videoId:{}},setup(t){const s=t,e=h.Services.Video,m=h.Services.UI,n=b("loading");P(()=>s.videoId,async()=>{await c()},{immediate:!0});async function i(){if(n.value==="loading")return;const d=n.value;n.value="loading";try{d==="added"?(await e.removeFromSavedVideos(s.videoId),n.value="not-added"):(await e.addToSavedVideos(s.videoId),n.value="added")}catch(l){m.openErrorModal("Не удалось добавить или убрать видео в избранное",l.message)}finally{n.value==="loading"&&(n.value=d)}}async function c(){try{const d=await e.isSaved(s.videoId);n.value=d.data?"added":"not-added"}catch{n.value="not-added"}}return(d,l)=>{const g=T,y=G;return v(),p("div",{class:z(["add-video-to-saved-button",n.value]),onClick:l[0]||(l[0]=f=>i())},[n.value==="added"?(v(),p("span",_e,[u(g,{name:"check-green"}),le])):n.value==="not-added"?(v(),p("span",re,[u(g,{name:"add"}),ue])):(v(),p("span",ve,[u(y,{contrast:""})]))],2)}}});const pe=V(me,[["__scopeId","data-v-b7fc29e3"]]),ye={class:"video-comment-form"},fe={class:"video-comment-form__input"},ge={class:"video-comment-form__actions"},U=512,he=w({__name:"video-comment-form",props:{videoId:{}},emits:["comment-created"],setup(t,{emit:s}){const e=t,m=s,n=h.Services.Video,i=h.Services.UI,c=b(""),d=S(()=>c.value.trim()),l=b(!1);async function g(){if(!(!d.value||d.value.length>U)){l.value=!0;try{await n.createComment(e.videoId,d.value),c.value="",m("comment-created")}catch(y){i.openErrorModal("Не удалось отправить комментарий",y.message)}finally{l.value=!1}}}return(y,f)=>{const $=H,_=O;return v(),p("div",ye,[a("div",fe,[u($,{label:"Оставить комментарий",modelValue:c.value,"onUpdate:modelValue":f[0]||(f[0]=o=>c.value=o),validators:[o=>o.length>0||"Комментарий не может быть пустым",o=>o.length<=U||"Комментарий слишком длинный"],readonly:l.value},null,8,["modelValue","validators","readonly"])]),a("div",ge,[u(_,{onClick:f[1]||(f[1]=o=>g()),design:"primary",alignment:"right",loading:l.value},{default:k(()=>[C(" Отправить ")]),_:1},8,["loading"])])])}}});const $e=V(he,[["__scopeId","data-v-fdb059ec"]]),be={class:"video-comment"},we={class:"video-comment__user"},Ce={class:"video-comment__text"},xe={class:"video-comment__date"},Se={key:0},Ve=w({__name:"video-comment",props:{comment:{}},emits:["delete"],setup(t,{emit:s}){const e=t,m=s,n=S(()=>{var d;return h.Context.User.id===((d=e.comment.user)==null?void 0:d.id)||h.Context.roleIs(["admin","teacher"])}),i=b(!1);function c(){i.value?m("delete",e.comment.id):i.value=!0}return(d,l)=>{const g=q,y=T,f=Q;return v(),p(N,null,[a("div",be,[a("div",we,[u(g,{user:d.comment.user},null,8,["user"])]),a("div",Ce,x(d.comment.text),1),a("div",xe,[C(x(r(A)(d.comment.createdAt,{precision:"minute"}).toBeautiful())+" ",1),n.value?(v(),p("span",Se,[C(" ⋅ "),u(y,{class:"video-comment__delete-button",name:"delete",onClick:l[0]||(l[0]=$=>c())})])):E("",!0)])]),u(f,{visible:i.value,"onUpdate:visible":l[1]||(l[1]=$=>i.value=$),onConfirm:l[2]||(l[2]=$=>c())},{title:k(()=>[C(" Удаление комментария ")]),text:k(()=>[C(' Вы уверены, что хотите удалить комментарий "'+x(d.comment.text)+'"? ',1)]),_:1},8,["visible"])],64)}}});const Ie=V(Ve,[["__scopeId","data-v-99babd5a"]]),ke=t=>(L("data-v-076cd09a"),t=t(),M(),t),Le={class:"video-comment-list"},Me=ke(()=>a("div",{class:"video-comment-list__title"},[a("h3",null,"Комментарии")],-1)),Ee={class:"video-comment-list__items"},Re={key:0,class:"video-comment-list__empty"},Be=w({__name:"video-comment-list",props:{comments:{}},emits:["delete-comment"],setup(t){return(s,e)=>{const m=Ie,n=W("auto-animate");return v(),p("div",Le,[Me,X((v(),p("div",Ee,[(v(!0),p(N,null,Z(s.comments,i=>(v(),R(m,{key:i.id,comment:i,onDelete:e[0]||(e[0]=c=>s.$emit("delete-comment",c))},null,8,["comment"]))),128))])),[[n]]),s.comments.length===0?(v(),p("p",Re," Комментариев пока нет ")):E("",!0)])}}});const De=V(Be,[["__scopeId","data-v-076cd09a"]]),Ue={class:"yandex-video-player"},Pe=w({__name:"yandex-video-player",props:{video:{},autoplay:{type:Boolean}},setup(t){const s=t,e=S(()=>`https://runtime.video.cloud.yandex.net/player/video/${s.video.uniqueIdentifier}`),m=b(null);let n=null;return J(()=>{n=Ya.playerSdk.init({element:m.value,source:e.value,autoplay:s.autoplay||!1})}),K(()=>{n&&n.destroy()}),(i,c)=>(v(),p("div",Ue,[a("div",{class:"yandex-video-player__player-root",ref_key:"playerRef",ref:m},null,512)]))}});const Te=V(Pe,[["__scopeId","data-v-28e754aa"]]),Ae=w({__name:"video-player",props:{video:{}},setup(t){const s=t,e=S(()=>{switch(s.video.serviceType){case"yandex":default:return Te}});return(m,n)=>(v(),R(ee(e.value),{video:m.video},null,8,["video"]))}}),Ne=oe("nootube-module:video",()=>{const t=h.Services.UI,s=h.Services.Video,e=b(null),m=b(null),n=D(l,{immediate:!1}),i=D(d);async function c(_){try{const o=await s.getVideo(_,{showLoader:!0});e.value=o.data,await $()}catch(o){t.openErrorModal("Ошибка при загрузке видео",o==null?void 0:o.message)}}async function d(_){try{return s.getVideos(_)}catch(o){t.openErrorModal("Ошибка при загрузке похожих видео",o==null?void 0:o.message)}}async function l(_){if(e.value)try{return s.getVideoComments(e.value.id,_)}catch(o){t.openErrorModal("Ошибка при загрузке комментариев",o==null?void 0:o.message)}}async function g(_){try{await s.deleteComment(_,{showLoader:!0}),n.trigger()}catch(o){t.openErrorModal("Ошибка при удалении комментария",o==null?void 0:o.message)}}const y=b(!1);async function f(_){if(e.value){y.value=!0;try{const o=await s.toggleReaction(e.value.id,_);e.value.myReaction=e.value.myReaction===_?null:_,e.value.reactionCounts=o.data}catch(o){t.openErrorModal("Не удалось отреагировать на видео",o.message)}finally{y.value=!1}}}async function $(){if(e.value)try{const _=await s.getAccessInfo(e.value.id,{showLoader:!0});m.value=_.data}catch(_){t.openErrorModal("Ошибка при загрузке информации о доступе",_==null?void 0:_.message)}}return{video:e,accessInfo:m,comments:n,similarVideos:i,fetchVideo:c,deleteComment:g,react:f,reactionsLoading:y}}),qe=t=>(L("data-v-8365bfab"),t=t(),M(),t),Fe={key:0,class:"video-view"},Ye={class:"video-view__player"},je={class:"video-view__comments"},ze={class:"video-view__comments__list"},Ge={class:"video-view__comments__form"},He={class:"video-view__info"},Oe={class:"video-view__info__back-button"},Qe={class:"video-view__info__title"},We={class:"video-view__info__author"},Xe={class:"video-view__info__main"},Ze={class:"video-view__info__actions"},Je={key:0,class:"video-view__info__link"},Ke={class:"video-view__info__description"},eo={key:1,class:"video-view__not-found"},oo=qe(()=>a("h4",null,"Видео не найдено",-1)),to=w({__name:"video-view",setup(t){const s=te(),e=Ne();P(()=>s.params.id,async()=>{var i;await e.fetchVideo(s.params.id),e.comments.trigger(),se(`НОО.Tube - ${(i=e.video)==null?void 0:i.title}`)},{immediate:!0});const m=S(()=>{var i;return h.Constants.APP_URL+`/nootube/video/${(i=e.video)==null?void 0:i.id}`}),n=S(()=>{var i;return`https://runtime.video.cloud.yandex.net/player/video/${(i=e.video)==null?void 0:i.uniqueIdentifier}`});return(i,c)=>{var B;const d=Ae,l=De,g=$e,y=ie,f=q,$=pe,_=ae,o=de,Y=ce,j=ne("nothing-found");return r(e).video?(v(),p("div",Fe,[a("div",Ye,[(v(),R(d,{video:r(e).video,key:r(e).video.id},null,8,["video"]))]),a("div",je,[a("div",ze,[u(l,{comments:r(e).comments.results,onDeleteComment:c[0]||(c[0]=I=>r(e).deleteComment(I))},null,8,["comments"])]),a("div",Ge,[u(g,{"video-id":r(e).video.id,onCommentCreated:c[1]||(c[1]=I=>r(e).comments.trigger())},null,8,["video-id"])])]),a("div",He,[a("div",Oe,[u(y,{to:"/nootube"},{default:k(()=>[C(" Назад к списку видео ")]),_:1})]),a("h1",Qe,x(r(e).video.title),1),a("div",We,[u(f,{user:r(e).video.uploadedBy},null,8,["user"])]),a("div",Xe," Опубликовано "+x(r(A)(r(e).video.publishedAt,{precision:"day"}).toBeautiful())+" • "+x((B=r(e).accessInfo)==null?void 0:B.text),1),a("div",Ze,[u($,{"video-id":r(e).video.id},null,8,["video-id"]),u(_,{reactions:r(e).video.reactionCounts,"my-reaction":r(e).video.myReaction,loading:r(e).reactionsLoading,onReact:c[2]||(c[2]=I=>r(e).react(I))},null,8,["reactions","my-reaction","loading"])]),r(h).Context.roleIs(["admin","teacher"])?(v(),p("div",Je,[u(o,{label:"Ссылка на видео","model-value":m.value,type:"text",readonly:"","copy-button":""},null,8,["model-value"]),u(o,{label:"Ссылка на видео для вставки в виде плеера","model-value":n.value,type:"text",readonly:"","copy-button":""},null,8,["model-value"])])):E("",!0),a("div",Ke,[u(Y,{content:r(e).video.description,"no-padding":""},null,8,["content"])])])])):(v(),p("div",eo,[u(j),oo]))}}});const so=V(to,[["__scopeId","data-v-8365bfab"]]);export{so as default};
