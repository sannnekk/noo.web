import{d as W,C as g,P as x,O as I,r as L,c as M,L as $}from"./index-227761f5.js";const O=W("create-work-module:create-work",()=>{const u=g.Services.Work,r=g.Services.UI,o=x(),s=I(),d=[{value:"trial-work",label:"Пробник"},{value:"mini-test",label:"Мини-зачет"},{value:"test",label:"Тест"},{value:"second-part",label:"Вторая часть"},{value:"phrase",label:"Фраза"}],c=()=>({name:"",description:"",tasks:[],type:"trial-work",solveHint:"",checkHint:""}),t=L(c()),i=M(()=>s.params.taskSlug?s.path.split("/").slice(0,-1).join("/"):s.path);async function v(){if(!s.params.workSlug){t.value=c();return}r.setLoading(!0);try{const e=await u.getWork(s.params.workSlug);if(!e.data){r.openErrorModal("Работа не найдена");return}t.value=e.data}catch{t.value=c(),r.openErrorModal("Произошла ошибка при загрузке работы")}finally{r.setLoading(!1)}}function f(){return{order:t.value.tasks.length+1,content:{ops:[{insert:`
`}]},slug:$(),highestScore:1,type:"word",solveHint:{ops:[{insert:`
`}]},checkHint:{ops:[{insert:`
`}]},checkingStrategy:"type1",rightAnswer:"",createdAt:new Date,updatedAt:new Date,workId:""}}function h(e){return t.value.tasks.find(a=>a.slug===e)}function w(){t.value.tasks.push(f())}function m(e){t.value.tasks=t.value.tasks.filter(a=>a.slug!==e)}function y(){var l;if(!t.value)return;const e=s.params.taskSlug,a=t.value.tasks.findIndex(p=>p.slug===e),n=(l=t.value.tasks.at(a+1))==null?void 0:l.slug;if(!n)return;const k=`${i.value}/${n}`;o.push(k)}function S(){var l;if(!t.value)return;const e=s.params.taskSlug,a=t.value.tasks.findIndex(p=>p.slug===e),n=(l=t.value.tasks.at(a-1))==null?void 0:l.slug;if(!n)return;const k=`${i.value}/${n}`;o.push(k)}function T(){o.push(`${i.value}/general-info`)}async function b(){const e=t.value;if(!e.name.trim()){r.openWarningModal("У работы должно быть название");return}if(!e.tasks.length){r.openWarningModal("У работы должны быть задания");return}if(r.setLoading(!0),e.tasks=e.tasks.map((a,n)=>({...a,order:n+1})),s.params.workSlug&&s.params.workSlug.length)try{await u.updateWork(t.value.id,e),o.push("/create-work/success")}catch(a){r.openErrorModal("Произошла ошибка при обновлении работы",a.message)}finally{r.setLoading(!1)}else try{await u.createWork(e),o.push("/create-work/success")}catch(a){r.openErrorModal("Произошла ошибка при создании работы",a.message)}finally{r.setLoading(!1)}}return{work:t,addTask:w,removeTask:m,getTask:h,submitWork:b,fetchWork:v,workTypeOptions:d,checkingStrategyOptions:[{label:"1 символ неверный: 0 б.",value:"type1"},{label:"1 символ неверный: -1 б.",value:"type2"},{label:"1 символ неверный, включая лишний/недостающий: -1 б.",value:"type3"},{label:"Последовательность",value:"type4"}],toNextTask:y,toPrevTask:S,showGeneralInfo:T}});export{O as u};
