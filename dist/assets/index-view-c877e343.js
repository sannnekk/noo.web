import{_ as G}from"./tabs-view-9c503450.js";import{d as I,C as w,u as x,r as f,c as b,a as U,o as y,b as $,e as a,f as r,g as t,h as F,w as k,t as L,_ as T,i as H,j as E,k as D,p as J,l as K,m as W,n as Q,q as R,s as B,v as X,F as Y,x as Z,y as ee}from"./index-d17ade26.js";import{_ as te}from"./entity-table-7112252a.js";import"./useDate-126c6fe0.js";const O=I("assigned-works-module:assigned-works",()=>{const p=w.Services.AssignedWork,e=w.Services.UI;function u(o){return async function(g){try{return await p.getAssignedWorks({...g||{},...o||{}})}catch(d){e.openErrorModal("Ошибка при загрузке списка работ",d.message)}}}const s=x(u({"filter[isArchived]":{type:"boolean",value:!1}}),{immediate:!0}),l=f([]),c=b(()=>l.value.map(o=>s.results.value.find(g=>g.id===o)).filter(Boolean)),i=x(u({"filter[solveStatus]":{type:"arr",value:["not-started","in-progress"]},"filter[isArchived]":{type:"boolean",value:!1}}),{immediate:!1}),n=f([]),_=b(()=>n.value.map(o=>i.results.value.find(g=>g.id===o)).filter(Boolean)),m=x(u({"filter[checkStatus]":{type:"arr",value:["not-checked","in-progress"]},"filter[isArchived]":{type:"boolean",value:!1}}),{immediate:!1}),S=f([]),h=b(()=>S.value.map(o=>m.results.value.find(g=>g.id===o)).filter(Boolean)),v=x(u({"filter[checkStatus]":{type:"arr",value:["checked-in-deadline","checked-after-deadline","checked-automatically"]},"filter[isArchived]":{type:"boolean",value:!1}}),{immediate:!1}),V=f([]),N=b(()=>V.value.map(o=>v.results.value.find(g=>g.id===o)).filter(Boolean)),C=x(u({"filter[isArchived]":{type:"boolean",value:!0}}),{immediate:!1}),M=f([]),j=b(()=>M.value.map(o=>C.results.value.find(g=>g.id===o)).filter(Boolean));function P(o){const g=w.Context.User.role;return g==="admin"||g==="teacher"||o.isArchived?{action:"Просмотреть",link:d=>`/assigned-works/${d}/read`,icon:"delete"}:g==="mentor"?o.solveStatus==="not-started"||o.solveStatus==="in-progress"?{action:"Просмотреть",link:d=>`/assigned-works/${d}/read`,icon:"cross-red"}:o.checkStatus==="not-checked"&&(o.solveStatus==="made-in-deadline"||o.solveStatus==="made-after-deadline")?{action:"Ожидает проверки",link:d=>`/assigned-works/${d}/check`,icon:"attention-yellow"}:o.checkStatus==="not-checked"?{action:"Проверить",link:d=>`/assigned-works/${d}/check`,icon:"attention-yellow"}:o.checkStatus==="in-progress"?{action:"Продолжить проверку",link:d=>`/assigned-works/${d}/check`,icon:"attention-yellow"}:{action:"Просмотреть",link:d=>`/assigned-works/${d}/read`,icon:"check-green"}:o.solveStatus==="not-started"?{action:"Начать выполнение",link:d=>`/assigned-works/${d}/solve`,icon:"cross-red"}:o.solveStatus==="in-progress"?{action:"Продолжить выполнение",link:d=>`/assigned-works/${d}/solve`,icon:"cross-red"}:o.checkStatus==="not-checked"&&(o.solveStatus==="made-in-deadline"||o.solveStatus==="made-after-deadline")?{action:"Ожидает проверки",link:d=>`/assigned-works/${d}/read`,icon:"attention-yellow"}:{action:"Просмотреть",link:d=>`/assigned-works/${d}/read`,icon:"check-green"}}async function q(o){e.setLoading(!0);try{await Promise.all(o.map(g=>p.archiveAssignedWork(g.id))),e.openSuccessModal("Работы успешно архивированы!")}catch(g){e.openErrorModal("Ошибка при архивировании работ",g.message)}finally{e.setLoading(!1)}}function z(o){switch(o){case 0:s.triggerOnce();break;case 1:i.triggerOnce();break;case 2:m.triggerOnce();break;case 3:v.triggerOnce();break;case 4:C.triggerOnce();break}}return{allSearch:s,allSearchChecklist:l,allSearchSelectedWorks:c,notSolvedSearch:i,notSolvedSearchChecklist:n,notSolvedSearchSelectedWorks:_,notCheckedSearch:m,notCheckedSearchChecklist:S,notCheckedSearchSelectedWorks:h,archivedSearch:C,archivedSearchChecklist:M,archivedSearchSelectedWorks:j,checkedSearch:v,checkedSearchChecklist:V,checkedSearchSelectedWorks:N,getUserAction:P,archiveWorks:q,changeTab:z}}),se={class:"works-table"},ne={class:"works-table__table"},A=U({__name:"works-table",props:{works:{},loading:{type:Boolean},getUserActionFunction:{type:Function},editable:{type:Boolean}},emits:["select"],setup(p,{emit:e}){const u=p,s=[{title:"",value:i=>u.getUserActionFunction(i).icon,type:"icon"},{title:"Название работы / Ученик / Куратор(ы)",keys:["work.name","student.name","mentors.each.name"],join:"<br>",type:"text",style:["redo","secondary","secondary"]},{title:"Дедлайн сдачи/проверки",keys:["solveDeadlineAt","checkDeadlineAt"],type:"date"},{title:"Статус работы",keys:["solveStatus","checkStatus"],type:"tag",tagFunction:l},{title:"Результат",keys:["score","maxScore"],join:"/",style:"centered",type:"text"},{title:"",value:i=>u.getUserActionFunction(i).action,type:"link",linkTo:i=>u.getUserActionFunction(i).link(i.id)}];function l(i,n){return n==="made-in-deadline"?{type:"success",text:"Сдано в дедлайн"}:n==="made-after-deadline"?{type:"danger",text:"Сдано не в дедлайн"}:n==="checked-in-deadline"?{type:"info",text:"Проверено в дедлайн"}:n==="checked-after-deadline"?{type:"warning",text:"Проверено не в дедлайн"}:n==="checked-automatically"?{type:"info",text:"Проверено автоматически"}:n==="not-made"?{type:"warning",text:"Не сдано"}:n==="not-checked"?{type:"info",text:"Не проверено"}:{type:"info",text:"-"}}function c(i){e("select",i)}return(i,n)=>{var m;const _=te;return y(),$("div",se,[a("div",ne,[r(_,{cols:s,data:i.works,"is-loading":i.loading,"tag-function":l,editable:((m=t(w).Context.User)==null?void 0:m.role)==="mentor"&&i.editable,onSelect:n[0]||(n[0]=S=>c(S))},null,8,["data","is-loading","editable"])])])}}}),ie=I("assigned-works-module:transfer-work",()=>{const p=w.Services.AssignedWork,e=w.Services.UI,u=w.Services.User;async function s(h){try{return await u.getMentors(h)}catch(v){e.openErrorModal("Ошибка при загрузке списка менторов",v.message)}}const{results:l,resultsMeta:c,isListLoading:i,pagination:n}=x(s,{immediate:!1}),_=f("");async function m(h){if(!_.value){e.openWarningModal("Выберите ментора");return}e.setLoading(!0);try{await p.transferAssignedWork(h,_.value),e.openSuccessModal("Работа успешно передана другому ментору")}catch(v){e.openErrorModal("Ошибка при передаче работы",v.message)}finally{e.setLoading(!1)}}async function S(h){e.setLoading(!0);try{await Promise.all(h.map(v=>p.transferAssignedWork(v.id,_.value))),e.openSuccessModal("Работы успешно переданы другому ментору")}catch(v){e.openErrorModal("Ошибка при передаче работ",v.message)}finally{e.setLoading(!1)}}return{pagination:n,results:l,resultsMeta:c,isListLoading:i,selectedMentorId:_,transfer:m,transferWorks:S}}),ae=p=>(J("data-v-b86c89c7"),p=p(),K(),p),oe=ae(()=>a("h2",null,"Передать работы",-1)),le={class:"transfer-assigned-work-modal__label"},re={class:"transfer-assigned-work-modal__select"},ce={class:"transfer-assigned-work-modal__select__search"},de={class:"transfer-assigned-work-modal__select__list"},ue={class:"transfer-assigned-work-modal__select__pagination"},_e=U({__name:"transfer-assigned-work-modal",props:{visible:{type:Boolean},assignedWorks:{}},emits:["update:visible"],setup(p,{emit:e}){const u=p,s=ie(),l=b({get:()=>u.visible,set:c=>e("update:visible",c)});return(c,i)=>{const n=T,_=H,m=E,S=D;return y(),F(S,{visible:l.value,"onUpdate:visible":i[3]||(i[3]=h=>l.value=h),onConfirm:i[4]||(i[4]=h=>t(s).transferWorks(c.assignedWorks))},{title:k(()=>[oe]),text:k(()=>[a("div",le," Выбрано работ: "+L(c.assignedWorks.length),1),a("div",re,[a("div",ce,[r(n,{modelValue:t(s).pagination.search,"onUpdate:modelValue":i[0]||(i[0]=h=>t(s).pagination.search=h),"is-loading":t(s).isListLoading},null,8,["modelValue","is-loading"])]),a("div",de,[r(_,{modelValue:t(s).selectedMentorId,"onUpdate:modelValue":i[1]||(i[1]=h=>t(s).selectedMentorId=h),items:t(s).results,"item-label-key":"name,username","item-key":"id"},null,8,["modelValue","items"])]),a("div",ue,[r(m,{page:t(s).pagination.page,"onUpdate:page":i[2]||(i[2]=h=>t(s).pagination.page=h),total:t(s).resultsMeta.total,limit:t(s).pagination.limit},null,8,["page","total","limit"])])])]),_:1},8,["visible"])}}});const ge=W(_e,[["__scopeId","data-v-b86c89c7"]]),pe=a("h2",null,"Архивировать работы",-1),he={class:"archive-works-modal__label"},ve=U({__name:"archive-works-modal",props:{visible:{type:Boolean},assignedWorks:{}},emits:["update:visible"],setup(p,{emit:e}){const u=p,s=O(),l=b({get:()=>u.visible,set:c=>e("update:visible",c)});return(c,i)=>{const n=D;return y(),F(n,{visible:l.value,"onUpdate:visible":i[0]||(i[0]=_=>l.value=_),onConfirm:i[1]||(i[1]=_=>t(s).archiveWorks(c.assignedWorks))},{title:k(()=>[pe]),text:k(()=>[a("div",he," Выбрано работ: "+L(c.assignedWorks.length),1)]),_:1},8,["visible"])}}}),ke={class:"actions-with-selected"},me={key:0,class:"actions-with-selected__inner"},Se={class:"actions-with-selected__label"},fe={class:"actions-with-selected__actions"},we=U({__name:"actions-with-selected",props:{selectedAssignedWorks:{}},setup(p){const e=f(!1),u=f(!1);return(s,l)=>{var n;const c=Z,i=Q("auto-animate");return y(),$(Y,null,[R((y(),$("div",ke,[s.selectedAssignedWorks.length&&((n=t(w).Context.User)==null?void 0:n.role)==="mentor"?(y(),$("div",me,[a("p",Se," Выбрано: "+L(s.selectedAssignedWorks.length),1),a("div",fe,[r(c,{design:"danger",onClick:l[0]||(l[0]=_=>u.value=!0)},{default:k(()=>[B(" Архивировать ")]),_:1}),r(c,{design:"secondary",onClick:l[1]||(l[1]=_=>e.value=!0)},{default:k(()=>[B(" Передать другому куратору ")]),_:1})])])):X("",!0)])),[[i]]),r(ge,{"assigned-works":s.selectedAssignedWorks,visible:e.value,"onUpdate:visible":l[2]||(l[2]=_=>e.value=_)},null,8,["assigned-works","visible"]),r(ve,{"assigned-works":s.selectedAssignedWorks,visible:u.value,"onUpdate:visible":l[3]||(l[3]=_=>u.value=_)},null,8,["assigned-works","visible"])],64)}}});const be=W(we,[["__scopeId","data-v-9e8db9a6"]]),ye={class:"index-works-view"},xe={class:"index-works-view__header"},Ae={class:"index-works-view__header__search"},$e={class:"index-works-view__selected-actions"},Ue={class:"index-works-view__table"},Ce={class:"index-works-view__pagination"},Le={class:"index-works-view__header"},We={class:"index-works-view__header__search"},Ve={class:"index-works-view__table"},Me={class:"index-works-view__pagination"},Be={class:"index-works-view__header"},Ie={class:"index-works-view__header__search"},Fe={class:"index-works-view__table"},Te={class:"index-works-view__pagination"},Ee={class:"index-works-view__header"},De={class:"index-works-view__header__search"},Oe={class:"index-works-view__table"},Ne={class:"index-works-view__pagination"},je={class:"index-works-view__header"},Pe={class:"index-works-view__header__search"},qe={class:"index-works-view__table"},ze={class:"index-works-view__pagination"},Ge=U({__name:"index-view",setup(p){const e=O();return ee("Мои работы"),(u,s)=>{const l=T,c=E,i=G;return y(),$("div",ye,[r(i,{titles:["Все","Не решенные","Не проверенные","Проверенные","Архивированные"],onTabChange:s[11]||(s[11]=n=>t(e).changeTab(n))},{"tab-0":k(()=>[a("div",xe,[a("div",Ae,[r(l,{modelValue:t(e).allSearch.pagination.search,"onUpdate:modelValue":s[0]||(s[0]=n=>t(e).allSearch.pagination.search=n),"is-loading":t(e).allSearch.isListLoading},null,8,["modelValue","is-loading"])])]),a("div",$e,[r(be,{"selected-assigned-works":t(e).allSearchSelectedWorks},null,8,["selected-assigned-works"])]),a("div",Ue,[r(A,{works:t(e).allSearch.results,loading:t(e).allSearch.isListLoading,"get-user-action-function":t(e).getUserAction,onSelect:s[1]||(s[1]=n=>t(e).allSearchChecklist=n),editable:""},null,8,["works","loading","get-user-action-function"])]),a("div",Ce,[r(c,{page:t(e).allSearch.pagination.page,"onUpdate:page":s[2]||(s[2]=n=>t(e).allSearch.pagination.page=n),total:t(e).allSearch.resultsMeta.total,limit:t(e).allSearch.pagination.limit},null,8,["page","total","limit"])])]),"tab-1":k(()=>[a("div",Le,[a("div",We,[r(l,{modelValue:t(e).notSolvedSearch.pagination.search,"onUpdate:modelValue":s[3]||(s[3]=n=>t(e).notSolvedSearch.pagination.search=n),"is-loading":t(e).notSolvedSearch.isListLoading},null,8,["modelValue","is-loading"])])]),a("div",Ve,[r(A,{works:t(e).notSolvedSearch.results,loading:t(e).notSolvedSearch.isListLoading,"get-user-action-function":t(e).getUserAction},null,8,["works","loading","get-user-action-function"])]),a("div",Me,[r(c,{page:t(e).notSolvedSearch.pagination.page,"onUpdate:page":s[4]||(s[4]=n=>t(e).notSolvedSearch.pagination.page=n),total:t(e).notSolvedSearch.resultsMeta.total,limit:t(e).notSolvedSearch.pagination.limit},null,8,["page","total","limit"])])]),"tab-2":k(()=>[a("div",Be,[a("div",Ie,[r(l,{modelValue:t(e).notCheckedSearch.pagination.search,"onUpdate:modelValue":s[5]||(s[5]=n=>t(e).notCheckedSearch.pagination.search=n),"is-loading":t(e).notCheckedSearch.isListLoading},null,8,["modelValue","is-loading"])])]),a("div",Fe,[r(A,{works:t(e).notCheckedSearch.results,loading:t(e).notCheckedSearch.isListLoading,"get-user-action-function":t(e).getUserAction},null,8,["works","loading","get-user-action-function"])]),a("div",Te,[r(c,{page:t(e).notCheckedSearch.pagination.page,"onUpdate:page":s[6]||(s[6]=n=>t(e).notCheckedSearch.pagination.page=n),total:t(e).notCheckedSearch.resultsMeta.total,limit:t(e).notCheckedSearch.pagination.limit},null,8,["page","total","limit"])])]),"tab-3":k(()=>[a("div",Ee,[a("div",De,[r(l,{modelValue:t(e).checkedSearch.pagination.search,"onUpdate:modelValue":s[7]||(s[7]=n=>t(e).checkedSearch.pagination.search=n),"is-loading":t(e).checkedSearch.isListLoading},null,8,["modelValue","is-loading"])])]),a("div",Oe,[r(A,{works:t(e).checkedSearch.results,loading:t(e).checkedSearch.isListLoading,"get-user-action-function":t(e).getUserAction},null,8,["works","loading","get-user-action-function"])]),a("div",Ne,[r(c,{page:t(e).checkedSearch.pagination.page,"onUpdate:page":s[8]||(s[8]=n=>t(e).checkedSearch.pagination.page=n),total:t(e).checkedSearch.resultsMeta.total,limit:t(e).checkedSearch.pagination.limit},null,8,["page","total","limit"])])]),"tab-4":k(()=>[a("div",je,[a("div",Pe,[r(l,{modelValue:t(e).archivedSearch.pagination.search,"onUpdate:modelValue":s[9]||(s[9]=n=>t(e).archivedSearch.pagination.search=n),"is-loading":t(e).archivedSearch.isListLoading},null,8,["modelValue","is-loading"])])]),a("div",qe,[r(A,{works:t(e).archivedSearch.results,loading:t(e).archivedSearch.isListLoading,"get-user-action-function":t(e).getUserAction},null,8,["works","loading","get-user-action-function"])]),a("div",ze,[r(c,{page:t(e).archivedSearch.pagination.page,"onUpdate:page":s[10]||(s[10]=n=>t(e).archivedSearch.pagination.page=n),total:t(e).archivedSearch.resultsMeta.total,limit:t(e).archivedSearch.pagination.limit},null,8,["page","total","limit"])])]),_:1})])}}});const Re=W(Ge,[["__scopeId","data-v-6223067b"]]);export{Re as default};
