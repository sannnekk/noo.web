import{d as $,x as C,a as r,j as p,g as u,P as M,T as B,k as l,u as j,C as S,f as g,e as d,y as m,v as D,ab as N,a0 as F,O,Q as T,Y as A,p as G,l as P,_ as w,r as y,E as Q,G as Y,b as q,A as z}from"./index-b831295d.js";import{_ as H}from"./info-block-713151ac.js";import{S as I}from"./settings-section-5d2c589f.js";const V=_=>(G("data-v-b784389f"),_=_(),P(),_),J={class:"subject-list"},K={class:"subject-list__item__name"},R={key:0,class:"subject-list__item__actions"},W={class:"subject-list__item__actions__edit"},X={class:"subject-list__item__actions__delete"},Z={key:0,class:"subject-list__no-items"},ee=V(()=>u("p",null,"Пока нет предметов",-1)),te=[ee],se=V(()=>u("br",null,null,-1)),oe=V(()=>u("br",null,null,-1)),ne=$({__name:"subject-list",props:{subjects:{}},emits:["update-subject","delete-subject"],setup(_,{emit:s}){const b=s,e=C({subject:null,isOpen:!1}),o=C({subject:null,isOpen:!1});function v(t){e.subject=t,e.isOpen=!0}function c(t){o.subject=t,o.isOpen=!0}function f(){e.subject&&b("update-subject",e.subject),e.subject=null}function a(){o.subject&&b("delete-subject",o.subject),o.subject=null}return(t,i)=>{const E=N,k=F,h=O,x=T,L=A;return r(),p(M,null,[u("div",J,[(r(!0),p(M,null,B(t.subjects,n=>(r(),p("div",{class:"subject-list__item",key:n.id},[u("div",K,[l(E,{subject:n},null,8,["subject"])]),j(S).Context.roleIs(["admin"])?(r(),p("div",R,[u("div",W,[l(k,{name:"edit",onClick:U=>v(n)},null,8,["onClick"])]),u("div",X,[l(k,{name:"delete",onClick:U=>c(n)},null,8,["onClick"])])])):g("",!0)]))),128)),t.subjects.length===0?(r(),p("div",Z,te)):g("",!0)]),l(x,{visible:e.isOpen,"onUpdate:visible":i[2]||(i[2]=n=>e.isOpen=n),onConfirm:i[3]||(i[3]=n=>f())},{title:d(()=>[m("Изменить предмет")]),text:d(()=>[l(h,{label:"Название предмета",modelValue:e.subject.name,"onUpdate:modelValue":i[0]||(i[0]=n=>e.subject.name=n),type:"text"},null,8,["modelValue"]),l(h,{label:"Цвет предмета",modelValue:e.subject.color,"onUpdate:modelValue":i[1]||(i[1]=n=>e.subject.color=n),type:"color"},null,8,["modelValue"])]),_:1},8,["visible"]),l(x,{visible:o.isOpen,"onUpdate:visible":i[4]||(i[4]=n=>o.isOpen=n),onConfirm:i[5]||(i[5]=n=>a())},{title:d(()=>{var n;return[m(' Удалить предмет "'+D((n=o.subject)==null?void 0:n.name)+'" ',1)]}),text:d(()=>[l(L,null,{default:d(()=>[m(" Вы уверены, что хотите удалить предмет?"),se,m(" Это действие нельзя будет отменить. "),oe,m(" Перед удалением предмета нужно удалить все связанные с ним курсы и работы ")]),_:1})]),_:1},8,["visible"])],64)}}});const ce=w(ne,[["__scopeId","data-v-b784389f"]]),le={class:"create-subject-form"},ae={class:"row"},ue={class:"col-md-6 col-12"},ie={class:"create-subject-form__form-field"},_e={class:"col-md-3 col-6"},de={class:"create-subject-form__form-field"},re={class:"col-md-3 col-6"},me={class:"create-subject-form__actions"},be=$({__name:"create-subject-form",emits:["create-subject"],setup(_,{emit:s}){const b=s,e=y({name:"",color:""});function o(){b("create-subject",e.value)}return(v,c)=>{const f=O,a=Q;return r(),p("div",le,[u("div",ae,[u("div",ue,[u("div",ie,[l(f,{modelValue:e.value.name,"onUpdate:modelValue":c[0]||(c[0]=t=>e.value.name=t),type:"text",label:"Название предмета",validators:[t=>t.length>2||"Название предмета должно содержать минимум 3 символа",t=>t.length<101||"Название предмета должно содержать максимум 100 символов"]},null,8,["modelValue","validators"])])]),u("div",_e,[u("div",de,[l(f,{type:"color",modelValue:e.value.color,"onUpdate:modelValue":c[1]||(c[1]=t=>e.value.color=t),label:"Цвет предмета"},null,8,["modelValue"])])]),u("div",re,[u("div",me,[l(a,{onClick:c[2]||(c[2]=t=>o()),alignment:"stretch",design:"primary"},{default:d(()=>[m(" Создать ")]),_:1})])])])])}}});const pe=w(be,[["__scopeId","data-v-efa55358"]]),je=Y("settings-module:subjects",()=>{const _=S.Services.Subject,s=S.Services.UI,b=y([]),e=y(!1);async function o(){e.value=!0;try{const a=await _.getSubjects();b.value=a.data,e.value=!1}catch(a){s.openErrorModal("Ошибка при загрузке списка предметов",a.message)}}async function v(a){try{await _.createSubject(a,{showLoader:!0}),s.openSuccessModal("Предмет успешно создан"),await o()}catch(t){s.openErrorModal("Ошибка при создании предмета",t.message)}}async function c(a){try{await _.updateSubject(a.id,a,{showLoader:!0}),s.openSuccessModal("Предмет успешно обновлен"),await o()}catch(t){s.openErrorModal("Ошибка при обновлении предмета",t.message)}}async function f(a){console.log("deleteSubject",a);try{await _.deleteSubject(a.id,{showLoader:!0}),s.openSuccessModal("Предмет успешно удален"),await o()}catch(t){s.openErrorModal("Ошибка при удалении предмета",t.message)}}return{moduleLoading:e,subjects:b,fetchSubjects:o,createSubject:v,updateSubject:c,deleteSubject:f}}),ve={key:0,class:"subjects-view"},fe={class:"subjects-view__disclaimer"},Se={key:1,class:"subjects-view__loading"},ge=$({__name:"subjects-view",setup(_){const s=je();return s.fetchSubjects(),(b,e)=>{const o=H,v=z;return j(s).moduleLoading?(r(),p("div",Se,[l(v,{contrast:""})])):(r(),p("div",ve,[u("div",fe,[l(o,null,{default:d(()=>[m(" Добавлять, изменять и удалять предметы может только администратор ")]),_:1})]),l(I,null,{title:d(()=>[m("Предметы")]),content:d(()=>[l(ce,{subjects:j(s).subjects,onUpdateSubject:e[0]||(e[0]=c=>j(s).updateSubject(c)),onDeleteSubject:e[1]||(e[1]=c=>j(s).deleteSubject(c))},null,8,["subjects"])]),_:1}),j(S).Context.roleIs(["admin"])?(r(),q(I,{key:0},{title:d(()=>[m("Добавить предмет")]),content:d(()=>[l(pe,{onCreateSubject:e[2]||(e[2]=c=>j(s).createSubject(c))})]),_:1})):g("",!0)]))}}});const Ve=w(ge,[["__scopeId","data-v-baac840d"]]);export{Ve as default};
