import{d as I,C as w,r as b,w as U,a as m,i as p,j as l,t as z,O as R,A as G,p as x,l as E,g as a,_ as V,c as T,e as S,y as $,P as H,E as O,v as C,u as d,Q as A,f as M,R as N,T as F,U as Q,q as W,s as X,V as Y,b as P,G as Z,W as B,H as J,X as K,Y as ee,Z as oe,$ as te,a0 as ne,a1 as se,a2 as ie,M as ae}from"./index-50888d69.js";const j=n=>(x("data-v-b7fc29e3"),n=n(),E(),n),de={key:0},_e=j(()=>a("span",{class:"add-video-to-saved-button__text"},"Добавлено в избранное",-1)),ce={key:1},le=j(()=>a("span",{class:"add-video-to-saved-button__text"},"Добавить в избранное",-1)),me={key:2},re=I({__name:"add-video-to-saved-button",props:{videoId:{}},setup(n){const s=n,e=w.Services.Video,u=w.Services.UI,t=b("loading");U(()=>s.videoId,async()=>{await v()},{immediate:!0});async function r(){if(t.value==="loading")return;const i=t.value;t.value="loading";try{i==="added"?(await e.removeFromSavedVideos(s.videoId),t.value="not-added"):(await e.addToSavedVideos(s.videoId),t.value="added")}catch(_){u.openErrorModal("Не удалось добавить или убрать видео в избранное",_.message)}finally{t.value==="loading"&&(t.value=i)}}async function v(){try{const i=await e.isSaved(s.videoId);t.value=i.data?"added":"not-added"}catch{t.value="not-added"}}return(i,_)=>{const y=R,f=G;return m(),p("div",{class:z(["add-video-to-saved-button",t.value]),onClick:_[0]||(_[0]=g=>r())},[t.value==="added"?(m(),p("span",de,[l(y,{name:"check-green"}),_e])):t.value==="not-added"?(m(),p("span",ce,[l(y,{name:"add"}),le])):(m(),p("span",me,[l(f,{contrast:""})]))],2)}}});const ve=V(re,[["__scopeId","data-v-b7fc29e3"]]),ue={class:"video-comment-form"},pe={class:"video-comment-form__input"},fe={class:"video-comment-form__actions"},D=250,ge=I({__name:"video-comment-form",props:{videoId:{}},emits:["comment-created"],setup(n,{emit:s}){const e=n,u=s,t=w.Services.Video,r=w.Services.UI,v=b(""),i=T(()=>v.value.trim()),_=b(!1);async function y(){if(!(!i.value||i.value.length>D)){_.value=!0;try{await t.createComment(e.videoId,i.value),v.value="",u("comment-created")}catch(f){r.openErrorModal("Не удалось отправить комментарий",f.message)}finally{_.value=!1}}}return(f,g)=>{const h=H,c=O;return m(),p("div",ue,[a("div",pe,[l(h,{label:"Оставить комментарий",modelValue:v.value,"onUpdate:modelValue":g[0]||(g[0]=o=>v.value=o),validators:[o=>!o||"Комментарий не может быть пустым",o=>o.length<=D||"Комментарий слишком длинный"],readonly:_.value},null,8,["modelValue","validators","readonly"])]),a("div",fe,[l(c,{onClick:g[1]||(g[1]=o=>y()),design:"primary",alignment:"right",loading:_.value},{default:S(()=>[$(" Отправить ")]),_:1},8,["loading"])])])}}});const ye=V(ge,[["__scopeId","data-v-8021c46e"]]),he={class:"video-comment"},we={class:"video-comment__user"},$e={class:"video-comment__text"},be={class:"video-comment__date"},Ce={key:0},Se=I({__name:"video-comment",props:{comment:{}},emits:["delete"],setup(n,{emit:s}){const e=n,u=s,t=T(()=>{var i;return w.Context.User.id===((i=e.comment.user)==null?void 0:i.id)||w.Context.roleIs(["admin","teacher"])}),r=b(!1);function v(){r.value?u("delete",e.comment.id):r.value=!0}return(i,_)=>{const y=F,f=R,g=Q;return m(),p(N,null,[a("div",he,[a("div",we,[l(y,{user:i.comment.user},null,8,["user"])]),a("div",$e,C(i.comment.text),1),a("div",be,[$(C(d(A)(i.comment.createdAt,{precision:"minute"}).toBeautiful())+" ",1),t.value?(m(),p("span",Ce,[$(" ⋅ "),l(f,{class:"video-comment__delete-button",name:"delete",onClick:_[0]||(_[0]=h=>v())})])):M("",!0)])]),l(g,{visible:r.value,"onUpdate:visible":_[1]||(_[1]=h=>r.value=h),onConfirm:_[2]||(_[2]=h=>v())},{title:S(()=>[$(" Удаление комментария ")]),text:S(()=>[$(' Вы уверены, что хотите удалить комментарий "'+C(i.comment.text)+'"? ',1)]),_:1},8,["visible"])],64)}}});const Ie=V(Se,[["__scopeId","data-v-99babd5a"]]),Ve=n=>(x("data-v-076cd09a"),n=n(),E(),n),ke={class:"video-comment-list"},xe=Ve(()=>a("div",{class:"video-comment-list__title"},[a("h3",null,"Комментарии")],-1)),Ee={class:"video-comment-list__items"},Me={key:0,class:"video-comment-list__empty"},Le=I({__name:"video-comment-list",props:{comments:{}},emits:["delete-comment"],setup(n){return(s,e)=>{const u=Ie,t=W("auto-animate");return m(),p("div",ke,[xe,X((m(),p("div",Ee,[(m(!0),p(N,null,Y(s.comments,r=>(m(),P(u,{key:r.id,comment:r,onDelete:e[0]||(e[0]=v=>s.$emit("delete-comment",v))},null,8,["comment"]))),128))])),[[t]]),s.comments.length===0?(m(),p("p",Me," Комментариев пока нет ")):M("",!0)])}}});const Be=V(Le,[["__scopeId","data-v-076cd09a"]]),De=Z("nootube-module:video",()=>{const n=w.Services.UI,s=w.Services.Video,e=b(null),u=b(null),t=B(_,{immediate:!1}),r=B(i);async function v(c){try{const o=await s.getVideo(c,{showLoader:!0});e.value=o.data,await h()}catch(o){n.openErrorModal("Ошибка при загрузке видео",o==null?void 0:o.message)}}async function i(c){try{return s.getVideos(c)}catch(o){n.openErrorModal("Ошибка при загрузке похожих видео",o==null?void 0:o.message)}}async function _(c){if(e.value)try{return s.getVideoComments(e.value.id,c)}catch(o){n.openErrorModal("Ошибка при загрузке комментариев",o==null?void 0:o.message)}}async function y(c){try{await s.deleteComment(c,{showLoader:!0}),t.trigger()}catch(o){n.openErrorModal("Ошибка при удалении комментария",o==null?void 0:o.message)}}const f=b(!1);async function g(c){if(e.value){f.value=!0;try{const o=await s.toggleReaction(e.value.id,c);e.value.myReaction=c,e.value.reactionCounts=o.data}catch(o){n.openErrorModal("Не удалось отреагировать на видео",o.message)}finally{f.value=!1}}}async function h(){if(e.value)try{const c=await s.getAccessInfo(e.value.id,{showLoader:!0});u.value=c.data}catch(c){n.openErrorModal("Ошибка при загрузке информации о доступе",c==null?void 0:c.message)}}return{video:e,accessInfo:u,comments:t,similarVideos:r,fetchVideo:v,deleteComment:y,react:g,reactionsLoading:f}}),Ue=n=>(x("data-v-ee240a9b"),n=n(),E(),n),Re={key:0,class:"video-view"},Te={class:"video-view__player"},Ae={class:"video-view__comments"},Ne={class:"video-view__comments__list"},Fe={class:"video-view__comments__form"},Pe={class:"video-view__info"},je={class:"video-view__info__back-button"},qe={class:"video-view__info__title"},ze={class:"video-view__info__author"},Ge={class:"video-view__info__main"},He={class:"video-view__info__actions"},Oe={key:0,class:"video-view__info__link"},Qe={class:"video-view__info__description"},We={key:1,class:"video-view__not-found"},Xe=Ue(()=>a("h4",null,"Видео не найдено",-1)),Ye=I({__name:"video-view",setup(n){const s=J(),e=De();return U(()=>s.params.id,async()=>{var u;await e.fetchVideo(s.params.id),e.comments.trigger(),ee(`НОО.Tube - ${(u=e.video)==null?void 0:u.title}`)},{immediate:!0}),(u,t)=>{var L;const r=oe,v=Be,i=ye,_=te,y=F,f=ve,g=ne,h=se,c=ie,o=ae,q=K("nothing-found");return d(e).video?(m(),p("div",Re,[a("div",Te,[(m(),P(r,{video:d(e).video,key:d(e).video.id},null,8,["video"]))]),a("div",Ae,[a("div",Ne,[l(v,{comments:d(e).comments.results,onDeleteComment:t[0]||(t[0]=k=>d(e).deleteComment(k))},null,8,["comments"])]),a("div",Fe,[l(i,{"video-id":d(e).video.id,onCommentCreated:t[1]||(t[1]=k=>d(e).comments.trigger())},null,8,["video-id"])])]),a("div",Pe,[a("div",je,[l(_,{to:"/nootube"},{default:S(()=>[$(" Назад к списку видео ")]),_:1})]),a("h1",qe,C(d(e).video.title),1),a("div",ze,[l(y,{user:d(e).video.uploadedBy},null,8,["user"])]),a("div",Ge," Опубликовано "+C(d(A)(d(e).video.publishedAt,{precision:"day"}).toBeautiful())+" • "+C((L=d(e).accessInfo)==null?void 0:L.text),1),a("div",He,[l(f,{"video-id":d(e).video.id},null,8,["video-id"]),l(g,{reactions:d(e).video.reactionCounts,"my-reaction":d(e).video.myReaction,loading:d(e).reactionsLoading,onReact:t[2]||(t[2]=k=>d(e).react(k))},null,8,["reactions","my-reaction","loading"])]),d(w).Context.roleIs(["admin","teacher"])?(m(),p("div",Oe,[l(h,{label:"Ссылка на видео для вставки","model-value":d(e).video.url,type:"text",readonly:"","copy-button":""},null,8,["model-value"]),l(c,{class:"video-view__info__link__hint"},{default:S(()=>[$(" Видео рекомендуется вставлять не ссылкой, а с помощью функции вставки видео. Если нужна просто ссылка, а не плеер, рекомендуется просто использовать ссылку на эту страницу (содержимое адресной строки браузера) ")]),_:1})])):M("",!0),a("div",Qe,[l(o,{content:d(e).video.description,"no-padding":""},null,8,["content"])])])])):(m(),p("div",We,[l(q),Xe]))}}});const Je=V(Ye,[["__scopeId","data-v-ee240a9b"]]);export{Je as default};
