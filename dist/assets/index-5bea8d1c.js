import{a as V,c as P,r as h,n as E,o as p,b as g,e as o,f as d,q as B,h as x,w as $,s as C,v as y,$ as N,N as L,c7 as T,x as S,m as U,p as k,l as I,ae as D,F,k as q,d as W,C as w,y as j,g as u,I as z,bq as M}from"./index-d17ade26.js";import{_ as G}from"./statistics-view-37e9f081.js";import{_ as H}from"./password-criteria-965b10a3.js";import{_ as J}from"./user-card-82c32199.js";import"./select-input-c7f07e3e.js";const K={class:"profile-credentials"},O={class:"profile-credentials__avatar"},Q={class:"profile-credentials__name"},R={class:"profile-credentials__username"},X={class:"profile-credentials__email"},Y={class:"profile-credentials__telegram"},Z={class:"profile-credentials__role"},ee={class:"profile-credentials__save-button"},oe=V({__name:"profile-credentials",props:{modelValue:{}},emits:["update:modelValue","save"],setup(n,{emit:a}){const s=n,e=P({get:()=>s.modelValue,set:r=>a("update:modelValue",r)}),c=h(!1);function t(){c.value=!0}return(r,l)=>{const f=N,_=L,i=T,v=S,A=E("auto-animate");return p(),g("div",K,[o("div",O,[d(f,{src:e.value.avatar,name:e.value.name},null,8,["src","name"])]),o("div",Q,[d(_,{label:"Имя","onUpdate:modelValue":[l[0]||(l[0]=m=>t()),l[1]||(l[1]=m=>e.value.name=m)],modelValue:e.value.name,class:"input"},null,8,["modelValue"])]),o("div",R,[d(_,{label:"Никнейм",readonly:"",modelValue:e.value.username,"onUpdate:modelValue":l[2]||(l[2]=m=>e.value.username=m),class:"input"},null,8,["modelValue"])]),o("div",X,[d(_,{label:"Email","onUpdate:modelValue":[l[3]||(l[3]=m=>t()),l[4]||(l[4]=m=>e.value.email=m)],modelValue:e.value.email,class:"input"},null,8,["modelValue"])]),o("div",Y,[d(_,{label:"Telegram (В виде ника без @)","onUpdate:modelValue":[l[5]||(l[5]=m=>t()),l[6]||(l[6]=m=>e.value.telegramUsername=m)],modelValue:e.value.telegramUsername,class:"input"},null,8,["modelValue"])]),o("div",Z,[d(i,{role:e.value.role},null,8,["role"])]),B((p(),g("div",ee,[c.value?(p(),x(v,{key:0,alignment:"center",onClick:l[7]||(l[7]=m=>r.$emit("save"))},{default:$(()=>[C(" Сохранить ")]),_:1})):y("",!0)])),[[A]])])}}});const se=U(oe,[["__scopeId","data-v-ad0aa35d"]]),te=n=>(k("data-v-97c3af1a"),n=n(),I(),n),ne={class:"profile-password-form"},ae=te(()=>o("div",{class:"profile-password-form__header"},[o("h3",{class:"profile-password-form__header__title"},"Смена пароля")],-1)),le={class:"profile-password-form__form"},re={class:"profile-password-form__form__field"},de={class:"profile-password-form__form__field"},ie={class:"profile-password-form__form__field"},_e={class:"profile-password-form__form__field"},ue=V({__name:"profile-password-form",props:{modelValue:{}},emits:["update:modelValue","save"],setup(n,{emit:a}){const s=n,e=P({get:()=>s.modelValue,set:c=>a("update:modelValue",c)});return(c,t)=>{const r=L,l=H,f=S;return p(),g("div",ne,[ae,o("div",le,[o("div",re,[d(r,{type:"password",label:"Старый пароль",modelValue:e.value.oldPassword,"onUpdate:modelValue":t[0]||(t[0]=_=>e.value.oldPassword=_)},null,8,["modelValue"])]),o("div",de,[d(r,{type:"password",label:"Новый пароль",modelValue:e.value.newPassword,"onUpdate:modelValue":t[1]||(t[1]=_=>e.value.newPassword=_)},null,8,["modelValue"]),d(l,{password:e.value.newPassword},null,8,["password"])]),o("div",ie,[d(r,{type:"password",label:"Повторите новый пароль",modelValue:e.value.repeatPassword,"onUpdate:modelValue":t[2]||(t[2]=_=>e.value.repeatPassword=_)},null,8,["modelValue"])]),o("div",_e,[d(f,{alignment:"center",onClick:t[3]||(t[3]=_=>c.$emit("save"))},{default:$(()=>[C(" Сменить пароль ")]),_:1})])])])}}});const ce=U(ue,[["__scopeId","data-v-97c3af1a"]]),b=n=>(k("data-v-684e26cd"),n=n(),I(),n),pe={class:"delete-account"},me=b(()=>o("div",{class:"delete-account__header"},[o("h3",{class:"delete-account__header__title"},"Удаление аккаунта")],-1)),ve={class:"delete-account__body"},fe=b(()=>o("div",{class:"delete-account__body__warning"},[o("p",null," Все ваши данные будут удалены без возможности восстановления, включая все работы и всю статистику ")],-1)),we={class:"delete-account__body__button"},ge=b(()=>o("h2",null,"Вы уверены, что хотите удалить свой аккаунт?",-1)),$e=b(()=>o("p",null," Все ваши данные будут удалены без возможности восстановления, включая все работы и всю статистику ",-1)),Ve=V({__name:"delete-account",emits:["delete-account"],setup(n,{emit:a}){const s=h(!1);function e(){s.value=!0}return(c,t)=>{const r=S,l=q;return p(),g(F,null,[o("div",pe,[me,o("div",ve,[fe,o("div",we,[d(r,{design:"danger",alignment:"center",onClick:e},{default:$(()=>[C(" Удалить аккаунт ")]),_:1})])])]),(p(),x(D,{to:"body"},[d(l,{visible:s.value,"onUpdate:visible":t[0]||(t[0]=f=>s.value=f),onConfirm:t[1]||(t[1]=f=>c.$emit("delete-account"))},{title:$(()=>[ge]),text:$(()=>[$e]),_:1},8,["visible"])]))],64)}}});const ye=U(Ve,[["__scopeId","data-v-684e26cd"]]),he={class:"user-mentor"},xe=o("h3",null,"Мой куратор",-1),Ue={key:1,class:"index-profile-view__mentor__no-mentor"},be=V({__name:"user-mentor",props:{mentor:{}},setup(n){return(a,s)=>{const e=J;return p(),g("div",he,[xe,a.mentor?(p(),x(e,{key:0,user:a.mentor},null,8,["user"])):(p(),g("p",Ue," У вас пока нет куратора "))])}}}),Pe=W("profile-module:profile",()=>{const n=w.Services.User,a=w.Services.Auth,s=w.Services.UI,e=h(),c=P(()=>{var i,v;return((i=e.value)==null?void 0:i.role)==="student"?(v=e.value)==null?void 0:v.mentor:null}),t=h({oldPassword:"",newPassword:"",repeatPassword:""});async function r(){var i;if((i=w.Context.User)!=null&&i.username){s.setLoading(!0);try{const v=await n.getUser(w.Context.User.username);e.value=v.data}catch(v){s.openErrorModal("Произошла ошибка при загрузке данных пользователя","Возможно, Вам поможет перезайти. Ошибка: "+v.message,[{label:"Перезайти",design:"warning",handler:()=>a.logout()}])}finally{s.setLoading(!1)}}}async function l(){if(e.value){if(t.value.newPassword!==t.value.repeatPassword){s.openWarningModal("Пароли не совпадают");return}if(!n.validatePassword(t.value.newPassword)){s.openWarningModal("Пароль не соответствует требованиям");return}s.setLoading(!0);try{await n.updateUser(e.value.id,{id:e.value.id,password:t.value.newPassword}),s.openSuccessModal("Пароль успешно изменен")}catch(i){s.openErrorModal("Произошла ошибка при изменении пароля",i.message)}finally{t.value={oldPassword:"",newPassword:"",repeatPassword:""},s.setLoading(!1)}}}async function f(){if(e.value){s.setLoading(!0);try{await n.deleteUser(e.value.id),s.openSuccessModal("Аккаунт успешно удален"),a.logout()}catch(i){s.openErrorModal("Произошла ошибка при удалении аккаунта",i.message)}finally{s.setLoading(!1)}}}async function _(){var i;if(e.value){s.setLoading(!0);try{await n.updateUser(e.value.id,{id:e.value.id,name:e.value.name,telegramUsername:(i=e.value.telegramUsername)==null?void 0:i.replace("@","")}),s.openSuccessModal("Данные успешно обновлены","Чтобы изменения вступили в силу, обновите страницу",[{label:"Обновить страницу",design:"primary",handler:()=>window.location.reload()}])}catch(v){s.openErrorModal("Произошла ошибка при обновлении данных",v.message)}finally{s.setLoading(!1)}}}return{user:e,mentor:c,passwords:t,changePassword:l,deleteAccount:f,updateCredentials:_,fetchUser:r}}),Ce=n=>(k("data-v-4e376510"),n=n(),I(),n),Se={key:0,class:"index-profile-view"},ke={class:"index-profile-view__user-info"},Ie={class:"index-profile-view__credentials"},Me={class:"index-profile-view__password-change"},Le={class:"index-profile-view__delete-account"},Ae={class:"index-profile-view__mentor"},Ee={key:0,class:"index-profile-view__charts"},Be=Ce(()=>o("h3",{class:"index-profile-view__charts__header"},"Моя статистика",-1)),Ne=V({__name:"index",setup(n){const a=Pe();return j("Мой профиль"),a.fetchUser(),(s,e)=>{const c=G,t=z;return u(a).user?(p(),g("div",Se,[d(t,null,{sidebar:$(()=>[o("div",ke,[o("div",Ie,[d(se,{modelValue:u(a).user,"onUpdate:modelValue":e[0]||(e[0]=r=>u(a).user=r),onSave:e[1]||(e[1]=r=>u(a).updateCredentials())},null,8,["modelValue"])]),o("div",Me,[d(ce,{modelValue:u(a).passwords,"onUpdate:modelValue":e[2]||(e[2]=r=>u(a).passwords=r),onSave:e[3]||(e[3]=r=>u(a).changePassword())},null,8,["modelValue"])]),o("div",Le,[d(ye,{onDeleteAccount:e[4]||(e[4]=r=>u(a).deleteAccount())})])])]),content:$(()=>{var r;return[o("div",Ae,[u(a).mentor?(p(),x(be,{key:0,mentor:u(a).mentor},null,8,["mentor"])):y("",!0)]),u(w).Context.User&&u(w).Context.User.role!=="admin"?(p(),g("div",Ee,[Be,e[5]||(M(-1),e[5]=d(c,{username:(r=u(w).Context.User)==null?void 0:r.username},null,8,["username"]),M(1),e[5])])):y("",!0)]}),_:1})])):y("",!0)}}});const je=U(Ne,[["__scopeId","data-v-4e376510"]]);export{je as default};
