import{d as b,C as h,r as w,w as U,a as r,i as p,j as v,t as q,O as T,A as j,p as L,l as M,g as i,_ as S,c as V,e as k,y as C,P as z,E as G,v as x,u as l,Q as A,f as E,R as P,T as N,U as H,q as O,s as Q,V as W,b as R,o as X,W as Z,X as J,G as K,Y as D,H as ee,Z as oe,$ as te,a0 as ne,a1 as se,a2 as ie,M as ae}from"./index-63093e9d.js";const F=t=>(L("data-v-b7fc29e3"),t=t(),M(),t),de={key:0},ce=F(()=>i("span",{class:"add-video-to-saved-button__text"},"Добавлено в избранное",-1)),_e={key:1},le=F(()=>i("span",{class:"add-video-to-saved-button__text"},"Добавить в избранное",-1)),re={key:2},ue=b({__name:"add-video-to-saved-button",props:{videoId:{}},setup(t){const s=t,e=h.Services.Video,u=h.Services.UI,o=w("loading");U(()=>s.videoId,async()=>{await m()},{immediate:!0});async function d(){if(o.value==="loading")return;const a=o.value;o.value="loading";try{a==="added"?(await e.removeFromSavedVideos(s.videoId),o.value="not-added"):(await e.addToSavedVideos(s.videoId),o.value="added")}catch(_){u.openErrorModal("Не удалось добавить или убрать видео в избранное",_.message)}finally{o.value==="loading"&&(o.value=a)}}async function m(){try{const a=await e.isSaved(s.videoId);o.value=a.data?"added":"not-added"}catch{o.value="not-added"}}return(a,_)=>{const g=T,f=j;return r(),p("div",{class:q(["add-video-to-saved-button",o.value]),onClick:_[0]||(_[0]=y=>d())},[o.value==="added"?(r(),p("span",de,[v(g,{name:"check-green"}),ce])):o.value==="not-added"?(r(),p("span",_e,[v(g,{name:"add"}),le])):(r(),p("span",re,[v(f,{contrast:""})]))],2)}}});const ve=S(ue,[["__scopeId","data-v-b7fc29e3"]]),me={class:"video-comment-form"},pe={class:"video-comment-form__input"},fe={class:"video-comment-form__actions"},ye=250,ge=b({__name:"video-comment-form",props:{videoId:{}},emits:["comment-created"],setup(t,{emit:s}){const e=t,u=s,o=h.Services.Video,d=h.Services.UI,m=w(""),a=V(()=>m.value.trim()),_=w(!1);async function g(){if(!(!a.value||a.value.length>ye)){_.value=!0;try{await o.createComment(e.videoId,a.value),m.value="",u("comment-created")}catch(f){d.openErrorModal("Не удалось отправить комментарий",f.message)}finally{_.value=!1}}}return(f,y)=>{const $=z,c=G;return r(),p("div",me,[i("div",pe,[v($,{label:"Оставить комментарий",modelValue:m.value,"onUpdate:modelValue":y[0]||(y[0]=n=>m.value=n),validators:[n=>n.length>0||"Комментарий не может быть пустым",n=>n.length<=250||"Комментарий слишком длинный"],readonly:_.value},null,8,["modelValue","validators","readonly"])]),i("div",fe,[v(c,{onClick:y[1]||(y[1]=n=>g()),design:"primary",alignment:"right",loading:_.value},{default:k(()=>[C(" Отправить ")]),_:1},8,["loading"])])])}}});const he=S(ge,[["__scopeId","data-v-a6e7f16b"]]),$e={class:"video-comment"},we={class:"video-comment__user"},be={class:"video-comment__text"},Ce={class:"video-comment__date"},xe={key:0},Se=b({__name:"video-comment",props:{comment:{}},emits:["delete"],setup(t,{emit:s}){const e=t,u=s,o=V(()=>{var a;return h.Context.User.id===((a=e.comment.user)==null?void 0:a.id)||h.Context.roleIs(["admin","teacher"])}),d=w(!1);function m(){d.value?u("delete",e.comment.id):d.value=!0}return(a,_)=>{const g=N,f=T,y=H;return r(),p(P,null,[i("div",$e,[i("div",we,[v(g,{user:a.comment.user},null,8,["user"])]),i("div",be,x(a.comment.text),1),i("div",Ce,[C(x(l(A)(a.comment.createdAt,{precision:"minute"}).toBeautiful())+" ",1),o.value?(r(),p("span",xe,[C(" ⋅ "),v(f,{class:"video-comment__delete-button",name:"delete",onClick:_[0]||(_[0]=$=>m())})])):E("",!0)])]),v(y,{visible:d.value,"onUpdate:visible":_[1]||(_[1]=$=>d.value=$),onConfirm:_[2]||(_[2]=$=>m())},{title:k(()=>[C(" Удаление комментария ")]),text:k(()=>[C(' Вы уверены, что хотите удалить комментарий "'+x(a.comment.text)+'"? ',1)]),_:1},8,["visible"])],64)}}});const Ve=S(Se,[["__scopeId","data-v-99babd5a"]]),Ie=t=>(L("data-v-076cd09a"),t=t(),M(),t),ke={class:"video-comment-list"},Le=Ie(()=>i("div",{class:"video-comment-list__title"},[i("h3",null,"Комментарии")],-1)),Me={class:"video-comment-list__items"},Ee={key:0,class:"video-comment-list__empty"},Re=b({__name:"video-comment-list",props:{comments:{}},emits:["delete-comment"],setup(t){return(s,e)=>{const u=Ve,o=O("auto-animate");return r(),p("div",ke,[Le,Q((r(),p("div",Me,[(r(!0),p(P,null,W(s.comments,d=>(r(),R(u,{key:d.id,comment:d,onDelete:e[0]||(e[0]=m=>s.$emit("delete-comment",m))},null,8,["comment"]))),128))])),[[o]]),s.comments.length===0?(r(),p("p",Ee," Комментариев пока нет ")):E("",!0)])}}});const Be=S(Re,[["__scopeId","data-v-076cd09a"]]),De={class:"yandex-video-player"},Ue=b({__name:"yandex-video-player",props:{video:{},autoplay:{type:Boolean}},setup(t){const s=t,e=V(()=>`https://runtime.video.cloud.yandex.net/player/video/${s.video.uniqueIdentifier}`),u=w(null);let o=null;return X(()=>{o=Ya.playerSdk.init({element:u.value,source:e.value,autoplay:s.autoplay||!1})}),Z(()=>{o&&o.destroy()}),(d,m)=>(r(),p("div",De,[i("div",{class:"yandex-video-player__player-root",ref_key:"playerRef",ref:u},null,512)]))}});const Te=S(Ue,[["__scopeId","data-v-28e754aa"]]),Ae=b({__name:"video-player",props:{video:{}},setup(t){const s=t,e=V(()=>{switch(s.video.serviceType){case"yandex":default:return Te}});return(u,o)=>(r(),R(J(e.value),{video:u.video},null,8,["video"]))}}),Pe=K("nootube-module:video",()=>{const t=h.Services.UI,s=h.Services.Video,e=w(null),u=w(null),o=D(_,{immediate:!1}),d=D(a);async function m(c){try{const n=await s.getVideo(c,{showLoader:!0});e.value=n.data,await $()}catch(n){t.openErrorModal("Ошибка при загрузке видео",n==null?void 0:n.message)}}async function a(c){try{return s.getVideos(c)}catch(n){t.openErrorModal("Ошибка при загрузке похожих видео",n==null?void 0:n.message)}}async function _(c){if(e.value)try{return s.getVideoComments(e.value.id,c)}catch(n){t.openErrorModal("Ошибка при загрузке комментариев",n==null?void 0:n.message)}}async function g(c){try{await s.deleteComment(c,{showLoader:!0}),o.trigger()}catch(n){t.openErrorModal("Ошибка при удалении комментария",n==null?void 0:n.message)}}const f=w(!1);async function y(c){if(e.value){f.value=!0;try{const n=await s.toggleReaction(e.value.id,c);e.value.myReaction=e.value.myReaction===c?null:c,e.value.reactionCounts=n.data}catch(n){t.openErrorModal("Не удалось отреагировать на видео",n.message)}finally{f.value=!1}}}async function $(){if(e.value)try{const c=await s.getAccessInfo(e.value.id,{showLoader:!0});u.value=c.data}catch(c){t.openErrorModal("Ошибка при загрузке информации о доступе",c==null?void 0:c.message)}}return{video:e,accessInfo:u,comments:o,similarVideos:d,fetchVideo:m,deleteComment:g,react:y,reactionsLoading:f}}),Ne=t=>(L("data-v-538fadc4"),t=t(),M(),t),Fe={key:0,class:"video-view"},Ye={class:"video-view__player"},qe={class:"video-view__comments"},je={class:"video-view__comments__list"},ze={class:"video-view__comments__form"},Ge={class:"video-view__info"},He={class:"video-view__info__back-button"},Oe={class:"video-view__info__title"},Qe={class:"video-view__info__author"},We={class:"video-view__info__main"},Xe={class:"video-view__info__actions"},Ze={key:0,class:"video-view__info__link"},Je={class:"video-view__info__description"},Ke={key:1,class:"video-view__not-found"},eo=Ne(()=>i("h4",null,"Видео не найдено",-1)),oo=b({__name:"video-view",setup(t){const s=ee(),e=Pe();U(()=>s.params.id,async()=>{var o;await e.fetchVideo(s.params.id),e.comments.trigger(),te(`НОО.Tube - ${(o=e.video)==null?void 0:o.title}`)},{immediate:!0});const u=V(()=>{var o;return h.Constants.APP_URL+`/nootube/video/${(o=e.video)==null?void 0:o.id}`});return(o,d)=>{var B;const m=Ae,a=Be,_=he,g=ne,f=N,y=ve,$=se,c=ie,n=ae,Y=oe("nothing-found");return l(e).video?(r(),p("div",Fe,[i("div",Ye,[(r(),R(m,{video:l(e).video,key:l(e).video.id},null,8,["video"]))]),i("div",qe,[i("div",je,[v(a,{comments:l(e).comments.results,onDeleteComment:d[0]||(d[0]=I=>l(e).deleteComment(I))},null,8,["comments"])]),i("div",ze,[v(_,{"video-id":l(e).video.id,onCommentCreated:d[1]||(d[1]=I=>l(e).comments.trigger())},null,8,["video-id"])])]),i("div",Ge,[i("div",He,[v(g,{to:"/nootube"},{default:k(()=>[C(" Назад к списку видео ")]),_:1})]),i("h1",Oe,x(l(e).video.title),1),i("div",Qe,[v(f,{user:l(e).video.uploadedBy},null,8,["user"])]),i("div",We," Опубликовано "+x(l(A)(l(e).video.publishedAt,{precision:"day"}).toBeautiful())+" • "+x((B=l(e).accessInfo)==null?void 0:B.text),1),i("div",Xe,[v(y,{"video-id":l(e).video.id},null,8,["video-id"]),v($,{reactions:l(e).video.reactionCounts,"my-reaction":l(e).video.myReaction,loading:l(e).reactionsLoading,onReact:d[2]||(d[2]=I=>l(e).react(I))},null,8,["reactions","my-reaction","loading"])]),l(h).Context.roleIs(["admin","teacher"])?(r(),p("div",Ze,[v(c,{label:"Ссылка на видео для вставки","model-value":u.value,type:"text",readonly:"","copy-button":""},null,8,["model-value"])])):E("",!0),i("div",Je,[v(n,{content:l(e).video.description,"no-padding":""},null,8,["content"])])])])):(r(),p("div",Ke,[v(Y),eo]))}}});const no=S(oo,[["__scopeId","data-v-538fadc4"]]);export{no as default};
