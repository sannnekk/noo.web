import{d as $,x as C,a as r,i as p,g as a,Q as M,V as B,j as l,u as j,C as S,f as g,e as d,y as m,v as D,aq as N,T as F,a0 as E,aa as T,af as q,p as A,l as G,_ as w,r as y,E as Q,G as z,b as H,a8 as J,A as K}from"./index-7e0372b3.js";import{S as I}from"./settings-section-4438d27b.js";const V=_=>(A("data-v-b784389f"),_=_(),G(),_),P={class:"subject-list"},R={class:"subject-list__item__name"},W={key:0,class:"subject-list__item__actions"},X={class:"subject-list__item__actions__edit"},Y={class:"subject-list__item__actions__delete"},Z={key:0,class:"subject-list__no-items"},ee=V(()=>a("p",null,"Пока нет предметов",-1)),te=[ee],se=V(()=>a("br",null,null,-1)),oe=V(()=>a("br",null,null,-1)),ne=$({__name:"subject-list",props:{subjects:{}},emits:["update-subject","delete-subject"],setup(_,{emit:s}){const b=s,e=C({subject:null,isOpen:!1}),o=C({subject:null,isOpen:!1});function v(t){e.subject=t,e.isOpen=!0}function c(t){o.subject=t,o.isOpen=!0}function f(){e.subject&&b("update-subject",e.subject),e.subject=null}function u(){o.subject&&b("delete-subject",o.subject),o.subject=null}return(t,i)=>{const L=N,h=F,k=E,x=T,O=q;return r(),p(M,null,[a("div",P,[(r(!0),p(M,null,B(t.subjects,n=>(r(),p("div",{class:"subject-list__item",key:n.id},[a("div",R,[l(L,{subject:n},null,8,["subject"])]),j(S).Context.roleIs(["admin"])?(r(),p("div",W,[a("div",X,[l(h,{name:"edit",onClick:U=>v(n)},null,8,["onClick"])]),a("div",Y,[l(h,{name:"delete",onClick:U=>c(n)},null,8,["onClick"])])])):g("",!0)]))),128)),t.subjects.length===0?(r(),p("div",Z,te)):g("",!0)]),l(x,{visible:e.isOpen,"onUpdate:visible":i[2]||(i[2]=n=>e.isOpen=n),onConfirm:i[3]||(i[3]=n=>f())},{title:d(()=>[m("Изменить предмет")]),text:d(()=>[l(k,{label:"Название предмета",modelValue:e.subject.name,"onUpdate:modelValue":i[0]||(i[0]=n=>e.subject.name=n),type:"text"},null,8,["modelValue"]),l(k,{label:"Цвет предмета",modelValue:e.subject.color,"onUpdate:modelValue":i[1]||(i[1]=n=>e.subject.color=n),type:"color"},null,8,["modelValue"])]),_:1},8,["visible"]),l(x,{visible:o.isOpen,"onUpdate:visible":i[4]||(i[4]=n=>o.isOpen=n),onConfirm:i[5]||(i[5]=n=>u())},{title:d(()=>{var n;return[m(' Удалить предмет "'+D((n=o.subject)==null?void 0:n.name)+'" ',1)]}),text:d(()=>[l(O,null,{default:d(()=>[m(" Вы уверены, что хотите удалить предмет?"),se,m(" Это действие нельзя будет отменить. "),oe,m(" Перед удалением предмета нужно удалить все связанные с ним курсы и работы ")]),_:1})]),_:1},8,["visible"])],64)}}});const ce=w(ne,[["__scopeId","data-v-b784389f"]]),le={class:"create-subject-form"},ae={class:"row"},ue={class:"col-md-6 col-12"},ie={class:"create-subject-form__form-field"},_e={class:"col-md-3 col-6"},de={class:"create-subject-form__form-field"},re={class:"col-md-3 col-6"},me={class:"create-subject-form__actions"},be=$({__name:"create-subject-form",emits:["create-subject"],setup(_,{emit:s}){const b=s,e=y({name:"",color:""});function o(){b("create-subject",e.value)}return(v,c)=>{const f=E,u=Q;return r(),p("div",le,[a("div",ae,[a("div",ue,[a("div",ie,[l(f,{modelValue:e.value.name,"onUpdate:modelValue":c[0]||(c[0]=t=>e.value.name=t),type:"text",label:"Название предмета",validators:[t=>t.length>2||"Название предмета должно содержать минимум 3 символа",t=>t.length<101||"Название предмета должно содержать максимум 100 символов"]},null,8,["modelValue","validators"])])]),a("div",_e,[a("div",de,[l(f,{type:"color",modelValue:e.value.color,"onUpdate:modelValue":c[1]||(c[1]=t=>e.value.color=t),label:"Цвет предмета"},null,8,["modelValue"])])]),a("div",re,[a("div",me,[l(u,{onClick:c[2]||(c[2]=t=>o()),alignment:"stretch",design:"primary"},{default:d(()=>[m(" Создать ")]),_:1})])])])])}}});const pe=w(be,[["__scopeId","data-v-efa55358"]]),je=z("settings-module:subjects",()=>{const _=S.Services.Subject,s=S.Services.UI,b=y([]),e=y(!1);async function o(){e.value=!0;try{const u=await _.getSubjects();b.value=u.data,e.value=!1}catch(u){s.openErrorModal("Ошибка при загрузке списка предметов",u.message)}}async function v(u){try{await _.createSubject(u,{showLoader:!0}),s.openSuccessModal("Предмет успешно создан"),await o()}catch(t){s.openErrorModal("Ошибка при создании предмета",t.message)}}async function c(u){try{await _.updateSubject(u.id,u,{showLoader:!0}),s.openSuccessModal("Предмет успешно обновлен"),await o()}catch(t){s.openErrorModal("Ошибка при обновлении предмета",t.message)}}async function f(u){try{await _.deleteSubject(u.id,{showLoader:!0}),s.openSuccessModal("Предмет успешно удален"),await o()}catch(t){s.openErrorModal("Ошибка при удалении предмета",t.message)}}return{moduleLoading:e,subjects:b,fetchSubjects:o,createSubject:v,updateSubject:c,deleteSubject:f}}),ve={key:0,class:"subjects-view"},fe={class:"subjects-view__disclaimer"},Se={key:1,class:"subjects-view__loading"},ge=$({__name:"subjects-view",setup(_){const s=je();return s.fetchSubjects(),(b,e)=>{const o=J,v=K;return j(s).moduleLoading?(r(),p("div",Se,[l(v,{contrast:""})])):(r(),p("div",ve,[a("div",fe,[l(o,null,{default:d(()=>[m(" Добавлять, изменять и удалять предметы может только администратор ")]),_:1})]),l(I,null,{title:d(()=>[m("Предметы")]),content:d(()=>[l(ce,{subjects:j(s).subjects,onUpdateSubject:e[0]||(e[0]=c=>j(s).updateSubject(c)),onDeleteSubject:e[1]||(e[1]=c=>j(s).deleteSubject(c))},null,8,["subjects"])]),_:1}),j(S).Context.roleIs(["admin"])?(r(),H(I,{key:0},{title:d(()=>[m("Добавить предмет")]),content:d(()=>[l(pe,{onCreateSubject:e[2]||(e[2]=c=>j(s).createSubject(c))})]),_:1})):g("",!0)]))}}});const we=w(ge,[["__scopeId","data-v-baac840d"]]);export{we as default};
