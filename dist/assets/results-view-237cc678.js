import{a as d,o as m,h,d as v,C as _,O as f,c as y,r as S,u as k,A as w,g as s,b as V,e as i,f as u,w as x,s as b,t as I,v as C,_ as L,j as B,m as P}from"./index-d17ade26.js";import{_ as U}from"./entity-table-7112252a.js";import"./useDate-126c6fe0.js";const $=d({__name:"results-table",props:{results:{},isLoading:{type:Boolean},pollId:{}},setup(a){const e=a,c=[{title:"",keys:["avatar.url","name"],type:"avatar"},{title:"Имя",keys:["name"],type:"text"},{title:"Никнейм",keys:["username"],type:"text"},{title:"E-mail",keys:["email"],type:"text"},{title:"Telegram",keys:["telegramUsername"],type:"link",design:"telegram",linkTo:t=>`https://t.me/${t.telegramUsername}`},{title:"",value:"Посмотреть",type:"link",design:"secondary",linkTo:t=>`/poll/${e.pollId}/results/${t.username}`}];return(t,l)=>{const o=U;return m(),h(o,{cols:c,data:t.results,"is-loading":t.isLoading},null,8,["data","is-loading"])}}}),E=v("polls-module:results",()=>{const a=_.Services.Poll,e=_.Services.UI,c=f(),t=y(()=>c.params.pollId),l=S(),o=k(p);async function p(r){if(!t.value)return[];try{return await a.searchWhoVoted(t.value,r)}catch(g){e.openErrorModal("Произошла ошибка при получении ответов",g.message)}}async function n(){e.setLoading(!0);try{const r=await a.getPollInfo(t.value);l.value=r.data}catch(r){e.openErrorModal("Произошла ошибка при получении опроса",r.message,[{label:"Назад к блогу/новостям",design:"primary",handler:()=>window.location.replace("/blog")}])}finally{e.setLoading(!1)}}return{poll:l,resultsSearch:o,fetchPoll:n}}),N={key:0,class:"results-view"},T={class:"results-view__head"},M={class:"results-view__search-input"},A={class:"results-view__results"},R={class:"results-view__pagination"},j=d({__name:"results-view",setup(a){const e=E();return e.fetchPoll(),(c,t)=>{const l=w("router-link"),o=L,p=B;return s(e).poll?(m(),V("div",N,[i("div",T,[u(l,{to:"/blog",class:"results-view__head__back"},{default:x(()=>[b("Назад к блогу")]),_:1}),i("h1",null,I(s(e).poll.title),1)]),i("div",M,[u(o,{modelValue:s(e).resultsSearch.pagination.search,"onUpdate:modelValue":t[0]||(t[0]=n=>s(e).resultsSearch.pagination.search=n)},null,8,["modelValue"])]),i("div",A,[u($,{results:s(e).resultsSearch.results,"is-loading":s(e).resultsSearch.isListLoading,"poll-id":s(e).poll.id},null,8,["results","is-loading","poll-id"])]),i("div",R,[u(p,{page:s(e).resultsSearch.pagination.page,"onUpdate:page":t[1]||(t[1]=n=>s(e).resultsSearch.pagination.page=n),limit:s(e).resultsSearch.pagination.limit,total:s(e).resultsSearch.resultsMeta.total},null,8,["page","limit","total"])])])):C("",!0)}}});const q=P(j,[["__scopeId","data-v-ea0794f6"]]);export{q as default};
