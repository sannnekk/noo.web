import{x as G,d as I,L as Q,r as q,o as H,a as d,j as m,u,f as B,M as U,w as $,b as F,e as V,y as E,C as N,E as z,_ as C,g as a,k as f,N as M,v as W,t as X,c as k,q as D,s as x,O as Y,P as Z,Q as A,R as ee,p as j,l as K,S as te,T as ne,U as oe}from"./index-2bf4cf58.js";var w={library:"https://accounts.google.com/gsi/client",defaultButtonConfig:{theme:"outline",size:"large"},scopes:"email profile openid",ssrError:"vue3-google-login cannot be executed on the server side. See here for more info https://devbaji.github.io/vue3-google-login/#no-ssr-support"};const h=G({clientId:null,popupType:"CODE",prompt:!1,autoLogin:!1,idConfiguration:null,buttonConfig:w.defaultButtonConfig,callback:()=>{},error:null}),b=G({apiLoaded:!1,apiLoadIntitited:!1}),ie=()=>new Promise((e,t)=>{if(typeof window<"u"){if(!b.apiLoadIntitited){const o=document.createElement("script");b.apiLoadIntitited=!0,o.addEventListener("load",()=>{b.apiLoaded=!0,e(window.google)}),o.addEventListener("error",()=>{t("Failed to load the Google 3P Authorization JavaScript Library.")}),o.src=w.library,o.async=!0,o.defer=!0,document.head.appendChild(o)}}else t(w.ssrError)}),S=e=>{b.apiLoadIntitited?b.apiLoaded?e(window.google):$(()=>b.apiLoaded,t=>{t&&e(window.google)}):ie().then(t=>{e(t)})},le=(e,t,o,i)=>{if(!e.client_id)throw new Error("Prop client id required since plugin is not initialized with a client id");S(()=>{((n,s,_,c,v)=>{if(v){const p=n.callback;n.callback=g=>{g.credential?p&&p(g):v(g)}}window.google.accounts.id.initialize(n);const l=s.value;l&&!c&&window.google.accounts.id.renderButton(l,_)})(e,t,o.buttonConfig,i,o.error),o.prompt&&ce({clientId:o.clientId,callback:o.callback,error:o.error,autoLogin:o.autoLogin})})},se=e=>new Promise((t,o)=>{S(i=>{if(!(e&&e.clientId||h.clientId))throw new Error("clientId is required since the plugin is not initialized with a Client Id");i.accounts.oauth2.initCodeClient({client_id:e&&e.clientId||h.clientId||"",scope:w.scopes,ux_mode:"popup",callback:n=>{n.code?t(n):o(n)},error_callback:n=>{o(n)}}).requestCode()})}),ae=e=>new Promise((t,o)=>{S(i=>{if(!(e&&e.clientId||h.clientId))throw new Error("clientId is required since the plugin is not initialized with a Client Id");i.accounts.oauth2.initTokenClient({client_id:e&&e.clientId||h.clientId||"",scope:w.scopes,callback:n=>{n.access_token?t(n):o(n)},error_callback:n=>{o(n)}}).requestAccessToken()})}),ce=e=>{if(!e&&(e={}),!e.clientId&&!h.clientId)throw new Error("clientId is required");const t={use_fedcm_for_prompt:!0};return e.clientId&&(t.client_id=e.clientId),!e.clientId&&h.clientId&&(t.client_id=h.clientId),e.context&&(t.context=e.context),e.autoLogin!=null&&(t.auto_select=e.autoLogin),e.cancelOnTapOutside!=null&&(t.cancel_on_tap_outside=e.cancelOnTapOutside),new Promise((o,i)=>{t.callback=n=>{e&&e.callback&&e.callback(n),n.credential?o(n):i(n)},S(n=>{n.accounts.id.initialize(t),n.accounts.id.prompt()})})};var T=I({__name:"GoogleLogin",props:{clientId:{type:String,required:!1},prompt:{type:Boolean,required:!1,default:!1},autoLogin:{type:Boolean,required:!1,default:!1},popupType:{type:String,required:!1},idConfiguration:{type:Object,required:!1},buttonConfig:{type:Object,required:!1},callback:{type:Function,required:!1},error:{type:Function,required:!1}},setup(e){if(!(typeof window<"u"))throw new Error(w.ssrError);const t=!!Q().default,o=e,i=((_,c)=>{const v={..._};for(const l in c)c[l]!==void 0&&c[l]!==null&&(v[l]=c[l]);return v})(h,o),n={client_id:i.clientId||null,auto_select:i.autoLogin||!1,callback:i.callback,...i.idConfiguration},s=q();return H(()=>{le(n,s,i,t),o.popupType&&!t&&console.warn("Option 'popupType' is ignored since a slot which act as a custom login button was not found!!!")}),(_,c)=>(d(),m("div",{class:"g-btn-wrapper",onClick:c[0]||(c[0]=v=>u(t)&&void(u(i).popupType==="TOKEN"?ae({clientId:i.clientId}).then(l=>{i.callback&&i.callback(l)}).catch(l=>{i.error&&i.error(l)}):se({clientId:i.clientId}).then(l=>{i.callback&&i.callback(l)}).catch(l=>{i.error&&i.error(l)})))},[u(t)?B("v-if",!0):(d(),m("span",{key:0,ref_key:"buttonRef",ref:s,class:"g-btn"},null,512)),U(_.$slots,"default")]))}});(function(e,t){t===void 0&&(t={});var o=t.insertAt;if(e&&typeof document<"u"){var i=document.head||document.getElementsByTagName("head")[0],n=document.createElement("style");n.type="text/css",o==="top"&&i.firstChild?i.insertBefore(n,i.firstChild):i.appendChild(n),n.styleSheet?n.styleSheet.cssText=e:n.appendChild(document.createTextNode(e))}})(`
.g-btn-wrapper[data-v-5e610566] {
  display: inline-block;
}
`),T.__scopeId="data-v-5e610566",T.__file="src/plugin/GoogleLogin.vue";const de=I({__name:"google-auth-button",emits:["login"],setup(e,{emit:t}){function o(n){t("login",n)}function i(){S(n=>{n.accounts.oauth2.initCodeClient({client_id:N.Constants.GOOGLE_CLIENT_ID,scope:"email profile openid https://www.googleapis.com/auth/drive.file",callback:o}).requestCode()})}return(n,s)=>{const _=z;return d(),F(_,{onClick:s[0]||(s[0]=c=>i())},{default:V(()=>[E(" Войти через Google ")]),_:1})}}});const re=C(de,[["__scopeId","data-v-98d6de66"]]);const ue={},_e={class:"success-block"},pe={class:"success-block__icon"},me={class:"success-block__text"};function ve(e,t){const o=M;return d(),m("div",_e,[a("div",pe,[f(o,{name:"check-green"})]),a("div",me,[U(e.$slots,"default",{},void 0,!0)])])}const ge=C(ue,[["render",ve],["__scopeId","data-v-471b0d9c"]]),fe={key:0,class:"entity-selection-card__selected-badge"},ye={class:"entity-selection-card__icon"},he={class:"entity-selection-card__name"},be=I({__name:"entity-selection-card",props:{entity:{},selected:{type:Boolean}},setup(e){const t=q(!1);return(o,i)=>{const n=M;return d(),m("div",{class:X(["entity-selection-card",{"entity-selection-card--selected":o.selected}]),onMouseenter:i[0]||(i[0]=s=>t.value=!0),onMouseleave:i[1]||(i[1]=s=>t.value=!1)},[o.selected?(d(),m("div",fe)):B("",!0),a("div",ye,[f(n,{name:o.entity.icon,animation:t.value},null,8,["name","animation"])]),a("div",he,[a("p",null,W(o.entity.name),1)])],34)}}});const we=C(be,[["__scopeId","data-v-e178dfb9"]]);async function ke(e){const t=[{label:"Администратор",role:"admin",id:"1"},{label:"Ученик",role:"student",id:"2"},{label:"Учитель",role:"teacher",id:"3"},{label:"Куратор",role:"mentor",id:"4"}];if(e!=null&&e.search){const o=t.filter(i=>i.label.toLowerCase().includes(e.search.toLowerCase()));return{data:o,meta:{total:o.length,relations:[]}}}return{data:t,meta:{total:t.length,relations:[]}}}async function Ie(e){try{return await N.Services.Poll.getPolls(e)}catch(t){N.Services.UI.openErrorModal("Ошибка при загрузке опросов",t.message)}}const O=[{name:"Результаты опросов",technicalName:"poll_answer",icon:"poll",availableSelectorProps:[{label:"По опросу",value:"pollId",labelKeys:["title"],fetchFunction:Ie,toPropValue:e=>e.id}]},{name:"Пользователи",technicalName:"user",icon:"users",availableSelectorProps:[{label:"По роли",value:"role",labelKeys:["label"],fetchFunction:ke,toPropValue:e=>e.role}]}],R=e=>(j("data-v-0e8f930b"),e=e(),K(),e),Ce={class:"entity-selection-view"},Se=R(()=>a("h3",{class:"entity-selection-view__header"},"Выберите модуль",-1)),Be={class:"entity-selection-view__entity-list"},Le={key:0,class:"entity-selection-view__header"},$e=R(()=>a("h3",null,"Выберите селектор",-1)),Ve={class:"row"},Ee={class:"col-md-6"},Ne={class:"entity-selection-view__selector"},xe={class:"col-md-6"},qe=I({__name:"entity-selection-view",props:{entityName:{},entitySelector:{}},emits:["update:entityName","update:entitySelector"],setup(e,{emit:t}){const o=e,i=k(()=>O.find(l=>l.technicalName===o.entityName)),n=k(()=>{var l;return(l=i.value)==null?void 0:l.availableSelectorProps.find(p=>p.value===o.entitySelector.prop)}),s=k({get:()=>o.entityName,set:l=>t("update:entityName",l)}),_=k({get:()=>o.entitySelector,set:l=>t("update:entitySelector",l)}),c=q([]);$(c,()=>{var p,g;const l=(p=c.value)==null?void 0:p.at(0);_.value={prop:_.value.prop,value:l?(g=n.value)==null?void 0:g.toPropValue(l):""}}),$(n,()=>{c.value=[]});function v(l){s.value=l.technicalName}return(l,p)=>{var P;const g=A,L=ee,r=D("auto-animate");return x((d(),m("div",Ce,[a("section",null,[Se,a("div",Be,[(d(!0),m(Y,null,Z(u(O),y=>(d(),F(we,{key:y.technicalName,entity:y,selected:y.technicalName===s.value,onClick:Ze=>v(y)},null,8,["entity","selected","onClick"]))),128))])]),i.value?(d(),m("section",Le,[$e,x((d(),m("div",Ve,[a("div",Ee,[a("div",Ne,[f(g,{label:"Селектор",modelValue:_.value.prop,"onUpdate:modelValue":p[0]||(p[0]=y=>_.value.prop=y),options:(P=i.value)==null?void 0:P.availableSelectorProps},null,8,["modelValue","options"])])]),a("div",xe,[n.value?(d(),m("div",{class:"entity-selection-view__selector",key:n.value.value},[f(L,{label:"Значение (только одно)",modelValue:c.value,"onUpdate:modelValue":p[1]||(p[1]=y=>c.value=y),"label-keys":n.value.labelKeys,"fetch-function":n.value.fetchFunction,"max-count":1},null,8,["modelValue","label-keys","fetch-function"])])):B("",!0)])])),[[r]])])):B("",!0)])),[[r]])}}});const Fe=C(qe,[["__scopeId","data-v-0e8f930b"]]),J=e=>(j("data-v-59605f28"),e=e(),K(),e),Pe={class:"create-binding-view"},Te={class:"create-binding-view__form"},Oe={class:"row"},Ge={class:"col-md-6"},Ue={class:"create-binding-view__form-field"},ze={class:"col-md-6"},Me={class:"create-binding-view__form-field"},De={class:"row"},Ae={class:"col-md-12"},je={class:"create-binding-view__form-field"},Ke={class:"row"},Re={class:"col-md-6"},Je=J(()=>a("h3",null,"Google-Аккаунт",-1)),Qe={key:1,class:"create-binding-view__form-field"},He={class:"col-md-6"},We=J(()=>a("h3",null,"Статус",-1)),Xe={class:"create-binding-view__buttons"},Ye=I({__name:"create-binding-view",setup(e){const t=te(),o=[{value:"hourly",label:"Ежечасно"},{value:"daily",label:"Ежедневно"},{value:"weekly",label:"Еженедельно"},{value:"monthly",label:"Ежемесячно"}],i=k({get:()=>t.createBindingForm.status==="active",set:n=>t.createBindingForm.status=n?"active":"inactive"});return(n,s)=>{const _=ne,c=A,v=ge,l=re,p=oe,g=z,L=D("auto-animate");return d(),m("div",Pe,[a("div",Te,[a("div",Oe,[a("div",Ge,[a("div",Ue,[f(_,{modelValue:u(t).createBindingForm.name,"onUpdate:modelValue":s[0]||(s[0]=r=>u(t).createBindingForm.name=r),label:"Название интеграции",type:"text"},null,8,["modelValue"])])]),a("div",ze,[a("div",Me,[f(c,{modelValue:u(t).createBindingForm.frequency,"onUpdate:modelValue":s[1]||(s[1]=r=>u(t).createBindingForm.frequency=r),label:"Частота обновления",options:o},null,8,["modelValue"])])])]),a("div",De,[a("div",Ae,[a("div",je,[f(Fe,{"entity-name":u(t).createBindingForm.entityName,"onUpdate:entityName":s[2]||(s[2]=r=>u(t).createBindingForm.entityName=r),"entity-selector":u(t).createBindingForm.entitySelector,"onUpdate:entitySelector":s[3]||(s[3]=r=>u(t).createBindingForm.entitySelector=r)},null,8,["entity-name","entity-selector"])])])]),a("div",Ke,[x((d(),m("div",Re,[Je,u(t).createBindingForm.googleOAuthToken?(d(),F(v,{key:0},{default:V(()=>[E(" Вы успешно авторизовались в Google ")]),_:1})):(d(),m("div",Qe,[f(l,{onLogin:s[4]||(s[4]=r=>u(t).onGoogleLogin(r))})]))])),[[L]]),a("div",He,[We,f(p,{modelValue:i.value,"onUpdate:modelValue":s[5]||(s[5]=r=>i.value=r),label:"Активировать интеграцию"},null,8,["modelValue"])])]),a("div",Xe,[f(g,{alignment:"right",onClick:s[6]||(s[6]=r=>u(t).saveBinding())},{default:V(()=>[E(" Создать интеграцию ")]),_:1})])])])}}});const tt=C(Ye,[["__scopeId","data-v-59605f28"]]);export{tt as default};
