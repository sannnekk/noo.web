import{d as C,C as h,r as b,w as A,a as v,i as f,j as r,t as X,O as N,A as Z,p as L,l as M,g as a,_ as S,c as I,e as k,y as V,P as J,E as K,v as x,u as _,Q as q,f as E,R as F,T as Y,U as ee,q as oe,s as te,V as ne,b as R,o as se,W as ie,X as ae,G as de,Y as D,H as _e,Z as ce,$ as T,a0 as le,a1 as re,a2 as ve,M as ue,a3 as me}from"./index-f820ad4d.js";const O=t=>(L("data-v-b7fc29e3"),t=t(),M(),t),pe={key:0},fe=O(()=>a("span",{class:"add-video-to-saved-button__text"},"Добавлено в избранное",-1)),ye={key:1},ge=O(()=>a("span",{class:"add-video-to-saved-button__text"},"Добавить в избранное",-1)),he={key:2},$e=C({__name:"add-video-to-saved-button",props:{videoId:{}},setup(t){const s=t,e=h.Services.Video,m=h.Services.UI,i=b("loading");A(()=>s.videoId,async()=>{await p()},{immediate:!0});async function u(){if(i.value==="loading")return;const d=i.value;i.value="loading";try{d==="added"?(await e.removeFromSavedVideos(s.videoId),i.value="not-added"):(await e.addToSavedVideos(s.videoId),i.value="added")}catch(o){m.openErrorModal("Не удалось добавить или убрать видео в избранное",o.message)}finally{i.value==="loading"&&(i.value=d)}}async function p(){try{const d=await e.isSaved(s.videoId);i.value=d.data?"added":"not-added"}catch{i.value="not-added"}}return(d,o)=>{const c=N,y=Z;return v(),f("div",{class:X(["add-video-to-saved-button",i.value]),onClick:o[0]||(o[0]=g=>u())},[i.value==="added"?(v(),f("span",pe,[r(c,{name:"check-green"}),fe])):i.value==="not-added"?(v(),f("span",ye,[r(c,{name:"add"}),ge])):(v(),f("span",he,[r(y,{contrast:""})]))],2)}}});const be=S($e,[["__scopeId","data-v-b7fc29e3"]]),we={class:"video-comment-form"},Ce={class:"video-comment-form__input"},Ve={class:"video-comment-form__actions"},P=512,xe=C({__name:"video-comment-form",props:{videoId:{}},emits:["comment-created"],setup(t,{emit:s}){const e=t,m=s,i=h.Services.Video,u=h.Services.UI,p=b(""),d=I(()=>p.value.trim()),o=b(!1);async function c(){if(!(!d.value||d.value.length>P)){o.value=!0;try{await i.createComment(e.videoId,d.value),p.value="",m("comment-created")}catch(y){u.openErrorModal("Не удалось отправить комментарий",y.message)}finally{o.value=!1}}}return(y,g)=>{const $=J,l=K;return v(),f("div",we,[a("div",Ce,[r($,{label:"Оставить комментарий",modelValue:p.value,"onUpdate:modelValue":g[0]||(g[0]=n=>p.value=n),validators:[n=>n.length>0||"Комментарий не может быть пустым",n=>n.length<=P||"Комментарий слишком длинный"],readonly:o.value},null,8,["modelValue","validators","readonly"])]),a("div",Ve,[r(l,{onClick:g[1]||(g[1]=n=>c()),design:"primary",alignment:"right",loading:o.value},{default:k(()=>[V(" Отправить ")]),_:1},8,["loading"])])])}}});const Ie=S(xe,[["__scopeId","data-v-fdb059ec"]]),Se={class:"video-comment"},ke={class:"video-comment__user"},Ee={class:"video-comment__text"},Le={class:"video-comment__date"},Me={key:0},Re=C({__name:"video-comment",props:{comment:{}},emits:["delete"],setup(t,{emit:s}){const e=t,m=s,i=I(()=>{var d;return h.Context.User.id===((d=e.comment.user)==null?void 0:d.id)||h.Context.roleIs(["admin","teacher"])}),u=b(!1);function p(){u.value?m("delete",e.comment.id):u.value=!0}return(d,o)=>{const c=Y,y=N,g=ee;return v(),f(F,null,[a("div",Se,[a("div",ke,[r(c,{user:d.comment.user},null,8,["user"])]),a("div",Ee,x(d.comment.text),1),a("div",Le,[V(x(_(q)(d.comment.createdAt,{precision:"minute"}).toBeautiful())+" ",1),i.value?(v(),f("span",Me,[V(" ⋅ "),r(y,{class:"video-comment__delete-button",name:"delete",onClick:o[0]||(o[0]=$=>p())})])):E("",!0)])]),r(g,{visible:u.value,"onUpdate:visible":o[1]||(o[1]=$=>u.value=$),onConfirm:o[2]||(o[2]=$=>p())},{title:k(()=>[V(" Удаление комментария ")]),text:k(()=>[V(' Вы уверены, что хотите удалить комментарий "'+x(d.comment.text)+'"? ',1)]),_:1},8,["visible"])],64)}}});const Ue=S(Re,[["__scopeId","data-v-99babd5a"]]),Be=t=>(L("data-v-076cd09a"),t=t(),M(),t),De={class:"video-comment-list"},Te=Be(()=>a("div",{class:"video-comment-list__title"},[a("h3",null,"Комментарии")],-1)),Pe={class:"video-comment-list__items"},Ae={key:0,class:"video-comment-list__empty"},Ne=C({__name:"video-comment-list",props:{comments:{}},emits:["delete-comment"],setup(t){return(s,e)=>{const m=Ue,i=oe("auto-animate");return v(),f("div",De,[Te,te((v(),f("div",Pe,[(v(!0),f(F,null,ne(s.comments,u=>(v(),R(m,{key:u.id,comment:u,onDelete:e[0]||(e[0]=p=>s.$emit("delete-comment",p))},null,8,["comment"]))),128))])),[[i]]),s.comments.length===0?(v(),f("p",Ae," Комментариев пока нет ")):E("",!0)])}}});const qe=S(Ne,[["__scopeId","data-v-076cd09a"]]),Fe={class:"yandex-video-player"},Ye=C({__name:"yandex-video-player",props:{video:{},autoplay:{type:Boolean}},setup(t){const s=t,e=I(()=>`https://runtime.video.cloud.yandex.net/player/video/${s.video.uniqueIdentifier}`),m=b(null);let i=null;return se(()=>{i=Ya.playerSdk.init({element:m.value,source:e.value,autoplay:s.autoplay||!1})}),ie(()=>{i&&i.destroy()}),(u,p)=>(v(),f("div",Fe,[a("div",{class:"yandex-video-player__player-root",ref_key:"playerRef",ref:m},null,512)]))}});const Oe=S(Ye,[["__scopeId","data-v-28e754aa"]]),je=C({__name:"video-player",props:{video:{}},setup(t){const s=t,e=I(()=>{switch(s.video.serviceType){case"yandex":default:return Oe}});return(m,i)=>(v(),R(ae(e.value),{video:m.video},null,8,["video"]))}}),ze=de("nootube-module:video",()=>{const t=h.Services.UI,s=h.Services.Video,e=b(null),m=b(null),i=D(o,{immediate:!1}),u=D(d);async function p(l){try{const n=await s.getVideo(l,{showLoader:!0});e.value=n.data,await $()}catch(n){t.openErrorModal("Ошибка при загрузке видео",n==null?void 0:n.message)}}async function d(l){try{return s.getVideos(l)}catch(n){t.openErrorModal("Ошибка при загрузке похожих видео",n==null?void 0:n.message)}}async function o(l){if(e.value)try{return s.getVideoComments(e.value.id,l)}catch(n){t.openErrorModal("Ошибка при загрузке комментариев",n==null?void 0:n.message)}}async function c(l){try{await s.deleteComment(l,{showLoader:!0}),i.trigger()}catch(n){t.openErrorModal("Ошибка при удалении комментария",n==null?void 0:n.message)}}const y=b(!1);async function g(l){if(e.value){y.value=!0;try{const n=await s.toggleReaction(e.value.id,l);e.value.myReaction=e.value.myReaction===l?null:l,e.value.reactionCounts=n.data}catch(n){t.openErrorModal("Не удалось отреагировать на видео",n.message)}finally{y.value=!1}}}async function $(){if(e.value)try{const l=await s.getAccessInfo(e.value.id,{showLoader:!0});m.value=l.data}catch(l){t.openErrorModal("Ошибка при загрузке информации о доступе",l==null?void 0:l.message)}}return{video:e,accessInfo:m,comments:i,similarVideos:u,fetchVideo:p,deleteComment:c,react:g,reactionsLoading:y}}),j=t=>(L("data-v-19fbd2d1"),t=t(),M(),t),Ge={key:0,class:"video-view"},He={class:"video-view__player"},Qe={class:"video-view__comments"},We={class:"video-view__comments__list"},Xe={class:"video-view__comments__form"},Ze={class:"video-view__info"},Je={class:"video-view__info__head"},Ke={class:"video-view__info__back-button"},eo=j(()=>a("span",{class:"video-view__info__head-separator"},"•",-1)),oo={key:0,class:"video-view__info__edit-button"},to={class:"video-view__info__title"},no={class:"video-view__info__author"},so={class:"video-view__info__main"},io={class:"video-view__info__actions"},ao={key:0,class:"video-view__info__link"},_o={class:"video-view__info__description"},co={key:1,class:"video-view__not-found"},lo=j(()=>a("h4",null,"Видео не найдено",-1)),ro=C({__name:"video-view",setup(t){const s=_e(),e=ze();A(()=>s.params.id,async()=>{var o;await e.fetchVideo(s.params.id),e.comments.trigger(),T(`НОО.Tube - ${(o=e.video)==null?void 0:o.title}`)},{immediate:!0});const m=I(()=>{var o;return h.Constants.APP_URL+`/nootube/video/${(o=e.video)==null?void 0:o.id}`}),i=I(()=>{var o;return`https://runtime.video.cloud.yandex.net/player/video/${(o=e.video)==null?void 0:o.uniqueIdentifier}`}),u=b(!1);function p(){u.value=!0}async function d(){var o;await e.fetchVideo(s.params.id),T(`НОО.Tube - ${(o=e.video)==null?void 0:o.title}`)}return(o,c)=>{var B;const y=je,g=qe,$=Ie,l=le,n=Y,z=be,G=re,U=ve,H=ue,Q=me,W=ce("nothing-found");return _(e).video?(v(),f("div",Ge,[a("div",He,[(v(),R(y,{video:_(e).video,key:_(e).video.id},null,8,["video"]))]),a("div",Qe,[a("div",We,[r(g,{comments:_(e).comments.results,onDeleteComment:c[0]||(c[0]=w=>_(e).deleteComment(w))},null,8,["comments"])]),a("div",Xe,[r($,{"video-id":_(e).video.id,onCommentCreated:c[1]||(c[1]=w=>_(e).comments.trigger())},null,8,["video-id"])])]),a("div",Ze,[a("div",Je,[a("div",Ke,[r(l,{to:"/nootube"},{default:k(()=>[V(" Назад к списку видео ")]),_:1})]),eo,_(h).Context.roleIs(["teacher","admin"])?(v(),f("div",oo,[a("span",{class:"video-view__info__edit-button",onClick:c[2]||(c[2]=w=>p())},"Редактировать видео")])):E("",!0)]),a("h1",to,x(_(e).video.title),1),a("div",no,[r(n,{user:_(e).video.uploadedBy},null,8,["user"])]),a("div",so," Опубликовано "+x(_(q)(_(e).video.publishedAt,{precision:"day"}).toBeautiful())+" • "+x((B=_(e).accessInfo)==null?void 0:B.text),1),a("div",io,[r(z,{"video-id":_(e).video.id},null,8,["video-id"]),r(G,{reactions:_(e).video.reactionCounts,"my-reaction":_(e).video.myReaction,loading:_(e).reactionsLoading,onReact:c[3]||(c[3]=w=>_(e).react(w))},null,8,["reactions","my-reaction","loading"])]),_(h).Context.roleIs(["admin","teacher"])?(v(),f("div",ao,[r(U,{label:"Ссылка на видео","model-value":m.value,type:"text",readonly:"","copy-button":""},null,8,["model-value"]),r(U,{label:"Ссылка на видео для вставки в виде плеера","model-value":i.value,type:"text",readonly:"","copy-button":""},null,8,["model-value"])])):E("",!0),a("div",_o,[r(H,{content:_(e).video.description,"no-padding":""},null,8,["content"])])]),r(Q,{visible:u.value,"onUpdate:visible":c[4]||(c[4]=w=>u.value=w),video:_(e).video,onEdited:c[5]||(c[5]=w=>d())},null,8,["visible","video"])])):(v(),f("div",co,[r(W),lo]))}}});const uo=S(ro,[["__scopeId","data-v-19fbd2d1"]]);export{uo as default};
