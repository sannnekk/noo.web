import{a as x,Q as T,E as M,o as l,b as v,e,f as _,N as O,p as A,l as N,m as D,t as U,g as n,F as R,B as P,h as $,w as m,s as h,v as V,C as k,Z as j,M as Q,x as E,$ as X,a0 as Z,r as q,X as z,a1 as G,y as H,_ as J,j as K,I as W,k as Y}from"./index-51ddc428.js";import{_ as oo}from"./tag-input-75a25b54.js";import{u as F}from"./useDate-126c6fe0.js";import{b as to,u as eo}from"./blog-b3aa9722.js";const B=d=>(A("data-v-668db74a"),d=d(),N(),d),so={class:"blogpost-search-options"},no=B(()=>e("div",{class:"blogpost-search-options__title"},[e("h3",null,"Теги")],-1)),ao={class:"blogpost-search-options__section"},io=B(()=>e("div",{class:"blogpost-search-options__title"},[e("h3",null,"Дата")],-1)),lo={class:"blogpost-search-options__section"},_o=B(()=>e("br",null,null,-1)),po=x({__name:"blogpost-search-options",props:{pagination:{}},emits:["update:pagination"],setup(d,{emit:s}){const a=d,{yesterday:C,today:r}=F(new Date,{precision:"day"}),t=T({...a.pagination,"filter[tags]":{type:"tags",value:[]},"filter[createdAt]":{type:"range",value:[C(),r()]}});return M(t,()=>{s("update:pagination",t)},{deep:!0}),(y,o)=>{const i=oo,p=O;return l(),v("div",so,[no,e("div",ao,[_(i,{label:"Введите тег",modelValue:t["filter[tags]"].value,"onUpdate:modelValue":o[0]||(o[0]=c=>t["filter[tags]"].value=c)},null,8,["modelValue"])]),io,e("div",lo,[_(p,{type:"date",label:"Дата от",modelValue:t["filter[createdAt]"].value[0],"onUpdate:modelValue":o[1]||(o[1]=c=>t["filter[createdAt]"].value[0]=c)},null,8,["modelValue"]),_o,_(p,{type:"date",label:"Дата до",modelValue:t["filter[createdAt]"].value[1],"onUpdate:modelValue":o[2]||(o[2]=c=>t["filter[createdAt]"].value[1]=c)},null,8,["modelValue"])])])}}});const ro=D(po,[["__scopeId","data-v-668db74a"]]),co={class:"blogpost-card"},uo={class:"blogpost-card__header"},go={class:"blogpost-card__header__title"},mo={class:"blogpost-card__header__date"},vo={class:"blogpost-card__info"},fo={class:"blogpost-card__info__tags"},bo={class:"blogpost-card__content"},ho={class:"blogpost-card__content__richtext"},yo={class:"blogpost-card__content__actions"},$o={key:0,class:"blogpost-card__content__poll-count"},Vo={class:"blogpost-card__footer"},ko={class:"blogpost-card__footer__author"},Co={class:"blogpost-card__footer__author__avatar"},wo={class:"blogpost-card__footer__author__name"},Io={class:"blogpost-card__footer__reactions"},Uo=x({__name:"blogpost-card",props:{post:{},reaction:{},isReactionLoading:{type:Boolean}},emits:["react","delete"],setup(d,{emit:s}){const a=d;function C(o,i=5){if(o.ops.length<=i)return o;const p=o.ops.slice(0,i).filter(u=>{var f;return((f=u.insert)==null?void 0:f.image)===void 0}),c=o.ops.find(u=>{var f;return(f=u.insert)==null?void 0:f.image});return c?{ops:[c,...p,{insert:`
...`}]}:{ops:[...p,{insert:`
...`}]}}function r(){s("delete",a.post.id)}function t(){var i;const o=(i=k.Context.User)==null?void 0:i.role;return!a.post.poll||!o?!1:a.post.poll.canVote.includes(o)||a.post.poll.canVote.includes("everyone")}function y(){var i;const o=(i=k.Context.User)==null?void 0:i.role;return!a.post.poll||!o?!1:a.post.poll.canSeeResults.includes(o)||a.post.poll.canSeeResults.includes("everyone")}return(o,i)=>{var w,b,S,L;const p=j,c=Q,u=E,f=X,g=Z;return l(),v("div",co,[e("div",uo,[e("div",go,[e("h2",null,U(o.post.title),1)]),e("div",mo,U(n(F)(o.post.createdAt,{precision:"day"}).toBeautiful()),1)]),e("div",vo,[e("div",fo,[(l(!0),v(R,null,P(o.post.tags,I=>(l(),$(p,{key:I,type:"info",mode:"background"},{default:m(()=>[h(" #"+U(I),1)]),_:2},1024))),128))])]),e("div",bo,[e("div",ho,[_(c,{content:C(o.post.content)},null,8,["content"])]),e("div",yo,[o.post.content.ops.length>3?(l(),$(u,{key:0,to:`/blog/post/${o.post.id}`},{default:m(()=>[h(" Читать далее ")]),_:1},8,["to"])):V("",!0),t()?(l(),$(u,{key:1,to:`/poll/${o.post.pollId}`,design:"warning"},{default:m(()=>[h(" Пройти опрос ")]),_:1},8,["to"])):V("",!0),y()?(l(),$(u,{key:2,to:`/poll/${o.post.pollId}/results`,design:"inline"},{default:m(()=>[h(" Результаты опроса ")]),_:1},8,["to"])):V("",!0),((w=n(k).Context.User)==null?void 0:w.role)==="teacher"||((b=n(k).Context.User)==null?void 0:b.role)==="admin"?(l(),$(u,{key:3,design:"inline",to:`/blog/post/create${o.post.id}`},{default:m(()=>[h(" Редактировать ")]),_:1},8,["to"])):V("",!0),((S=n(k).Context.User)==null?void 0:S.role)==="teacher"||((L=n(k).Context.User)==null?void 0:L.role)==="admin"?(l(),$(u,{key:4,design:"danger",onClick:i[0]||(i[0]=I=>r())},{default:m(()=>[h(" Удалить ")]),_:1})):V("",!0)]),o.post.poll?(l(),v("div",$o,[e("p",null,U(o.post.poll.votedUserIds.length)+" человек приняли участие в опросе ",1)])):V("",!0)]),e("div",Vo,[e("div",ko,[e("div",Co,[_(f,{name:o.post.author.name},null,8,["name"])]),e("div",wo,[_(g,{username:o.post.author.username,name:o.post.author.name},null,8,["username","name"])])]),e("div",Io,[_(to,{"my-reaction":o.post.myReaction,reactions:o.post.reactionCounts,loading:o.isReactionLoading,onReact:i[1]||(i[1]=I=>s("react",I))},null,8,["my-reaction","reactions","loading"])])])])}}});const xo=D(Uo,[["__scopeId","data-v-825d0239"]]),Do=d=>(A("data-v-44996f6f"),d=d(),N(),d),Ro={class:"blog-list"},Bo={key:0,class:"blog-list__cards"},So={key:1,class:"blog-list__loading"},Lo={key:2,class:"blog-list__not-found"},To={class:"blog-list__not-found__image"},Mo=Do(()=>e("p",{class:"blog-list__not-found__text"},"Посты не найдены",-1)),Ao=x({__name:"blogpost-list",props:{posts:{},loading:{type:Boolean},isReactionLoading:{type:Boolean}},emits:["react","delete"],setup(d,{emit:s}){const a=d,C=q({});return M(C,(r,t)=>{console.log("reactionsModel changed",r,t)},{deep:!0}),(r,t)=>{const y=z,o=G;return l(),v("div",Ro,[!r.loading&&a.posts.length?(l(),v("div",Bo,[(l(!0),v(R,null,P(a.posts,i=>(l(),$(xo,{key:i.id,post:i,"is-reaction-loading":a.isReactionLoading,onReact:p=>s("react",{postId:i.id,reaction:p}),onDelete:t[0]||(t[0]=p=>s("delete",p))},null,8,["post","is-reaction-loading","onReact"]))),128))])):r.loading?(l(),v("div",So,[_(y,{contrast:""})])):(l(),v("div",Lo,[e("div",To,[_(o)]),Mo]))])}}});const No=D(Ao,[["__scopeId","data-v-44996f6f"]]),Po={class:"index-view"},Eo={class:"index-view__search"},Fo={class:"index-view__search__field"},Oo={class:"index-view__search__add-post"},jo={class:"index-view__list"},Qo={key:0,class:"index-view__pagination"},Xo=x({__name:"index-view",setup(d){const s=eo(),a=T({isDeleteModalVisible:!1,postIdToDelete:"",postTitle:""});function C(r){var t;a.isDeleteModalVisible=!0,a.postIdToDelete=r,a.postTitle=((t=s.results.find(y=>y.id===r))==null?void 0:t.title)||""}return H("Блог/Новости"),(r,t)=>{var u,f;const y=J,o=E,i=K,p=W,c=Y;return l(),v(R,null,[e("div",Po,[e("div",Eo,[e("div",Fo,[_(y,{modelValue:n(s).pagination.search,"onUpdate:modelValue":t[0]||(t[0]=g=>n(s).pagination.search=g)},null,8,["modelValue"])]),e("div",Oo,[((u=n(k).Context.User)==null?void 0:u.role)==="admin"||((f=n(k).Context.User)==null?void 0:f.role)==="teacher"?(l(),$(o,{key:0,design:"primary",to:"/blog/post/create"},{default:m(()=>[h(" Добавить пост ")]),_:1})):V("",!0)])]),_(p,null,{sidebar:m(()=>[_(ro,{pagination:n(s).pagination,"onUpdate:pagination":t[1]||(t[1]=g=>n(s).pagination=g)},null,8,["pagination"])]),content:m(()=>{var g,w;return[e("div",jo,[_(No,{posts:n(s).results,loading:n(s).isListLoading,"is-reaction-loading":n(s).isReactionLoading,onReact:t[2]||(t[2]=b=>n(s).reactToPost(b.postId,b.reaction)),onDelete:t[3]||(t[3]=b=>C(b))},null,8,["posts","loading","is-reaction-loading"])]),(g=n(s).pagination)!=null&&g.page&&((w=n(s).pagination)!=null&&w.limit)?(l(),v("div",Qo,[_(i,{page:n(s).pagination.page,"onUpdate:page":t[4]||(t[4]=b=>n(s).pagination.page=b),total:n(s).resultsMeta.total,limit:n(s).pagination.limit},null,8,["page","total","limit"])])):V("",!0)]}),_:1})]),_(c,{visible:a.isDeleteModalVisible,"onUpdate:visible":t[5]||(t[5]=g=>a.isDeleteModalVisible=g),onConfirm:t[6]||(t[6]=g=>n(s).deletePost(a.postIdToDelete))},{title:m(()=>[h("Удаление поста")]),text:m(()=>[h(' Вы уверены, что хотите удалить пост "'+U(a.postTitle)+'"? ',1)]),_:1},8,["visible"])],64)}}});const Ho=D(Xo,[["__scopeId","data-v-340f8e19"]]);export{Ho as default};
