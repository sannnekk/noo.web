import{d as $,x as L,r as h,q as B,s as P,a as r,j as _,g as o,k as n,e as c,y as d,v as w,f as A,O as x,F as N,D as E,E as k,_ as V,P as M,Q as q,p as F,l as R,u as b,R as D,T,U as j,C as g,A as G,G as O}from"./index-020b77cc.js";import{S as C}from"./settings-section-e47db06f.js";const Q={class:"password-change-form"},z={class:"password-change-form__form-field"},H={class:"password-change-form__form-field"},J={class:"password-change-form__validation"},K={class:"password-change-form__form-field"},W={key:0,class:"password-change-form__error"},X={class:"password-change-form__form-action"},Y=$({__name:"password-change-form",emits:["change-password"],setup(p,{emit:s}){const l=s,e=L({oldPassword:"",newPassword:"",repeatPassword:"",passwordIsCorrect:!1}),i=h(null);function u(){e.newPassword!==e.repeatPassword&&(i.value="Пароли не совпадают"),e.passwordIsCorrect?(i.value=null,l("change-password",e)):i.value="Пароль не соответствует требованиям"}return(a,t)=>{const f=x,m=N,S=E,y=k,U=B("auto-animate");return P((r(),_("div",Q,[o("div",z,[n(f,{modelValue:e.oldPassword,"onUpdate:modelValue":t[0]||(t[0]=v=>e.oldPassword=v),type:"password",label:"Старый пароль"},null,8,["modelValue"])]),o("div",H,[n(f,{modelValue:e.newPassword,"onUpdate:modelValue":t[1]||(t[1]=v=>e.newPassword=v),type:"password",label:"Новый пароль"},null,8,["modelValue"])]),o("div",J,[n(m,{password:e.newPassword,modelValue:e.passwordIsCorrect,"onUpdate:modelValue":t[2]||(t[2]=v=>e.passwordIsCorrect=v)},null,8,["password","modelValue"])]),o("div",K,[n(f,{modelValue:e.repeatPassword,"onUpdate:modelValue":t[3]||(t[3]=v=>e.repeatPassword=v),type:"password",label:"Повторите новый пароль"},null,8,["modelValue"])]),i.value?(r(),_("div",W,[n(S,null,{default:c(()=>[d(w(i.value),1)]),_:1})])):A("",!0),o("div",X,[n(y,{design:"primary",onClick:t[4]||(t[4]=v=>u()),alignment:"left"},{default:c(()=>[d(" Сохранить ")]),_:1})])])),[[U]])}}});const Z=V(Y,[["__scopeId","data-v-54b42326"]]),I=p=>(F("data-v-006f04a0"),p=p(),R(),p),ee={class:"delete-account"},se={class:"delete-account__body"},oe=I(()=>o("div",{class:"delete-account__body__warning"},[o("p",null," Все ваши данные будут удалены без возможности восстановления, включая все работы и всю статистику ")],-1)),te={class:"delete-account__body__button"},ne=I(()=>o("h2",null,"Вы уверены, что хотите удалить свой аккаунт?",-1)),ae=I(()=>o("p",null," Все ваши данные будут удалены без возможности восстановления, включая все работы и всю статистику ",-1)),ie=$({__name:"delete-account",emits:["delete-account"],setup(p){const s=h(!1),l=h("");function e(){s.value=!0}return(i,u)=>{const a=k,t=x,f=q;return r(),_(M,null,[o("div",ee,[o("div",se,[oe,o("div",te,[n(a,{design:"danger",alignment:"left",onClick:e},{default:c(()=>[d(" Удалить аккаунт ")]),_:1})])])]),n(f,{visible:s.value,"onUpdate:visible":u[1]||(u[1]=m=>s.value=m),onConfirm:u[2]||(u[2]=m=>i.$emit("delete-account",l.value))},{title:c(()=>[ne]),text:c(()=>[ae,n(t,{modelValue:l.value,"onUpdate:modelValue":u[0]||(u[0]=m=>l.value=m),type:"password",label:"Введите ваш пароль для подтверждения"},null,8,["modelValue"])]),_:1},8,["visible"])],64)}}});const le=V(ie,[["__scopeId","data-v-006f04a0"]]),re={class:"session-card"},_e={class:"session-card__title"},ce={key:0,class:"session-card__is-current"},de={class:"session-card__details"},ue={class:"session-card__details__item"},pe={key:0,class:"session-card__details__item"},me={class:"session-card__details__item"},ve={class:"session-card__details__item"},we={class:"session-card__actions"},fe=$({__name:"session-card",props:{id:{},userAgent:{},isMobile:{type:Boolean},userId:{},user:{},browser:{},os:{},device:{},ipAddress:{},lastRequestAt:{},location:{},isCurrent:{type:Boolean},createdAt:{},updatedAt:{}},emits:["delete-session"],setup(p){return(s,l)=>{const e=k;return r(),_("div",re,[o("div",_e,[o("h5",null,[d(w(s.device)+", "+w(s.browser)+" ",1),s.isCurrent?(r(),_("span",ce," Это устройство ")):A("",!0)])]),o("div",de,[o("div",ue,[d(" Браузер: "),o("span",null,w(s.browser),1)]),s.os?(r(),_("div",pe,[d(" Система: "),o("span",null,w(s.os),1)])):A("",!0),o("div",me,[d(" Последняя активность: "),o("span",null,w(b(D)(s.lastRequestAt,{precision:"minute"}).toBeautiful()),1)]),o("div",ve,[d(" Вход: "),o("span",null,w(b(D)(s.createdAt,{precision:"minute"}).toBeautiful()),1)])]),o("div",we,[n(e,{design:"warning",onClick:l[0]||(l[0]=i=>s.$emit("delete-session",s.id)),alignment:"center"},{default:c(()=>[d(" Выйти ")]),_:1})])])}}});const ge=V(fe,[["__scopeId","data-v-f3c87d07"]]),he={class:"session-view"},ye={key:0,class:"session-view__items row"},$e={key:1,class:"session-view__is-loading"},Se={key:2,class:"session-view__error"},be=$({__name:"session-view",setup(p){const s=h(!0),l=h(""),e=h([]);async function i(){s.value=!0;try{const a=await g.Services.Session.getSessions();e.value=a.data}catch(a){a.value=a.message}finally{s.value=!1}}async function u(a){s.value=!0;try{await g.Services.Session.deleteSession(a),await i()}catch(t){t.value=t.message}finally{s.value=!1}}return i(),(a,t)=>{const f=G,m=E,S=B("auto-animate");return P((r(),_("div",he,[!s.value&&e.value.length>0?P((r(),_("div",ye,[(r(!0),_(M,null,T(e.value,y=>(r(),_("div",{class:"col-md-4 col-12",key:y.id},[n(ge,j({ref_for:!0},y,{onDeleteSession:U=>u(y.id)}),null,16,["onDeleteSession"])]))),128))])),[[S]]):s.value?(r(),_("div",$e,[n(f,{contrast:""})])):(r(),_("div",Se,[n(m,null,{default:c(()=>[d(w(l.value),1)]),_:1})]))])),[[S]])}}});const Ve=V(be,[["__scopeId","data-v-6b0f5ea4"]]),Ce=O("settings-module:account",()=>{const p=g.Services.User,s=g.Services.Auth,l=g.Services.UI,e=g.Context.User.id;async function i(a){try{await p.changePassword(e,a.oldPassword,a.newPassword,{showLoader:!0}),l.openSuccessModal("Пароль успешно изменен")}catch(t){l.openErrorModal("Произошла ошибка при изменении пароля",t.message)}}async function u(a){try{if(!(a!=null&&a.length))throw new Error("Введите пароль");await p.deleteUser(e,a,{showLoader:!0}),l.openSuccessModal("Аккаунт успешно удален"),await s.logout()}catch(t){l.openErrorModal("Произошла ошибка при удалении аккаунта",t.message)}}return{changePassword:i,deleteAccount:u}}),Pe={class:"account-view"},Ae={class:"account-view__sessions"},ke={class:"account-view__password-change"},Ie={class:"account-view__sessionsdelete-account"},Be=$({__name:"account-view",setup(p){const s=Ce();return(l,e)=>(r(),_("div",Pe,[n(C,null,{title:c(()=>[d(" Активные сессии ")]),content:c(()=>[o("div",Ae,[n(Ve)])]),_:1}),n(C,null,{title:c(()=>[d(" Смена пароля ")]),content:c(()=>[o("div",ke,[n(Z,{onChangePassword:e[0]||(e[0]=i=>b(s).changePassword(i))})])]),_:1}),n(C,null,{title:c(()=>[d(" Удаление аккаунта ")]),content:c(()=>[o("div",Ie,[n(le,{onDeleteAccount:e[1]||(e[1]=i=>b(s).deleteAccount(i))})])]),_:1})]))}});export{Be as default};
